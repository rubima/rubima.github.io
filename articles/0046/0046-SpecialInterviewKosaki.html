<!DOCTYPE html>
<html>
  



  <head>
  <script src="../../js/gtag.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Rubyist インタビュー特別編 小崎資広さん 前編</title>
  <meta name="description" content="">

  <script src="../../js/jquery.min.js"></script>
  <script src="../../js/bootstrap.min.js"></script>
  <link href="../../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../../css/theme.css" rel="stylesheet" type="text/css">
  <link href="../../css/syntax.css" rel="stylesheet" type="text/css">
  <link href="../../css/sharebutton.css" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="https://magazine.rubyist.net/articles/0046/0046-SpecialInterviewKosaki.html">
  <link rel="alternate" type="application/rss+xml" title="Rubyist Magazine" href="https://magazine.rubyist.net/feed.xml">
  <link rel="shortcut icon" href="../../images/favicon.ico">
</head>

  <body>
    <div class="container-fluid">
        <div class="row full">
            <div class="col-md-2 hidden-xs sidebar">
                <h4>

</h4>

<h4>バックナンバー</h4>
<ul>
    
        <li><a href="../../articles/0058/0058-index.html">0058号(2018-08)</a></li>
    
        <li><a href="../../articles/prerubykaigi2018/preRubyKaigi2018-index.html">RubyKaigi 2018 直前特集号</a></li>
    
        <li><a href="../../articles/0057/0057-index.html">0057号(2018-02)</a></li>
    
        <li><a href="../../articles/prerubykaigi2017/preRubyKaigi2017-index.html">RubyKaigi 2017 直前特集号</a></li>
    
        <li><a href="../../articles/0056/0056-index.html">0056号(2017-08)</a></li>
    
        <li><a href="../../articles/0055/0055-index.html">0055号(2017-03)</a></li>
    
        <li><a href="../../articles/0054/0054-index.html">0054号(2016-08)</a></li>
    
        <li><a href="../../articles/pretokyorubykaigi11/preTokyoRubyKaigi11-index.html">東京 Ruby 会議 11 直前特集号</a></li>
    
        <li><a href="../../articles/0053/0053-index.html">0053号(2016-04)</a></li>
    
        <li><a href="../../articles/0052/0052-index.html">0052号(2015-12)</a></li>
    
        <li><a href="../../articles/0051/0051-index.html">0051号(2015-09)</a></li>
    
        <li><a href="../../articles/0050/0050-index.html">0050号(2015-05)</a></li>
    
        <li><a href="../../articles/0049/0049-index.html">0049号(2014-12)</a></li>
    
        <li><a href="../../articles/0048/0048-index.html">0048号(2014-09)</a></li>
    
        <li><a href="../../articles/0047/0047-index.html">0047号(2014-06)</a></li>
    
        <li><a href="../../articles/0046/0046-index.html">0046号(2014-04)</a></li>
    
        <li><a href="../../articles/0045/0045-index.html">0045号(2013-12)</a></li>
    
        <li><a href="../../articles/0044/0044-index.html">0044号(2013-09)</a></li>
    
        <li><a href="../../articles/0043/0043-index.html">0043号(2013-07)</a></li>
    
        <li><a href="../../articles/0042/0042-index.html">0042号(2013-05)</a></li>
    
        <li><a href="../../articles/ruby200specialen/Ruby200SpecialEn-index.html">2.0.0 Special (EN)</a></li>
    
        <li><a href="../../articles/0041/0041-index.html">0041号(2013-02)</a></li>
    
        <li><a href="../../articles/0040/0040-index.html">0040号(2012-11)</a></li>
    
        <li><a href="../../articles/0039/0039-index.html">0039号(2012-09)</a></li>
    
        <li><a href="../../articles/rubykaja/kaja.html">RubyKaja のご紹介</a></li>
    
        <li><a href="../../articles/0038/0038-index.html">0038号(2012-05)</a></li>
    
        <li><a href="../../articles/0037/0037-index.html">0037号(2012-02)</a></li>
    
        <li><a href="../../articles/0036/0036-index.html">0036号(2011-11)</a></li>
    
        <li><a href="../../articles/0035/0035-index.html">0035号(2011-09)</a></li>
    
        <li><a href="../../articles/prerubykaigi2011/preRubyKaigi2011-index.html">RubyKaigi2011直前特集号</a></li>
    
        <li><a href="../../articles/0034/0034-index.html">0034号(2011-06)</a></li>
    
        <li><a href="../../articles/0033/0033-index.html">0033号(2011-04)</a></li>
    
        <li><a href="../../articles/0032/0032-index.html">0032号(2011-01)</a></li>
    
        <li><a href="../../articles/0031/0031-index.html">0031号(2010-10)</a></li>
    
        <li><a href="../../articles/prerubykaigi2010/preRubyKaigi2010-index.html">RubyKaigi2010直前特集号</a></li>
    
        <li><a href="../../articles/0030/0030-index.html">0030号(2010-06)</a></li>
    
        <li><a href="../../articles/0029/0029-index.html">0029号(2010-03)</a></li>
    
        <li><a href="../../articles/0028/0028-index.html">0028号(2009-12)</a></li>
    
        <li><a href="../../articles/0027/0027-index.html">0027号(2009-09)</a></li>
    
        <li><a href="../../articles/0026/0026-index.html">0026号(2009-06)</a></li>
    
        <li><a href="../../articles/0025/0025-index.html">0025号(2009-02)</a></li>
    
        <li><a href="../../articles/0024/0024-index.html">0024号(2008-10)</a></li>
    
        <li><a href="../../articles/0023/0023-index.html">0023号(2008-03)</a></li>
    
        <li><a href="../../articles/0022/0022-index.html">0022号(2007-12)</a></li>
    
        <li><a href="../../articles/0021/0021-index.html">0021号(2007-09)</a></li>
    
        <li><a href="../../articles/0020/0020-index.html">0020号(2007-08)</a></li>
    
        <li><a href="../../articles/0019/0019-index.html">0019号(2007-05)</a></li>
    
        <li><a href="../../articles/0018/0018-index.html">0018号(2007-02)</a></li>
    
        <li><a href="../../articles/0017/0017-index.html">0017号(2006-11)</a></li>
    
        <li><a href="../../articles/0016/0016-index.html">0016号(2006-09)</a></li>
    
        <li><a href="../../articles/0015/0015-index.html">0015号(2006-07)</a></li>
    
        <li><a href="../../articles/rubykaigi2006/RubyKaigi2006-index.html">日本 Ruby カンファレンス 2006 特別号</a></li>
    
        <li><a href="../../articles/0014/0014-index.html">0014号(2006-05)</a></li>
    
        <li><a href="../../articles/0013/0013-index.html">0013号(2006-02)</a></li>
    
        <li><a href="../../articles/0012/0012-index.html">0012号(2005-12)</a></li>
    
        <li><a href="../../articles/0011/0011-index.html">0011号(2005-11)</a></li>
    
        <li><a href="../../articles/0010/0010-index.html">0010号(2005-10)</a></li>
    
        <li><a href="../../articles/0009/0009-index.html">0009号(2005-09)</a></li>
    
        <li><a href="../../articles/0008/0008-index.html">0008号(2005-07)</a></li>
    
        <li><a href="../../articles/0007/0007-index.html">0007号(2005-06)</a></li>
    
        <li><a href="../../articles/0006/0006-index.html">0006号(2005-05)</a></li>
    
        <li><a href="../../articles/0005/0005-index.html">0005号(2005-02)</a></li>
    
        <li><a href="../../articles/0004/0004-index.html">0004号(2004-12)</a></li>
    
        <li><a href="../../articles/0003/0003-index.html">0003号(2004-11)</a></li>
    
        <li><a href="../../articles/0002/0002-index.html">0002号(2004-10)</a></li>
    
        <li><a href="../../articles/0001/0001-index.html">0001号(2004-09)</a></li>
    
</ul>
<p class="rss-subscribe"><a href="/feed.xml">RSS</a></p>

            </div>
            <div class="col-md-10 main">
                <div class="row">
                    <div class="col-md-12">
                        <img src="../../images/rubima_logo_l.png">
                        <h1>Rubyist インタビュー特別編 小崎資広さん 前編</h1>
                        <div class="social-buttons">
                            <div class='sns'>            
    <ul class="clearfix">
       <li class="twitter"><a href="https://twitter.com/share?text=Rubyist インタビュー特別編 小崎資広さん 前編&amp;url=https://magazine.rubyist.net/articles/0046/0046-SpecialInterviewKosaki.html" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-twitter"></i></a></li>
       <li class="facebook"><a href="https://www.facebook.com/sharer.php?u=https://magazine.rubyist.net/articles/0046/0046-SpecialInterviewKosaki.html&amp;t=Rubyist インタビュー特別編 小崎資広さん 前編" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-facebook"></i></a></li>
       <li class="hatebu"><a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=https://magazine.rubyist.net/articles/0046/0046-SpecialInterviewKosaki.html&amp;Rubyist インタビュー特別編 小崎資広さん 前編" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa">B!</i></a></li>
    </ul>
</div>
                        </div>
                        
<h2 id="はじめに">はじめに</h2>

<p>2013 年 11 月 8 日から 3 日間の日程で、アメリカはフロリダ州マイアミビーチにて  <a href="http://confreaks.com/events/rubyconf2013">RubyConf 2013</a> が開催されました (<a href="../../articles/0045/0045-RubyConf2013.html">るびまにも参加レポートがあります</a>)。</p>

<p>その際に Ruby と Linux カーネルのデュアルコミッタとして有名な小崎資広さん (現在はボストン近郊在住) が参加されており、編集部からも数名が RubyConf 2013 に参加していたこともあり、せっかくですので (いつもの <a href="CategoryIndices#l2">Rubyist Hotlinks インタビュー</a>とは別企画の特別編として) インタビューさせていただきました。二日間にわたるインタビューとなりましたので、前後編に分けてお送りします。</p>

<p>では、お楽しみください。</p>

<p><img src="http://lh3.googleusercontent.com/-Yi9SFzlHfIY/UoYva8KZD7I/AAAAAAAA1z8/xWO3gR525OQ/s400/DSCI3712.JPG" alt="DSCI3712.JPG" /></p>

<h2 id="プロフィール">プロフィール</h2>

<dl>
  <dt>好きな言葉</dt>
  <dd>「夜明け前が一番暗い」「生きてるだけで儲けもの」</dd>
  <dt>尊敬する人</dt>
  <dd>漆原教授 (動物のお医者さん)、ヴェルナー・フォン・ブラウン</dd>
</dl>

<h2 id="インタビュー">インタビュー</h2>

<dl>
  <dt>聞き手</dt>
  <dd><a href="../../articles/0042/0042-Hotlinks.html">卜部さん</a> (<a href="https://twitter.com/shyouhei">@shyouhei</a>)</dd>
  <dt>語り手</dt>
  <dd>小崎資広さん</dd>
  <dt>野次馬</dt>
  <dd>笹田さん (<a href="https://twitter.com/koichisasada">@koichisasada</a>)、<a href="../../articles/0037/0037-Hotlinks.html">松田さん</a><sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> (<a href="https://twitter.com/a_matsuda">@a_matsuda</a>)、<a href="../../articles/0028/0028-Hotlinks.html">中村さん</a> (<a href="https://twitter.com/nari3">@nari3</a>)、瀬尾さん (<a href="https://twitter.com/sonots">@sonots</a>)、菅井さん (<a href="https://twitter.com/hokkai7go">@hokkai7go</a>)、三村さん (<a href="https://twitter.com/takkanm">@takkanm</a>)、郡司さん (<a href="https://twitter.com/gunjisatoshi">@gunjisatoshi</a>)</dd>
  <dt>日にち</dt>
  <dd>2013 年 11 月 9 日、11 月 10 日<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup></dd>
  <dt>場所</dt>
  <dd>RubyConf 2013 会場ホテル (<a href="http://www.loewshotels.com/Miami-Beach-Hotel">Loews Miami Beach Hotel</a>) の瀬尾さんの部屋</dd>
</dl>

<h3 id="目次">目次</h3>

<ul id="markdown-toc">
  <li><a href="#はじめに" id="markdown-toc-はじめに">はじめに</a></li>
  <li><a href="#プロフィール" id="markdown-toc-プロフィール">プロフィール</a></li>
  <li><a href="#インタビュー" id="markdown-toc-インタビュー">インタビュー</a>    <ul>
      <li><a href="#目次" id="markdown-toc-目次">目次</a></li>
      <li><a href="#プロフィール-1" id="markdown-toc-プロフィール-1">プロフィール</a>        <ul>
          <li><a href="#生年月日出身地家族構成" id="markdown-toc-生年月日出身地家族構成">生年月日、出身地、家族構成</a></li>
          <li><a href="#好きな言葉座右の銘" id="markdown-toc-好きな言葉座右の銘">好きな言葉、座右の銘</a></li>
          <li><a href="#尊敬する人物" id="markdown-toc-尊敬する人物">尊敬する人物</a></li>
        </ul>
      </li>
      <li><a href="#代表作" id="markdown-toc-代表作">代表作</a>        <ul>
          <li><a href="#テレビの組み込みブラウザ" id="markdown-toc-テレビの組み込みブラウザ">テレビの組み込みブラウザ</a></li>
          <li><a href="#malloc-の解説" id="markdown-toc-malloc-の解説">malloc の解説</a></li>
          <li><a href="#linux-kernel-watch" id="markdown-toc-linux-kernel-watch">Linux Kernel Watch</a></li>
          <li><a href="#ruby-と-linux-への貢献" id="markdown-toc-ruby-と-linux-への貢献">Ruby と Linux への貢献</a></li>
        </ul>
      </li>
      <li><a href="#ruby-に関して" id="markdown-toc-ruby-に関して">Ruby に関して</a>        <ul>
          <li><a href="#rubyist-になったきっかけ" id="markdown-toc-rubyist-になったきっかけ">Rubyist になったきっかけ</a></li>
          <li><a href="#好きなメソッドと嫌いなメソッド" id="markdown-toc-好きなメソッドと嫌いなメソッド">好きなメソッドと嫌いなメソッド</a></li>
          <li><a href="#現在の-ruby-とのつきあい方" id="markdown-toc-現在の-ruby-とのつきあい方">現在の Ruby とのつきあい方</a></li>
          <li><a href="#ruby-を使って成功した事例" id="markdown-toc-ruby-を使って成功した事例">Ruby を使って成功した事例</a></li>
          <li><a href="#キラーアプリ" id="markdown-toc-キラーアプリ">キラーアプリ</a></li>
          <li><a href="#ruby-の習得は簡単でしたか" id="markdown-toc-ruby-の習得は簡単でしたか">Ruby の習得は簡単でしたか？</a></li>
        </ul>
      </li>
      <li><a href="#プログラミング全般" id="markdown-toc-プログラミング全般">プログラミング全般</a>        <ul>
          <li><a href="#ruby-以外のプログラミング言語あるいはテストの話" id="markdown-toc-ruby-以外のプログラミング言語あるいはテストの話">Ruby 以外のプログラミング言語あるいはテストの話</a></li>
          <li><a href="#レビューをするかチケット管理をするか" id="markdown-toc-レビューをするかチケット管理をするか">レビューをするかチケット管理をするか</a></li>
          <li><a href="#linux-界隈と-ruby-コミッター界隈の文化の違い" id="markdown-toc-linux-界隈と-ruby-コミッター界隈の文化の違い">Linux 界隈と Ruby コミッター界隈の文化の違い</a></li>
          <li><a href="#カーネルサミット" id="markdown-toc-カーネルサミット">カーネルサミット</a></li>
          <li><a href="#c-以外の言語は" id="markdown-toc-c-以外の言語は">C 以外の言語は？</a></li>
          <li><a href="#文字列操作" id="markdown-toc-文字列操作">文字列操作</a></li>
          <li><a href="#ソースコードの行数" id="markdown-toc-ソースコードの行数">ソースコードの行数</a></li>
          <li><a href="#美しいソースコード" id="markdown-toc-美しいソースコード">美しいソースコード</a></li>
          <li><a href="#テレビの規格" id="markdown-toc-テレビの規格">テレビの規格</a></li>
          <li><a href="#今興味があること" id="markdown-toc-今興味があること">今興味があること</a></li>
          <li><a href="#gnu-プロジェクトへの著作権の譲渡" id="markdown-toc-gnu-プロジェクトへの著作権の譲渡">GNU プロジェクトへの著作権の譲渡</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#途中で" id="markdown-toc-途中で">途中で</a></li>
</ul>

<h3 id="プロフィール-1">プロフィール</h3>

<h4 id="生年月日出身地家族構成">生年月日、出身地、家族構成</h4>
<p>: <img src="http://lh6.googleusercontent.com/-9lL2AR860Xg/UoYvoRbqjII/AAAAAAAA12A/TMSjJLrZglk/s400/DSCI3729.JPG" alt="DSCI3729.JPG" /></p>

<p><strong>卜部</strong> 本日はよろしくお願いします。最初にプロフィールを簡単に聞かせてください。</p>

<p><strong>小崎</strong> 1975 年生まれ。出身地は愛知県で、現住所はボストン<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup>郊外のマサチューセッツ、東海岸の北側ですね。ニューヨークからは飛行機で北東に 1 時間くらい、と言うとけっこう離れてるように聞こえるけど、向こうの感覚では近い。家族構成はシングルです。</p>

<h4 id="好きな言葉座右の銘">好きな言葉、座右の銘</h4>

<p><strong>卜部</strong> 好きな言葉や座右の銘は？</p>

<p><strong>小崎</strong> 「夜明け前が一番暗い」かな。しんどい時にその頑張りに意味がないと思ってしまうと、どんどん気持ちが下を向いてしまう性格だから。ポジティブシンキングというよりも、ネガティブから派生したポジティブという感じ。
あとは「まだ生きてる」とか気づいたらつぶやいてる。宗教的な意味はないけど、どうも生きてる事に意味を見いだす性格みたいです。気が抜けたときにふっと。あんまり意識していなかったけど、若い頃に知り合いがばんばん死ぬ時期があって、そういう影響だと思う。リアルはフラグもなしに人が死ぬからよくないよね。現実はクソゲー。</p>

<h4 id="尊敬する人物">尊敬する人物</h4>

<p><strong>卜部</strong> 尊敬する人物は？</p>

<p><strong>小崎</strong> 架空の人物だと、「<a href="http://ja.wikipedia.org/wiki/%E5%8B%95%E7%89%A9%E3%81%AE%E3%81%8A%E5%8C%BB%E8%80%85%E3%81%95%E3%82%93">動物のお医者さん</a>」の漆原教授。傍若無人だけど周りからは好かれているという。自分の目標です。正反対な性分なので (笑)。実在の人物で真面目に答えると、<a href="http://ja.wikipedia.org/wiki/%E3%83%B4%E3%82%A7%E3%83%AB%E3%83%8A%E3%83%BC%E3%83%BB%E3%83%95%E3%82%A9%E3%83%B3%E3%83%BB%E3%83%96%E3%83%A9%E3%82%A6%E3%83%B3">ヴェルナー・フォン・ブラウン</a>。V2 ロケットを作りたいとなるとナチスに身を売って実現させてしまう、ポリシーのない所がいいですね。
<img class="right" src="https://images-fe.ssl-images-amazon.com/images/I/51XFDEHGZYL._SL160_.jpg" /></p>

<p><strong>卜部</strong> 「目的のためなら手段を選ばない」？</p>

<p><strong>小崎</strong> 「目的のためなら手段を選ばない」というよりも、むしろ「手段のためなら目的を選ばない」かな。ロケットを作りたい、でも何に使われるかはどうでもいい、というところが理系っぽいじゃないですか。</p>

<p><strong>一同</strong> (笑)</p>

<p><strong>小崎</strong> 色々言われる人物だけれど、ちゃんと成果を出して月まで行ったんだからね。素晴らしい。</p>

<h3 id="代表作">代表作</h3>

<p><strong>卜部</strong> 小崎さんの代表作は？</p>

<p><strong>小崎</strong> 特にないかな。あんまりものを作ったりしないし。</p>

<h4 id="テレビの組み込みブラウザ">テレビの組み込みブラウザ</h4>

<p><strong>小崎</strong> 会社での代表作は、パナソニックのテレビのブラウザですかね。組み込み系の。データ放送って 2000 年代くらいから提供されてるんですが、中身は XHTML なんです<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup>。コンテンツは HTML なので、それを表示するレンダリングエンジンの開発というイメージ。通信が一方向というのは帯域の活用という意味では最低 (笑)。パケットを 1 個とれなかったらどんだけロスが起こるか。その当時は機能も少なくてネット対応もしていなかったけど、それを対応させたりといったことをしていました。当時はブラウザの実装と W3C の規格との乖離が大きいし、ブラウザも色々種類があるしで、それぞれの挙動を見ながら規格を読んだりして、また Web ではこういう運用してるからテレビでも同じ運用するように縛りいれようと放送規格にフィードバックしたりして、そういう中で規格の読み方とかについてはだいぶ訓練されたかなあ、とか。</p>

<p><strong>卜部</strong> その経験は今でも役立っていますか？</p>

<p><strong>小崎</strong> 多分。新人の頃、最初の仕事がこの BS デジタル対応だったんです。ブラウザってその当時では組み込みとしてかなり規模が大きくて、それまでが数十 KB で媒体が ROM だったのが、デジタル放送になってフラッシュ 2 MB でコードが 10 万行くらいに。規模の爆発ですよね。大規模ソースコードを見るコツがだいぶ養われた。みんな慣れてないから、ばっかんばっかんバグを埋め込む (笑)</p>

<h4 id="malloc-の解説">malloc の解説</h4>

<p><strong>卜部</strong> なるほど。プログラム以外の代表作は？　動画でもいいですよ？</p>

<p><strong>小崎</strong> 昔 glibc<sup id="fnref:5"><a href="#fn:5" class="footnote">5</a></sup> malloc<sup id="fnref:6"><a href="#fn:6" class="footnote">6</a></sup> を<a href="http://www.youtube.com/watch?v=0-vWT-t0UHg">解説した動画</a>が未だにアクセスがあるみたいで。本人的にはああいうのって、時間が経つと「うおー！　直したい！」ってなるじゃないですか。話的に古くなってる訳ではないけど。</p>

<p><strong>一同</strong> (笑)</p>

<p><strong>卜部</strong> 今からやるなら glibc malloc ではなくて、もっと変な malloc の解説をやるとか？</p>

<p><strong>小崎</strong> 今やるとすれば、jemalloc との比較とか、ウケそうですね。色んな実装を調べて比較したり。</p>

<p><strong>卜部</strong> 非同期割り込み可能な malloc とか楽しそうですね。元 HP で atomic_ops を実装してた Hans Boehm <sup id="fnref:7"><a href="#fn:7" class="footnote">7</a></sup>が書いてたやつですけど。シグナルハンドラの中から malloc が使えるようになる。するとシグナルハンドラの中から printf とかが使えるようになる。</p>

<p><strong>小崎</strong> でも malloc って性能が大事なので。そういうレアなケースで平気になったよと言われても (笑)<sup id="fnref:8"><a href="#fn:8" class="footnote">8</a></sup>。</p>

<h4 id="linux-kernel-watch">Linux Kernel Watch</h4>

<p><strong>小崎</strong> あとは、「<a href="http://www.atmarkit.co.jp/flinux/index/indexfiles/watchindex.html">Linux Kernel Watch</a>」ていう Linux カーネルの連載を Web でしばらくやっていました。</p>

<p><strong>卜部</strong> 続ける予定はないんですか？</p>

<p><strong>小崎</strong> あれは正直ちょう辛い (笑)。仕事でやるなら良いけど、Web 媒体だとほぼ原稿料も入らないし。@IT は出してくれる方だけど、あれだけでは生活は成り立たない。</p>

<p><strong>卜部</strong> るびまでも Ruby の ML の解説を記事化するアイデアがあるんだけど、なかなか難しい。なかなか人がいなくて。Ruby でもそうなのに、Linux カーネルのコミット全部読むなんて死にますよ。</p>

<p><strong>小崎</strong> そんなの Linus でも読んでないよ。つまみぐい。あえて「主要なところだけ」って言いかたはしないけど。そもそも Linux カーネルの主要な所ってどこなんだ、という所から論争があるから (笑)</p>

<p><strong>笹田</strong> メモリマネージメントあたりのコミットはぜんぶ読んでいるのですか？</p>

<p><strong>小崎</strong> 一時期は読んでいたけど、最近は忙しくて全部は読んでいないですね。</p>

<p><strong>卜部</strong> 全部読まなくても仕事はできちゃう？</p>

<p><strong>小崎</strong> 仕事によりますね。今僕がやっている仕事は、コアのどこかを弄っている訳ではないので。どこかのタイミングでキャッチアップは必要になるかも。</p>

<h4 id="ruby-と-linux-への貢献">Ruby と Linux への貢献</h4>

<p><strong>郡司</strong> 代表作といえば、Ruby で問題になっていた所を Linux のバグとして直す、みたいなのがありましたよね。</p>

<p><strong>小崎</strong> わりと何個もあるので、どの話だろう (笑)。一番最初のは、select(2) で書き込み可能待ちをすると Linux の時だけハングすると akr <sup id="fnref:9"><a href="#fn:9" class="footnote">9</a></sup> さんに教えてもらった現象があって。Linux の仕様だったんだけれども Ruby で都合が悪いから Linux の仕様を変えてもらって、全世界の Linux ユーザーに恨まれるという (笑)<sup id="fnref:10"><a href="#fn:10" class="footnote">10</a></sup>。違いますね、きっと感謝されている、はず (笑)</p>

<p><strong>卜部</strong> もともとハングしていたものが、ハングしなくなったんだから。</p>

<p><strong>小崎</strong> そうですよね。僕も当時その理屈を使って説得したはず。Ruby の場合はどこにもドキュメントで保証されてない挙動についてオレの思ってた動きと違うからカーネル変えろとか言ってくるので色々言われました。テストケースで fadvise を使ってるから困るとか。</p>

<p><strong>卜部</strong> レアですね。いったいどういうケースなんだ？</p>

<p><strong>小崎</strong> <a href="http://docs.ruby-lang.org/ja/2.1.0/method/IO/i/advise.html">IO#advise メソッド</a> とかのテストコードでしょう。Linux の場合は、共有メモリファイルシステムなど一部のファイルシステムについては fadvise で先読みするメリットがないので、ENOTSUP とか特殊なエラーコードを返していた。Ruby 側ではそれを受けてシステムコールが失敗したら例外を投げる想定だったという話になって。じゃあ Ruby 側でも例外があがって嬉しいかというと、全く嬉しくない。ので非サポートの場合はエラーを返さないというふうに Linux の仕様を変更した。Eric Wong<sup id="fnref:11"><a href="#fn:11" class="footnote">11</a></sup> と一緒に (笑)</p>

<p><strong>卜部</strong> 代表作たくさんあるじゃないですか。<a href="http://mkosaki.blog46.fc2.com/">ブログ</a>もありますよね？</p>

<p><strong>小崎</strong> 最近はブログよりも <a href="http://togetter.com/id/kosaki55tea">Twitter で呟いてそれをまとめるだけ</a>という簡単な方法に (笑)。あと、Ruby の <a href="http://docs.ruby-lang.org/ja/2.1.0/method/IO/s/select.html">IO.select メソッド</a>について、POSIX の仕様からは若干逸脱した作りになっていて。POSIX では fd_set はスタック上に置く前提だから C 言語の制約で固定長にせざるを得なくて、ファイルディスクプリタの最大数が 1024 なんだけど、Linux でサーバやるときとかそれでは全然足りないから、みなさんカーネルパラメータをそれよりたくさんに変更してるんですよ。それで回避策としては一番お手軽なのは epoll(2) に移行することなんだけど、 Ruby の場合は別の解決策をとっていて、ファイルディスクプリタのビットマップだけを malloc でとってそれを渡すことをやっている。でも最近 glibc 側で select に渡すファイルディスクプリタの最大値をチェックして、1024 を超えていたら abort するというロジックを入れた方がいらっしゃいまして。</p>

<p><strong>卜部</strong> 正しくないコードを見つけたときに、ライブラリの側でどう処理するべきかという議論が最近ありますよね。</p>

<p><strong>小崎</strong> 最近の流れとして「セキュリティ的な意味で悪用されたら問答無用で処理を中断する」という方針がある。select も同じで、全然違うメモリ領域を buffer overflow で書かせる事ができてしまう。glibc 側でもこの理由があってチェックを入れたんですよね。</p>

<p><strong>卜部</strong> 「どのファイルディスクプリタにビットがたっている」なんて制御できない<sup id="fnref:12"><a href="#fn:12" class="footnote">12</a></sup>から、現実問題怪しげな事はどれくらいできるのか。任意のメモリ領域に書き込む事が出来るというのは理解できるけど、じゃあそれで具体的にどう攻撃できるのか。</p>

<p><strong>小崎</strong> 俺もそう思う (笑)。でも glibc 側としてはそれはデフォルトでは OFF なんだよね。 _FORTIFY_SOURCE の設定で引数チェックをしていて、ON の時だけ追加でチェックをかけるから、それが嫌なら外せばいいじゃないかと言うんですね。
でも Ubuntu では gcc のコンパイルオプションを独自に変えていて、そこの設定がデフォルトで ON になっている。</p>

<p><strong>卜部</strong> Ubuntu は最近は EGLIBC に流れているのでは。</p>

<p><strong>小崎</strong> EGLIBC は glibc から派生したプロジェクトだけど、glibc の側のメンテナが交代した関係で最近また仲直りしたので、再統合しそう。<sup id="fnref:13"><a href="#fn:13" class="footnote">13</a></sup></p>

<p><strong>卜部</strong> GCC もそうだよね。昔 EGCS というバージョンがあった。モチベーションが尽きたときに放置されることも多いけど、本家に合流というのも良くある話。フォークした後もどちらもアクティブに開発し続けるというのが超レアなんですよ。XEmacs や BSD 位ですよね。</p>

<p><strong>小崎</strong> 確かにね。そんなこんなで Ruby 界隈では Linux プラットフォームメンテナーという称号を頂戴しておりまして、バグが起票されたときにプラットフォームが Linux って書いてあると俺が見ないといけない (笑)</p>

<p><strong>卜部</strong> だいたい Linux じゃないですか。</p>

<p><strong>一同</strong> (笑)</p>

<p><strong>小崎</strong> 理不尽に思う事も多くて。さっきの glibc の select の仕様が変わってましたとか、普通に使っていたら気がつかないだろ！　っていう。誰に振れば良いのか極めて難しい。</p>

<p><strong>卜部</strong> それで select はどうやって解決するつもりなんですか？</p>

<p><strong>小崎</strong> 今は Ruby 側に workaround が入っているんだけれども、もうすぐ glibc 側を変えるパッチがマージできそう。</p>

<p><strong>卜部</strong> -D_FORTIFY_SOURCE=2 になっていても、それを無視するような？</p>

<p><strong>小崎</strong> まだ確定ではないけれど、もう一個 ON OFF のフラグをつけようかという話が進んでいる。-D_FORTIFY_SOURCE=2 はみんな ON にしたいから OFF したときにどうするのかと。もう一個フラグを作ってそっち側でフラグを OFF にしておけば解決できるかなという話。</p>

<p><strong>卜部</strong> でも Ubuntu ではデフォルトで ON になってしまう？</p>

<p><strong>小崎</strong> それは Ruby 側で上書きすれば済む話なので。select.h を読む前に #undef しておくと。超苦労した所は、Ruby ってなぜか GCC は -include を使うので真っ先に select.h が include されてしまう仕様になってる。なので泣きながら -include 周りを変えまくって。<a href="../../articles/0009/0009-Hotlinks.html">中田さん</a>に戻されて。また壊れて。みたいな (笑)。しばらくせめぎ合いました。</p>

<p><strong>笹田</strong> でもそれで直るなら、glibc に手を入れる必要はなかったのでは？</p>

<p><strong>小崎</strong> Ruby では確かに直るけれども理由が 2 つあって、1 つ目は、Ruby 以外にも困ってるプロダクトはあるはずということ。もう 1 つは _FORTIFY_SOURCE が OFF ってことは、すべてのチェックが OFF になってしまう。でも Ruby が OFF にしたいのは select の件だけ。あと poll(2) に変えればいいという意見も貰ったんだけど、poll と select とセマンティクスが違うので。</p>

<p><strong>笹田</strong> 無理矢理シミュレーションする必要がある？</p>

<p><strong>小崎</strong> Linux だとそれらのメソッドがカーネル内で合流しているからシミュレーション出来るんだけど、System V 系だと中の処理が全く別物で、どうやってもシミュレーションできないケースが発生してしまう。Regular file とかの超王道はいいとしても tty とかは歴史的な理由という名の下に、どうしようもない (笑)。メソッド名が select である以上、select セマンティクスを期待するのは極めて自然な訳ですよ。なので、もしやるのであれば Ruby のなかで select バージョンと poll バージョンを 2 つ作ってどっちもメンテしないといけなくなるから、それは避けたいね、と。</p>

<p><strong>nari3</strong> ライブラリを変えよう、という発想には普通ならない気がします (笑)</p>

<p><strong>小崎</strong> いやいやそんなことないですよ。<a href="../../articles/0037/0037-Hotlinks.html">松田さん</a>だって、作っている Rails アプリが思う通りに動かないと Rails を変えると言ってましたよ<sup id="fnref:14"><a href="#fn:14" class="footnote">14</a></sup>。</p>

<p><strong>nari3</strong> 本人が Rails の開発をやっているから、というのもありそうですね。</p>

<p><strong>小崎</strong> 確かに。システム開発者やカーネル開発者から見ると、こういう使い方もあるんだっていう知見をくれる人は重要なんですよ。ユースケースがふにゃふにゃしていると議論が迷走しがちですから。そんな感じのバトルが他にも色々あったりなんだけど、だいたいうまく収まっていて、最近は Linux は Ruby に最適なプラットフォームです。なぜなら Ruby の都合で Linux 変えちゃうからと言ってます。宣伝宣伝 (笑)</p>

<p><strong>卜部</strong> 昔 Ruby で sprintf を #define していた時期があるんですよ<sup id="fnref:15"><a href="#fn:15" class="footnote">15</a></sup>。Linux で -D_FORTIFY_SOURCE=2 にすると、glibc で引数チェックのある sprintf に #define してしまう。 #include 順序によってどっちになるのか変わってしまって、とあるファイルでは死ぬけど別のファイルでは死なないというという話になって。辛かったですね。結局 ./configure で回避した記憶があります。</p>

<p><strong>小崎</strong> そうやって下回りの開発者がいると、割とすぐに分かるんだけれどね。</p>

<p><strong>卜部</strong> gcc -E でマクロ展開して、ようやく全部気づいたレベルです。ちょうつらい。</p>

<p><strong>小崎</strong> Ruby さんはマクロを使い過ぎ (笑)。変な置換とか。アプリから libruby.so をリンクしている人は辛いだろうなって思います。close を ruby_close に差し替えるとか、あの辺はすごいなと思ったけど。malloc とか sprintf みたいに差し替えるのは良いんだけど、拡張ライブラリとか、libruby を使う他のアプリがみえるような公開ヘッダーで差し替えるのがすごいなっていう。Ruby の中で完結していない。普通プライベートヘッダーでやるだろう、っていう。</p>

<p><strong>卜部</strong> 難しい話で。プライベートヘッダーに書いてしまうと、デバッガとかプロファイラとかやる人達からは拡張ライブラリの側から見せてくれという話になったり。なので結構せめぎあいなんですよね。「Ruby の AST ライブラリを作った」と言われて見てみると、Ruby のヘッダーが丸ごとコピペされていたり。</p>

<p><strong>小崎</strong>  (笑)。でも他に方法はないですよね。</p>

<p><strong>卜部</strong> 全部公開して「それを使ってね」とするか、隠しておいてコピペされるのを諦めるか。</p>

<p><strong>小崎</strong> 今は ruby.h が #include されて全部取り込まれちゃう。「手動で #include したときだけ追加のヘッダーが入る」って方法だと良さそうなんだけど。</p>

<p><strong>卜部</strong> 確かに。昔は ruby.h が小さかったから良かったのかもしれない。Ruby のソースコードが大きくなるにつれて、そういう問題も出てきていますね。Ruby が小さかったときは 1 ファイルに全部書かれていて、コントロールできていたんだけれど。</p>

<h3 id="ruby-に関して">Ruby に関して</h3>

<h4 id="rubyist-になったきっかけ">Rubyist になったきっかけ</h4>
<p>: <img src="http://lh3.googleusercontent.com/-AKpoaN5mMZs/UoYvwljWClI/AAAAAAAA13k/yiXjB5qu6Kw/s400/DSCI3741.JPG" alt="DSCI3741.JPG" /></p>

<p><strong>卜部</strong> そもそも Ruby をやるようになったきっかけは？</p>

<p><strong>小崎</strong> 当時カーネル開発をしていて、どうもユースケースに疎い部分があるなと感じて。なにかプロジェクトに参加したいなと思いつつ、忙しさもあって実行に移せていなかったんです。
そんな時たまたま Ruby の IRC に入ったときに「Ruby が全く分かっていない」という話をしたら、shinh <sup id="fnref:16"><a href="#fn:16" class="footnote">16</a></sup>さんという方が Ruby の Hello World の書き方を教えてくれて。そのときは C しか分からなくて、ライトウェイト・ランゲージとか全く分からない状態だったんだけれど、「<a href="http://shinh.skr.jp/dat_dir/mederu/028.html">Ruby は C と同じだ</a>」と言われて。彼は polyglot のエキスパートでもあるから、その場で <a href="http://shinh.skr.jp/dat_dir/mederu/029.html">C と Ruby の両方で valid なプログラム</a>を書き始めて。「ほら同じでしょ」とか言いながら #include &lt;stdio.h&gt; とか見せるわけ。# がコメントとか知らないから「おおー、おなじだー」とすごく感動して、俺でも出来そうだ、と。</p>

<p><strong>一同</strong> (笑)</p>

<p><strong>小崎</strong> Ruby は printf も exit もあるし。int main は書けないけども main の中では exit が書けるんですよ。int が NoMethodError になる前に、exit で閉じてしまう。</p>

<p><strong>一同</strong> (笑)</p>

<p><strong>小崎</strong> なので Ruby でも C でも正当なコードは書けるんだけれど、それを教えるかっていう (笑)</p>

<p><strong>卜部</strong> Rubyist になったキッカケは、だいたい浜地さんのせいだと。</p>

<p><strong>小崎</strong> (笑)。3 年くらい前ですかね。気持ち的にはまだ新人のつもりなので、Ruby Prize とか来年また応募したいですね。<a href="http://www.ruby.or.jp/rubyprize2013/">今年</a>も応募したけど、かすりもしなかった。<a href="http://rubyprize.uvs.jp/win_chikanaga_01.html">受賞した近永さん</a>とかラスボス度が高すぎて。</p>

<h4 id="好きなメソッドと嫌いなメソッド">好きなメソッドと嫌いなメソッド</h4>

<p><strong>小崎</strong> 文字列操作や正規表現は C よりも楽になってるから好きですね。嫌いなメソッドはいっぱいあるけど、一番嫌なのは <a href="http://docs.ruby-lang.org/ja/2.1.0/method/Thread/i/raise.html">Thread#raise</a> とかのスレッド周りのおかしな仕様 (笑)。raise して何が嬉しいのっていう。</p>

<p><strong>卜部</strong> Thread#raise は悩ましいですよね。外に向かってスレッド間通信の代わりに使えるんですよね。</p>

<p><strong>小崎</strong> Thread#raise はタイミングが選べないから、スレッドを殺したいときにしか有用じゃないんじゃないかなと。スタック上に実行履歴が積まれていて巻き戻すときには意味があるけど、他のスレッドに raise させるっていうのは巻き戻しとは違うセマンティクスなので、あんまり使い道がない。まず名前から気に入らない (笑)</p>

<p><strong>卜部</strong> その昔、タイムアウトを実行しようとすると Thread#raise を使うしかなかったと聞きますね。タイムアウトなら待ってる方のスレッドは既に止まっているので、そこに raise してもあまり問題がなかったので。</p>

<p><strong>小崎</strong> タイムアウトもあれはあれで、もうちょっとなんとかならんのかと思うけど。Ruby は 1.8 以前と 1.9 以降でスレッドの仕様が大きく違うので、いろんな矛盾がね。1.8 ではグリーンスレッドが表に見えちゃって、API 仕様はまあありかなと。<a href="http://docs.ruby-lang.org/ja/2.1.0/method/Thread/s/exclusive.html">Thread.exclusive</a> するのもある意味アリだよね。1.8 のスレッドを最初に読んだときは、ここまで割り切るのもアリなんだ、と、その時はプラスの評価だったんですよ。1.9 で Thread.exclusive はない。</p>

<p><strong>笹田</strong> がらっと変えたけど、全然苦情来てない。だれもそこまで真面目に使っていない。</p>

<p><strong>小崎</strong> Mutex 待ちをしている所に ^C したらロック取らずに抜けてくるとか。これはまだ例外があがってくるけど、条件変数で ^C したときには例外があがってこない。</p>

<p><strong>卜部</strong> 嫌いな所はスレッド、と。</p>

<p><strong>一同</strong> (笑)</p>

<p><strong>小崎</strong> それも難しくて、Ruby に Thread クラスがなかったら俺コミッターになれなかった気がする。自分がソースコードを見て明らかにおかしい所が残ってないとコミット無双モードに入れない (笑)</p>

<p><strong>nari3</strong> Ruby のソースコードはどのくらい読んでるんですか？</p>

<p><strong>小崎</strong> そんなに読んでない、得意分野だけ。僕がよく直してる <a href="https://github.com/ruby/ruby/blob/trunk/process.c">process.c</a> や <a href="https://github.com/ruby/ruby/blob/trunk/io.c">io.c</a>、<a href="https://github.com/ruby/ruby/blob/trunk/thread.c">thread.c</a> とか。システムコールから遡って読んでいくだけだから。</p>

<p><strong>笹田</strong> あまりそういう読み方はしない (笑)</p>

<p><strong>小崎</strong> まあ grep かけたところから。Ruby の <a href="https://github.com/ruby/ruby/blob/trunk/parse.y">parse.y</a> から初心者が入ろうと思ったら、結構きついと思う (笑)</p>

<p><strong>卜部</strong> 挫折する人結構いますよ。parse.y とか。</p>

<p><strong>小崎</strong> <a href="http://codezine.jp/article/detail/4515">笹田さんと一緒に学生向けのプログラミングキャンプをやったことがある</a>んだけれど、学生さんは文法拡張したがるから、あそこは避けられない。でもなぜその魔窟を選ぶのかと。残り数時間で (笑)</p>

<p><strong>卜部</strong> 文法もなんとかしたいですけどね。でも「文法をなんとかしたい」と「スレッドと割り込みをなんとかしたい」というのを比べると、割り込みの方をなんとかした方が、と思っちゃう。文法はそこまで困らない。</p>

<h4 id="現在の-ruby-とのつきあい方">現在の Ruby とのつきあい方</h4>

<p><strong>小崎</strong> <a href="https://bugs.ruby-lang.org/">バグ登録</a>を監視していて、プラットフォーム Linux の申告があると確認する。あとは ABI 非互換を検出する仕組みを作っていて <a href="http://rubyci.org/">RubyCI</a> に組み込んだり。リリースのときに非互換が出ないようにする仕組みを機械的に作ったりとか。機械的チェックはやっぱり必要ですよね。</p>

<p><strong>卜部</strong> 昔はそういうツールがないのに ABI 非互換はありませんとか。言っちゃった以上やる他ないので結構大変でした。Ruby のスクリプトでアプリを作って使うというような事はあまりしない？</p>

<p><strong>小崎</strong> そうですね。カーネルを直したときに、デバッグのテストツールで出力したログに対して、おかしな組み合わせを検出したり、というのはやってますね。さっきも言った文字列操作や正規表現がありがたいっていうのは、このあたりかな。</p>

<h4 id="ruby-を使って成功した事例">Ruby を使って成功した事例</h4>

<p><strong>小崎</strong> 成功した事例ってほどでもないけど、さっき言ったテストツールかな。日々の検証で地道に使っています。テストツールはバグ発見というよりも修正できたかの確認。自分はバグを発見するタイプではないので。</p>

<p><strong>卜部</strong> 田中さんは自分でバグを発見するタイプですよね。</p>

<p><strong>小崎</strong> そもそもなぜそのテストをしようと思ったのか、っていう (笑)。どうやったらその発想ができるのか。正解を知って逆算してるのでは、と思ってしまったり。たまに自分もしますけどね。ソースコードを追って怪しそうな所を見つけてから狙い撃ちしたり。</p>

<p><strong>一同</strong> (笑)</p>

<p><strong>小崎</strong> 数少ない Ruby への貢献では、昔は Ruby って大きい文字列を作るといろんなメソッドが落ちてたんです。原因は alloca を使っていたので、スタックがあふれるという単純なものだった。その辺はソースコードを見ながら alloca を使っている所を狙ってテストケースを作り報告しましたね。結局中田さんが必要な所は malloc を使うように修正してくれたり。</p>

<p><strong>卜部</strong> 配列はまだ大きいと落ちちゃうんですよね。大きい配列をスプラットに渡そうとするとスタックがあふれて落ちる。お話しいただいたのはマシンスタックの話で、これは VM スタックの話なので、別ですが。たしかにマシンスタックの alloca はもうないですよね。結局 alloca の引数に外から来た任意の引数を渡してしまうとまずいという話で、固定長はまだ残ってたかな。</p>

<p><strong>小崎</strong> そこから数年経った今まさに glibc でも同じ話になっていて。インプットをそのまま alloca に渡していて、一掃作戦をかけています。　</p>

<p><strong>卜部</strong> alloca 使いたい気持ちも分かるけど、前後にチェックを挟むとそこまで速くならないし。</p>

<p><strong>小崎</strong> そうですか？　ぜんぜん速度違うと思うけどな。malloc したら CPU とかロック競合を考えないといけない。Ruby みたいに GVL だから関係ないのかもしれないけど。</p>

<p><strong>卜部</strong> alloca だと、alloca 出来ないときにどうするのか考える必要があるのが手間かなと。スタック足りなかったりとか。</p>

<h4 id="キラーアプリ">キラーアプリ</h4>

<p><strong>卜部</strong> 自分のとってのキラーアプリとは？</p>

<p><strong>小崎</strong> アプリではないけれど <a href="https://github.com/">GitHub</a> ですね<sup id="fnref:17"><a href="#fn:17" class="footnote">17</a></sup>。僕の人生を変えかねない位のインパクトが。</p>

<p><strong>卜部</strong> Linux って GitHub をどれくらい使ってるんですか？</p>

<p><strong>小崎</strong> ほとんど使ってない。個人的には、カーネルは色んなマシンでテストしたくなる訳だけど、色んなマシンに push できて超便利とか。後は人様のプロジェクトを見るときに分かりやすい。ブラウザで見れるし。GitHub なかったら、Git の普及ってもっと遅かったと思う。コマンドだけだと何を操作しているのかイメージしづらいし。GitHub は目で見て分かる。Git のコマンドって便利だけど理解するまでが (笑)。GitHub だとワンクリックで fork が出来る。</p>

<p><strong>nari3</strong> この間 Mozilla のリポジトリに使ってないマクロがあって。消すためのパッチを作ろうとすると、Mozilla は独自のバグトラッキングシステムを持っていて、再現性を問われたりアカウントを作らないといけなかったり。結局マクロ 1 つ削るのに 3 ヶ月もかかりました。GitHub にあればいいのにって (笑)</p>

<p><strong>小崎</strong> Mozilla はレビューの割り振りが均等でない感じがする。</p>

<p><strong>卜部</strong> あと、GitHub を使っている人はコミットログをちゃんと書いてほしいですね。「#123」みたいに書いてる人がいるんだけど、GitHub だとリンクとして表示されるけど、他では困ってしまう訳で。ちゃんと書いてほしい。</p>

<p><strong>小崎</strong> キラーアプリはその位かな。Ruby 界隈では <a href="http://www.tdiary.org/">tDiary</a> を使っていないと Rubyist を名乗れない、みたいな感じがありますけど。僕使ったことなくて。</p>

<p><strong>卜部</strong> いやいや。そんな事ないですよ (笑)</p>

<h4 id="ruby-の習得は簡単でしたか">Ruby の習得は簡単でしたか？</h4>

<p><strong>小崎</strong> 何一つ分からないのでソースコードを読むまで分からなかった感じですね。</p>

<p><strong>卜部</strong> メソッドの振る舞いの話ですよね。文法はどうですか？</p>

<p><strong>小崎</strong> 文法は完全に理解してないですよ。複雑な事はしていないし。Ruby のテストプログラミングに頼っているので、そこで使っていない <a href="http://docs.ruby-lang.org/ja/2.1.0/method/BasicObject/i/method_missing.html">method_missing</a> みたいなメタプログラミング系の知識は未だに全然ないです。</p>

<h3 id="プログラミング全般">プログラミング全般</h3>

<h4 id="ruby-以外のプログラミング言語あるいはテストの話">Ruby 以外のプログラミング言語あるいはテストの話</h4>
<p>: <img src="http://lh3.googleusercontent.com/-HkeMMmEOldc/UoYvx1ZhIqI/AAAAAAAA13w/-z5sn2ash1Y/s400/DSCI3743.JPG" alt="DSCI3743.JPG" /></p>

<p><strong>卜部</strong> Ruby 以外のプログラミング言語は何を？</p>

<p><strong>小崎</strong> 普段使いは Linux のカーネルのテストを C で書いてます。Linux 独自のシステムコールは C からしか叩けないから、もう得手不得手関係なしに C。</p>

<p><strong>卜部</strong> それはテストケースの話ですよね。テストドライバーみたいなものは無いんですか？</p>

<p><strong>小崎</strong> 無いでーす。一つひとつ手で実行する。Linux にも LTP っていうテストプロジェクトはあるけれども、Linux の中心的開発者で使っている人は見たことはありません。
みんな自分が作ったところは自分の手でテストしている。</p>

<p><strong>nari3</strong> Ruby は大きな修正の時にテストを走らせないでコミットすると怒られますね。</p>

<p><strong>小崎</strong> Linus さんがテストしないでコミットする人だからしょうがない。</p>

<p><strong>nari3</strong> どっかで聞いた話ですね (笑) <sup id="fnref:18"><a href="#fn:18" class="footnote">18</a></sup></p>

<h4 id="レビューをするかチケット管理をするか">レビューをするかチケット管理をするか</h4>

<p><strong>卜部</strong> GitHub が出てくるまでは Ruby ではあんまりレビューをしなかった。パッチを送ってきてレビューするという文化がない。コミットしてからバグに気づく。
その代わりちゃんとチケットを管理している。</p>

<p><strong>小崎</strong> Linux で偉いのはパッチをメイリングリストに投げてみんなでレビューしているところ。
Ruby は仕事じゃないのにリリース前にチケット総ざらえするのが偉いよね。
kernel.org にもバグ管理システムはあるんだけどだっれも見てへん。Linus が見てない以上……。</p>

<p><strong>笹田</strong> そういう意味じゃ、まつもとさんも見てないじゃん。</p>

<p><strong>一同</strong> (笑)</p>

<h4 id="linux-界隈と-ruby-コミッター界隈の文化の違い">Linux 界隈と Ruby コミッター界隈の文化の違い</h4>

<p><strong>nari3</strong> Linux 界隈と Ruby コミッター界隈の文化の違いとかありますか？</p>

<p><strong>卜部</strong> 日本語が通じるかどうか？</p>

<p><strong>小崎</strong> Ruby の方がコミッターどうし仲が良いかな。IRC でだべってるし、数も多くないし。顔を覚えなくちゃいけないのは 30 人くらい。
いっぽう、Linux は名前覚えなくちゃいけないのが 200 - 300 人くらい。
カーネルサミットの会場に限界があって 80 - 100 人くらいしか呼べない。どういう基準で選んでも居ないやつがいるから議論が成立しないんですよね。</p>

<p><strong>卜部</strong> まあしゃあないですよね。世界中から 300 人とか呼んでもみんなは来られない。</p>

<h4 id="カーネルサミット">カーネルサミット</h4>

<p><strong>nari3</strong> カーネルサミットはどこでやるんですか？</p>

<p><strong>小崎</strong> 全世界を転々と。今年はイギリス、去年はアメリカだったと思う。日本でやったこともあるじゃないですか。</p>

<p><strong>郡司</strong> Linus が来て、よしおかさんがカーネル読書会に呼んで<sup id="fnref:19"><a href="#fn:19" class="footnote">19</a></sup>。</p>

<p><strong>小崎</strong> Windows 7 の発売セールやってるアキバのヨドバシで親指を立てて (笑) <sup id="fnref:20"><a href="#fn:20" class="footnote">20</a></sup>
カーネルサミットは年 1 回やってます。毎回行ってるわけじゃないけど。発表したこともあったかもしれないけど英語がよくわからないとかいって同僚の誰かに押し付けることが多い。</p>

<p><strong>笹田</strong> 行くと 300 人くらいいて顔と名前は一致する？</p>

<p><strong>小崎</strong> 残念ながらほとんどわかってへん。向こうから話しかけてきた人だけは、顔と名前が一致する。</p>

<p><strong>菅井</strong> RubyKaigi とかだと Ruby を作ってる人も使ってる人も来るけれど、カーネルサミットは？</p>

<p><strong>小崎</strong> Linux を作ってる人も全員来られるわけじゃないけれど、サブシステムごとにミニサミットをやっている。
一番大きいのは LSF/MM (ストレージ、ファイルシステム、メモリ)。それが 60-80 人くらいで、僕も毎年呼ばれてるので、年に一度ツイートしてると思います。
「今年はこういうことやることになりました」って。</p>

<p><strong>卜部</strong> と言ったはなしを、「Linux Kernel Watch」で書いてくれれば良いんだけど。</p>

<h4 id="c-以外の言語は">C 以外の言語は？</h4>

<p><strong>小崎</strong> 昔は C++ とか Java とかホビーに使ってたけど使わなくなったなあ。
大学生とか新人の頃に Java が流行り始めて。Ruby のスレッドは明らかに Java からの影響を感じられるよね。</p>

<p><strong>卜部</strong> Java でアプリケーションを書こうと思ったことは？</p>

<p><strong>小崎</strong> Java とカーネル屋さんの二足の草鞋を履くには JVM を知らないといけないからちょうつらい。
ちょっと時間ができたから見てみよっかなー、というには太刀打ちできないレベルになってる。
Ruby は行数を見て、ああこのくらいだったら理解できるかな、と。</p>

<p><strong>卜部</strong> さっき言ってたテレビのブラウザは？</p>

<p><strong>小崎</strong> C。組み込みはほとんど C。C でブラウザを書くのはつらいけれど、Mosaic の頃は C で、どこかで分岐した Mosaic が組み込みでは延々と使われている。</p>

<p><strong>卜部</strong> バグってても武器が無さすぎてどこでメモリが壊れてるかわからないですよね？</p>

<p><strong>小崎</strong> それは Ruby も一緒じゃん。</p>

<p><strong>卜部</strong> でも Ruby はどこを注目すれば良いかはある程度明らかですよね？</p>

<p><strong>小崎</strong> それは結局ソースコードを習熟すれば明らかだということ。結局最初はちょうつらいんだけども、ソースコードを何回も読んでると、だいたいこの辺じゃないの？　というのがだんだんわかってくるので。</p>

<h4 id="文字列操作">文字列操作</h4>

<p><strong>卜部</strong> あまり僕は C では文字列操作はやりたくないな。</p>

<p><strong>小崎</strong> 特に web 系の文字列操作はね。
Ruby のパーズが幸せなのは、文字列が全部そろってから始められること。
組込みブラウザの時は、パケットが全部来てなくてもパーズを始めなくちゃいけないじゃん。
次のパケットが来たら、「解釈間違ってましたぁ」みたいなことも起きるし、</p>

<p><strong>卜部</strong> そこそこ速く動かなくちゃいけないので、先頭からやりなおすわけにも行かないし。</p>

<p><strong>小崎</strong> バッドノウハウの塊なので、心を無心にして読まないと、むきーって。
でも、当時はわからなかったけれど、ブラウザの世界はけっこう狭いから、人の交流のせいで似た設計になる。ひとつ理解すると、他社のブラウザもわかる。</p>

<h4 id="ソースコードの行数">ソースコードの行数</h4>

<p><strong>卜部</strong> ところで Ruby のソースコードの行数は、C の部分で 20 万行ぐらいでしたっけ。</p>

<p><strong>小崎</strong> ユーザー空間でそれはずいぶん少ない。OpenOffice は 1 千万って聞いたけど。</p>

<p><strong>卜部</strong> コンパイルする時間を考えても。OpenOffice は一日がかりだしね。
Gentoo っていうディストリビューションがあって、だいたい全部コンパイルするので、絶対的な行数はわからないけれど、相対的な規模がそれなりにわかる。
Emacs とカーネルは同じくらいとか、それに比べて ghc は明らかに遅いとかわかって楽しい。
今は日和って Ubuntu を使ってますけど。</p>

<p><strong>小崎</strong> そういう意味では Linux もずいぶん小っちゃくって、ドライバを全部合わせて 1 千万レベルだから、
カーネルのコアだけなら数万行で Ruby とそんなに変わらない。</p>

<p><strong>笹田</strong> 目的があれば見てみようかな、っていうレベルですね。</p>

<p><strong>卜部</strong> システムコールは読みたくないな。土地勘ができるまで大変。libc なら土地勘があるんだけど。</p>

<h4 id="美しいソースコード">美しいソースコード</h4>

<p><strong>卜部</strong> 今まで読んだなかで最も美しいソースコードは何ですか？</p>

<p><strong>小崎</strong> 感銘を受けたのは『<a href="http://en.wikipedia.org/wiki/Lions%27_Commentary_on_UNIX_6th_Edition,_with_Source_Code">Lions’ Commentary on UNIX</a>』。Unix like operating system に対する土地勘がたったの 1 万行のソースコードで得られる。
もうひとつ挙げるとすれば X<sup id="fnref:21"><a href="#fn:21" class="footnote">21</a></sup>。今から見るとちょう汚ないんだけど、業務で普段みてるヘッポコソースと比べると突然まったく関係ない処理が顔を出さないので感動した。まあフォローしておくと、組み込みはいろんな事情があって汚くなるのは避けられないんだけど。</p>

<h4 id="テレビの規格">テレビの規格</h4>

<p><strong>小崎</strong> そういえば、テレビの描画は X のプロトコルでやってる。X にはエクステンションがいろいろあって、僕が選んだのは横に 2 画面あるのを同じ座標に 2 画面重ねるようなもの。テレビは日本の規格では、昔のゲームのスプライトみたいのを 5 画面重ねてる。動画、JPEG 用、データ放送用 (文字とか PNG の軽いやつ)、あと、字幕が 2 つ。字幕は、番組連動のものと、野球速報や地震津波の警告みたいに番組に連動していないものと。こうしておくと録画した番組を見ているときは速報字幕みなくてすむからって。でも、せっかく規格をつくったのに結局実際の運用では、地震警告は動画にはりついてる。録画とかしたものに変な警告が張り付いちゃってるのは、元テレビ屋さんとしては残念。せっかく苦労して仕組みつくったのにって。</p>

<p><strong>郡司</strong> それは全部のテレビに実装されていないから？</p>

<p><strong>小崎</strong> いやいや。アナログテレビはもう無いし、デジタルテレビは全部実装されてる。</p>

<h4 id="今興味があること">今興味があること</h4>

<p><strong>卜部</strong> 今興味があることは何ですか？</p>

<p><strong>小崎</strong> トランザクション・メモリ。Haswell が発売されたので何かネタないかなと。Linus 先生が VFS のロックを書き換えてちょう速くなったって言ってた。UNIX のファイルシステムは全部ルートからつながってるからルート近くでロックが競合する。実際にはファイルはほとんど競合しないから、楽観的な仕組みにすればすごく性能が上がる。そんなわけでトランザクション・メモリとはすごく相性が良いんです。</p>

<p><strong>卜部</strong> じゃあ効くところでは効くっていう感じですね。Intel が入れると言った時は本気か？　と思ったけどアリなのかもねという感じもしてきました。Haswell の入ってる Mac とか。</p>

<p><strong>小崎</strong> MacBook Pro。欲しいんだけど高くて買えない。</p>

<p><strong>卜部</strong> 何かのグラントをもらって買えばいいんじゃないですか？　「とりあえず Ruby を速くします」って Kickstarter に登録してみるとか。</p>

<p><strong>小崎</strong> それでできなかったら、恥かしいね。もう 1 個やりたいのは glibc malloc の高速化。jemalloc や tcmalloc より遅い理由を何個か知ってるけど upstream にコミットできていないので、そのうちやりたい。</p>

<h4 id="gnu-プロジェクトへの著作権の譲渡">GNU プロジェクトへの著作権の譲渡</h4>

<p><strong>小崎</strong> でも GNU の場合は面倒くさい。ほとんどの会社では、従業員が業務時間内に書いたコードの著作権は会社のものになる。そのコードが業務時間外に書かれたものだという証明は困難なので、GNU にコードを貢献するには、フリーランスでもない場合は、会社の責任のとれる人のサインがないとコードを受け付けてくれないんだよね。VP レベルの人のサインが必要なので、特に弊社みたいな大企業だと結構大変で。偉い人すぎるとね。</p>

<p>(後編に続く)</p>

<h2 id="途中で">途中で</h2>

<p>小崎さんインタビューの前半はここでおしまいとなりました。
翌日おこなわれた後編のインタビューに続きます。お楽しみに。</p>

<p>(インタビュー：卜部、テープ起こし＆編集：小林、zunda)</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>インタビュー前編では欠席 <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>インタビュー前編は 11 月 9 日に行われました <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>MIT とかハーバードとかがあるところ。クトゥルフものでよく出てくるアーカムという架空の町のモデルになったセイラムという魔女狩りがあった町も近い <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:4">
      <p>正確には BML という XTHML もどき。テレビ用にいろいろ拡張されてる <a href="#fnref:4" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:5">
      <p>GNU C Library のこと。GNU プロジェクトにおける C の標準ライブラリ http://www.gnu.org/software/libc/libc.html <a href="#fnref:5" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:6">
      <p>C 言語でメモリを動的に確保する関数。glibc に含まれている。 <a href="#fnref:6" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:7">
      <p>この解説は嘘ではないが、BoehmGC の作者と言った方が実はこのインタビューの参加者にはとおりがよかったかも <a href="#fnref:7" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:8">
      <p>などと言っていたら glibc malloc に対しても同様の提案が libc コミュニティで出てきてびっくりした <a href="#fnref:8" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:9">
      <p><a href="../../articles/0008/0008-Hotlinks.html">田中哲さん</a> <a href="#fnref:9" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:10">
      <p>るびまの記事「[[0044-CRubyCommittersWhosWho2013#l10]]」も参照 <a href="#fnref:10" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:11">
      <p>Unicorn の作者として有名。ごく最近 Ruby のコミッターにも就任。 <a href="#fnref:11" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:12">
      <p>select はディスクリプタが読み書きできるようになった瞬間にビットがたつ。だからたとえばソケットが読み込み待ちとかのときは立たない。そんなもんで任意の場所を任意のビットパターンにするのは至難の技かと <a href="#fnref:12" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:13">
      <p>原稿を書いてる間に開発停止の表明が出てしまいました。 https://sourceware.org/ml/libc-alpha/2014-02/msg00060.html 現在 eglibc の Web ページトップにも “EGLIBC is no longer developed and such goals are now being addressed directly in GLIBC.” と書いてあります <a href="#fnref:13" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:14">
      <p>野次馬に松田さんの名前がありますが、前編 (インタビュー初日) は欠席されていました。 <a href="#fnref:14" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:15">
      <p>sprintf: 今も #define している。BSD の sprintf に流れている <a href="#fnref:15" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:16">
      <p>浜地さん。<a href="http://d.hatena.ne.jp/shinichiro_h/about">id:shinichiro_h</a> や<a href="../../articles/0021/0021-RubiMaGolf.html">るびまゴルフ</a>を参照。 <a href="#fnref:16" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:17">
      <p>GitHub のサイトは Ruby on Rails で実装されているそうです。 http://ja.wikipedia.org/wiki/GitHub <a href="#fnref:17" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:18">
      <p>まつもとゆきひろさんはテストせずにコミットして Ruby のコミット権を剥奪されかけたことがある http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-dev/29650 <a href="#fnref:18" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:19">
      <p><a href="http://d.hatena.ne.jp/hyoshiok/20091023">第100回カーネル読書会にLinusが来た件 - 未来のいつか/hyoshiokの日記</a> <a href="#fnref:19" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:20">
      <p><a href="http://linux.slashdot.jp/story/09/10/23/0550238/Linus%E6%9D%A5%E6%97%A5%E4%B8%AD%E3%80%81Windows-7%E3%81%AB%E5%96%9C%E3%81%B6%EF%BC%9F">Slashdot Linus来日中、Windows 7に喜ぶ？</a> <a href="#fnref:20" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:21">
      <p>X Window System のこと。 http://ja.wikipedia.org/wiki/X_Window_System <a href="#fnref:21" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
  </body>
</html>
