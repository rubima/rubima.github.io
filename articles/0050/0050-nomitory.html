<!DOCTYPE html>
<html>
  



  <head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41117431-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-41117431-1');
  </script>
  <script src="../../js/gtag.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>mruby 用デバッガ 「nomitory」の作り方</title>
  <meta name="description" content="">

  <script src="../../js/jquery.min.js"></script>
  <script src="../../js/bootstrap.min.js"></script>
  <link href="../../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../../css/theme.css" rel="stylesheet" type="text/css">
  <link href="../../css/syntax.css" rel="stylesheet" type="text/css">
  <link href="../../css/sharebutton.css" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="https://magazine.rubyist.net/articles/0050/0050-nomitory.html">
  <link rel="alternate" type="application/rss+xml" title="Rubyist Magazine" href="https://magazine.rubyist.net/feed.xml">
  <link rel="shortcut icon" href="../../images/favicon.ico">
</head>

  <body>
    <div class="container-fluid">
        <div class="row full">
            <div class="col-md-2 hidden-xs sidebar">
                <h4>

</h4>

<h4>バックナンバー</h4>
<ul>
    <li><a href="../../articles/backnumber/backnumber.html">記事単位</a></li>
    <hr>
    
        <li><a href="../../articles/kaigi_on_rails/index.html">Kaigi on Rails 特集号</a></li>
    
        <li><a href="../../articles/prerubykaigi2020/preRubyKaigi2020-index.html">RubyKaigi Takeout 2020 特集号</a></li>
    
        <li><a href="../../articles/0061/0061-index.html">0061号(2020-02)</a></li>
    
        <li><a href="../../articles/0060/0060-index.html">0060号(2019-08)</a></li>
    
        <li><a href="../../articles/prerubykaigi2019/preRubyKaigi2019-index.html">RubyKaigi 2019 直前特集号</a></li>
    
        <li><a href="../../articles/0059/0059-index.html">0059号(2019-01)</a></li>
    
        <li><a href="../../articles/0058/0058-index.html">0058号(2018-08)</a></li>
    
        <li><a href="../../articles/prerubykaigi2018/preRubyKaigi2018-index.html">RubyKaigi 2018 直前特集号</a></li>
    
        <li><a href="../../articles/0057/0057-index.html">0057号(2018-02)</a></li>
    
        <li><a href="../../articles/prerubykaigi2017/preRubyKaigi2017-index.html">RubyKaigi 2017 直前特集号</a></li>
    
        <li><a href="../../articles/0056/0056-index.html">0056号(2017-08)</a></li>
    
        <li><a href="../../articles/0055/0055-index.html">0055号(2017-03)</a></li>
    
        <li><a href="../../articles/0054/0054-index.html">0054号(2016-08)</a></li>
    
        <li><a href="../../articles/pretokyorubykaigi11/preTokyoRubyKaigi11-index.html">東京 Ruby 会議 11 直前特集号</a></li>
    
        <li><a href="../../articles/0053/0053-index.html">0053号(2016-04)</a></li>
    
        <li><a href="../../articles/0052/0052-index.html">0052号(2015-12)</a></li>
    
        <li><a href="../../articles/0051/0051-index.html">0051号(2015-09)</a></li>
    
        <li><a href="../../articles/0050/0050-index.html">0050号(2015-05)</a></li>
    
        <li><a href="../../articles/0049/0049-index.html">0049号(2014-12)</a></li>
    
        <li><a href="../../articles/0048/0048-index.html">0048号(2014-09)</a></li>
    
        <li><a href="../../articles/0047/0047-index.html">0047号(2014-06)</a></li>
    
        <li><a href="../../articles/0046/0046-index.html">0046号(2014-04)</a></li>
    
        <li><a href="../../articles/0045/0045-index.html">0045号(2013-12)</a></li>
    
        <li><a href="../../articles/0044/0044-index.html">0044号(2013-09)</a></li>
    
        <li><a href="../../articles/0043/0043-index.html">0043号(2013-07)</a></li>
    
        <li><a href="../../articles/0042/0042-index.html">0042号(2013-05)</a></li>
    
        <li><a href="../../articles/ruby200specialen/Ruby200SpecialEn-index.html">2.0.0 Special (EN)</a></li>
    
        <li><a href="../../articles/0041/0041-index.html">0041号(2013-02)</a></li>
    
        <li><a href="../../articles/0040/0040-index.html">0040号(2012-11)</a></li>
    
        <li><a href="../../articles/0039/0039-index.html">0039号(2012-09)</a></li>
    
        <li><a href="../../articles/rubykaja/kaja.html">RubyKaja のご紹介</a></li>
    
        <li><a href="../../articles/0038/0038-index.html">0038号(2012-05)</a></li>
    
        <li><a href="../../articles/0037/0037-index.html">0037号(2012-02)</a></li>
    
        <li><a href="../../articles/0036/0036-index.html">0036号(2011-11)</a></li>
    
        <li><a href="../../articles/0035/0035-index.html">0035号(2011-09)</a></li>
    
        <li><a href="../../articles/prerubykaigi2011/preRubyKaigi2011-index.html">RubyKaigi2011直前特集号</a></li>
    
        <li><a href="../../articles/0034/0034-index.html">0034号(2011-06)</a></li>
    
        <li><a href="../../articles/0033/0033-index.html">0033号(2011-04)</a></li>
    
        <li><a href="../../articles/0032/0032-index.html">0032号(2011-01)</a></li>
    
        <li><a href="../../articles/0031/0031-index.html">0031号(2010-10)</a></li>
    
        <li><a href="../../articles/prerubykaigi2010/preRubyKaigi2010-index.html">RubyKaigi2010直前特集号</a></li>
    
        <li><a href="../../articles/0030/0030-index.html">0030号(2010-06)</a></li>
    
        <li><a href="../../articles/0029/0029-index.html">0029号(2010-03)</a></li>
    
        <li><a href="../../articles/0028/0028-index.html">0028号(2009-12)</a></li>
    
        <li><a href="../../articles/0027/0027-index.html">0027号(2009-09)</a></li>
    
        <li><a href="../../articles/0026/0026-index.html">0026号(2009-06)</a></li>
    
        <li><a href="../../articles/0025/0025-index.html">0025号(2009-02)</a></li>
    
        <li><a href="../../articles/0024/0024-index.html">0024号(2008-10)</a></li>
    
        <li><a href="../../articles/0023/0023-index.html">0023号(2008-03)</a></li>
    
        <li><a href="../../articles/0022/0022-index.html">0022号(2007-12)</a></li>
    
        <li><a href="../../articles/0021/0021-index.html">0021号(2007-09)</a></li>
    
        <li><a href="../../articles/0020/0020-index.html">0020号(2007-08)</a></li>
    
        <li><a href="../../articles/0019/0019-index.html">0019号(2007-05)</a></li>
    
        <li><a href="../../articles/0018/0018-index.html">0018号(2007-02)</a></li>
    
        <li><a href="../../articles/0017/0017-index.html">0017号(2006-11)</a></li>
    
        <li><a href="../../articles/0016/0016-index.html">0016号(2006-09)</a></li>
    
        <li><a href="../../articles/0015/0015-index.html">0015号(2006-07)</a></li>
    
        <li><a href="../../articles/rubykaigi2006/RubyKaigi2006-index.html">日本 Ruby カンファレンス 2006 特別号</a></li>
    
        <li><a href="../../articles/0014/0014-index.html">0014号(2006-05)</a></li>
    
        <li><a href="../../articles/0013/0013-index.html">0013号(2006-02)</a></li>
    
        <li><a href="../../articles/0012/0012-index.html">0012号(2005-12)</a></li>
    
        <li><a href="../../articles/0011/0011-index.html">0011号(2005-11)</a></li>
    
        <li><a href="../../articles/0010/0010-index.html">0010号(2005-10)</a></li>
    
        <li><a href="../../articles/0009/0009-index.html">0009号(2005-09)</a></li>
    
        <li><a href="../../articles/0008/0008-index.html">0008号(2005-07)</a></li>
    
        <li><a href="../../articles/0007/0007-index.html">0007号(2005-06)</a></li>
    
        <li><a href="../../articles/0006/0006-index.html">0006号(2005-05)</a></li>
    
        <li><a href="../../articles/0005/0005-index.html">0005号(2005-02)</a></li>
    
        <li><a href="../../articles/0004/0004-index.html">0004号(2004-12)</a></li>
    
        <li><a href="../../articles/0003/0003-index.html">0003号(2004-11)</a></li>
    
        <li><a href="../../articles/0002/0002-index.html">0002号(2004-10)</a></li>
    
        <li><a href="../../articles/0001/0001-index.html">0001号(2004-09)</a></li>
    
</ul>
<p class="rss-subscribe"><a href="/feed.xml">RSS</a></p>

            </div>
            <div class="col-md-10 main">
                <div class="row">
                    <div class="col-md-12">
                        <img src="../../images/rubima_logo_l.png">
                        <h1>mruby 用デバッガ 「nomitory」の作り方</h1>
                        <div class="social-buttons">
                            <div class='sns'>            
    <ul class="clearfix">
       <li class="twitter"><a href="https://twitter.com/share?text=mruby 用デバッガ 「nomitory」の作り方&amp;url=https://magazine.rubyist.net/articles/0050/0050-nomitory.html" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-twitter"></i></a></li>
       <li class="facebook"><a href="https://www.facebook.com/sharer.php?u=https://magazine.rubyist.net/articles/0050/0050-nomitory.html&amp;t=mruby 用デバッガ 「nomitory」の作り方" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-facebook"></i></a></li>
       <li class="hatebu"><a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=https://magazine.rubyist.net/articles/0050/0050-nomitory.html&amp;mruby 用デバッガ 「nomitory」の作り方" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa">B!</i></a></li>
    </ul>
</div>
                        </div>
                        <div class="post_info">
                            

  <span class="created_on">初稿：2015-05-10</span>



                        </div>
                        
<ul id="markdown-toc">
  <li><a href="#はじめに" id="markdown-toc-はじめに">はじめに</a></li>
  <li><a href="#nomitory-とは" id="markdown-toc-nomitory-とは">nomitory とは</a></li>
  <li><a href="#デバッグにほしいもの" id="markdown-toc-デバッグにほしいもの">デバッグにほしいもの</a></li>
  <li><a href="#gdb-と-gdbmi-の使い方" id="markdown-toc-gdb-と-gdbmi-の使い方">GDB と GDB/MI の使い方</a>    <ul>
      <li><a href="#起動する" id="markdown-toc-起動する">起動する</a></li>
      <li><a href="#実行する" id="markdown-toc-実行する">実行する</a></li>
      <li><a href="#終了する" id="markdown-toc-終了する">終了する</a></li>
      <li><a href="#ブレークポイントを設定する" id="markdown-toc-ブレークポイントを設定する">ブレークポイントを設定する</a></li>
      <li><a href="#ブレークポイントに条件をつける" id="markdown-toc-ブレークポイントに条件をつける">ブレークポイントに条件をつける</a></li>
      <li><a href="#テンポラリブレークポイント-一時ブレークポイント-を設定する" id="markdown-toc-テンポラリブレークポイント-一時ブレークポイント-を設定する">テンポラリブレークポイント (一時ブレークポイント) を設定する</a></li>
      <li><a href="#ブレークポイントで停止した時に得られる情報" id="markdown-toc-ブレークポイントで停止した時に得られる情報">ブレークポイントで停止した時に得られる情報</a></li>
      <li><a href="#停止後に実行を再開する" id="markdown-toc-停止後に実行を再開する">停止後に実行を再開する</a></li>
      <li><a href="#ステップ実行する" id="markdown-toc-ステップ実行する">ステップ実行する</a></li>
      <li><a href="#関数単位で実行する" id="markdown-toc-関数単位で実行する">関数単位で実行する</a></li>
      <li><a href="#変数の値を表示する" id="markdown-toc-変数の値を表示する">変数の値を表示する</a></li>
    </ul>
  </li>
  <li><a href="#nomitory-のしくみ" id="markdown-toc-nomitory-のしくみ">nomitory のしくみ</a>    <ul>
      <li><a href="#ブレークポイントのしくみ" id="markdown-toc-ブレークポイントのしくみ">ブレークポイントのしくみ</a>        <ul>
          <li><a href="#code_fetch_hook" id="markdown-toc-code_fetch_hook">code_fetch_hook</a></li>
          <li><a href="#停止する条件" id="markdown-toc-停止する条件">停止する条件</a></li>
          <li><a href="#ruby-コード-1-行はバイトコード-1-行とは限らない" id="markdown-toc-ruby-コード-1-行はバイトコード-1-行とは限らない">Ruby コード 1 行はバイトコード 1 行とは限らない</a></li>
          <li><a href="#ブレークポイントの実装例-" id="markdown-toc-ブレークポイントの実装例-">ブレークポイントの実装例 </a></li>
        </ul>
      </li>
      <li><a href="#ステップ実行のしくみ" id="markdown-toc-ステップ実行のしくみ">ステップ実行のしくみ</a>        <ul>
          <li><a href="#ステップイン" id="markdown-toc-ステップイン">ステップイン</a></li>
          <li><a href="#ステップインの実装例" id="markdown-toc-ステップインの実装例">ステップインの実装例</a></li>
          <li><a href="#ステップオーバー" id="markdown-toc-ステップオーバー">ステップオーバー</a></li>
          <li><a href="#ステップオーバーの実装例" id="markdown-toc-ステップオーバーの実装例">ステップオーバーの実装例</a></li>
        </ul>
      </li>
      <li><a href="#変数表示のしくみ" id="markdown-toc-変数表示のしくみ">変数表示のしくみ</a>        <ul>
          <li><a href="#変数表示の実装例" id="markdown-toc-変数表示の実装例">変数表示の実装例</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#おわりに" id="markdown-toc-おわりに">おわりに</a></li>
  <li><a href="#著者について" id="markdown-toc-著者について">著者について</a></li>
</ul>

<p>書いた人 : やまね (<a href="https://github.com/yurie">@yurie</a>)</p>

<h2 id="はじめに">はじめに</h2>

<p>みなさん、<a href="https://github.com/mruby/mruby">mruby</a> を使ったことはありますか？ mruby は組込み用途向けの「軽量 Ruby」のことで、るびまでも過去に <a href="../../articles/0038/0038-ForeWord.html">0038 号 巻頭言</a> や <a href="../../articles/0040/0040-ForeWord.html">0040 号 巻頭言</a> で取り上げられていますね。</p>

<p>そして mruby は CRuby 以上に C に依存しているため、デバッグに苦労されているのではないでしょうか。そんな苦労を解消するために mruby 用のデバッガ「nomitory<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote">1</a></sup>」を開発し、 <a href="http://www.slideshare.net/yamanekko/writing-mruby-debugger">RubyConf 2014 で発表しました</a>。この記事では、その中から「Ruby を GDB (The GNU Project Debugger) でデバッグするための実装部分」を取り上げました。</p>

<p>また、対象読者を考慮して、フロントエンド部分には触れません。<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote">2</a></sup>
まず、nomitory の実装の基となる GDB、GDB/MI の使い方を紹介し、次にそれを使って Ruby をデバッグするしくみを解説します。</p>

<p>紹介するコードはコマンドラインの GDB からも試すことができるので、GUI が好きではないという方にもお楽しみいただけると思います。</p>

<p>本記事内で使用したコードは <a href="https://github.com/yurie/rubima50">https://github.com/yurie/rubima50</a> にあります。</p>

<p>もしも GDB/MI (GNU Debugger Machine Interface) について検索していたらこのページに辿り着いたという方がいらしたら、GDB と GDB/MI の使い方の章が参考になるでしょう。</p>

<h2 id="nomitory-とは">nomitory とは</h2>

<p>一言で言うと「Eclipse に搭載されている C/C++ 用デバッグ機能を拡張したもの」で、C も Ruby もデバッグできるのが特長です。</p>

<p>Eclipse は Java の IDE (統合開発環境) として知られていますが、プラグイン拡張により、他の言語用の IDE としても使用できます。これを C/C++ 用に拡張したものが Eclipse CDT (C/C++ Development Tooling) です。Eclipse CDT は デバッガに GDB を使用しており、GDB/MI 経由で GDB を操作しています。nomitory は Eclipse CDT を mruby 用に拡張する Eclipse プラグインとして作成しました。</p>

<h2 id="デバッグにほしいもの">デバッグにほしいもの</h2>

<p>デバッガにはデバッグ途中で変数の値を変更したり、実行結果をさかのぼったりする (Reverse Debugging) など多くの機能があります。これらすべてを実装するのは大変です。そこで今回は、デバッグに必要な 3 つの機能を実装します。</p>

<ul>
  <li>ブレークポイントの設定</li>
  <li>ステップ実行</li>
  <li>変数の現在値表示</li>
</ul>

<p>これらの機能があれば、気になる箇所で実行を止めて、変数の値を確認しながら段階的に処理を確認できます。GDB に対して mruby 用に実装するには、GDB の機能がどこまで使えて何を追加しなければならないかを見極めます。</p>

<p>そのために、GDB コマンドをおさらいしましょう。</p>

<h2 id="gdb-と-gdbmi-の使い方">GDB と GDB/MI の使い方</h2>

<p>GDB は、その名のとおり GNU Project のデバッガです。</p>

<p>一方 GDB/MI は GNU Debugger Machine Interface の略称です。名前から何となく分かるように、プログラムからの操作を想定して作られています。そのため、実行結果が機械的に解析しやすい形で返されます。Eclipse などの IDE ではこの GDB/MI でコマンドを実行した結果をもとに画面表示を行っています。GDB/MI では GDB で実行して画面に表示される内容よりも多くの情報を実行結果として返してくれます。</p>

<p>では同じプログラムを GDB と GDB/MI で実行して比べてみましょう。<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote">3</a></sup><sup id="fnref:4" role="doc-noteref"><a href="#fn:4" class="footnote">4</a></sup>。</p>

<p>ここでは以下のコードを使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main(void)
{
  int line = 0, cnt;

  for (line = 0; line &lt; 10; line++) {
    cnt = line * 5;
    printf("result=%d\n",cnt);
  }

  return 0;
}</code></pre></figure>

<h3 id="起動する">起動する</h3>

<p>「gdb デバッグしたい実行ファイル名」の場合は GDB が起動しますが、–interpreter=mi または -i=mi オプションをつけると GDB/MI が起動します<sup id="fnref:5" role="doc-noteref"><a href="#fn:5" class="footnote">5</a></sup>。-q オプションは起動時に表示されるメッセージを省略します。<sup id="fnref:6" role="doc-noteref"><a href="#fn:6" class="footnote">6</a></sup></p>

<p>GDB を起動します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ gdb -q sample
Reading symbols from sample...done.
(gdb) </code></pre></figure>

<p>GDB を mi モードで起動します。</p>

<p>GDB の場合は (gdb) の後ろで入力待ちになっていますが、GDB/MI の場合は (gdb) の後で改行され、次の行の先頭で入力待ちになっています。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ gdb -q -i=mi sample
=thread-group-added,id="i1"
~"Reading symbols from sample..."
~"done.\n"
(gdb) </code></pre></figure>

<h3 id="実行する">実行する</h3>

<p>起動できたら、コマンドを入力してデバッグ対象のプログラムを実行してみましょう。<sup id="fnref:7" role="doc-noteref"><a href="#fn:7" class="footnote">7</a></sup></p>

<p>GDB/MI のコマンドには、たいてい同等機能の GDB コマンドがあります。GDB/MI のマニュアルには「The corresponding gdb command is ‘xxx’. 」の形で対応する GDB コマンドを記載しています。ただし、すべてのコマンドに対応する GDB コマンドがあるわけではなく、GDB/MI にしかないものもあります。代表的なものとして「変数オブジェクト」があります。</p>

<p>GDB/MI のコマンド名は、- を先頭と単語の区切りに使用しています。ブレークポイントに関するものは -break- で始まり、データ操作に関するものは -data-、スタックに関するものは -stack-、プログラム制御に関するものは -exec- で始まるなど、カテゴリ分けしているものもあります。</p>

<p>GDB は run で実行します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) run
Starting program: /Users/xxx/tmp/sample</code></pre></figure>

<p>GDB/MI では、-exec-run を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) 
-exec-run
=thread-group-started,id="i1",pid="6401"
=thread-created,id="1",group-id="i1"
^running
*running,thread-id="all"</code></pre></figure>

<h3 id="終了する">終了する</h3>

<p>GDB は q コマンドでデバッガを終了します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) q</code></pre></figure>

<p>GDB/MI では、-gdb-exit を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) 
-gdb-exit
^exit</code></pre></figure>

<p>次に、今回実装することにした機能について GDB と GDB/MI のコマンドを見ていきましょう。</p>

<h3 id="ブレークポイントを設定する">ブレークポイントを設定する</h3>

<p>sample.c の 10 行目にブレークポイントを設定します。</p>

<p>GDB でブレークポイントを設定するには、break (省略形は b) を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) b sample.c:10
Breakpoint 1 at 0x100000f4e: file sample.c, line 10.</code></pre></figure>

<p>GDB/MI では -break-insert を使用します。ファイル名、行番号は -f オプションで指定します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) 
-break-insert -f sample.c:10
^done,bkpt=^done,bkpt={number="1",type="breakpoint",disp="keep",enabled="y",addr="0x0000000100000f4e",\
func="main",file="sample.c",fullname="/Users/xxx/tmp/sample.c",line="10",\
thread-groups=["i1"],times="0",original-location="sample.c:10"}</code></pre></figure>

<p>コマンドを実行すると ^done が返ってきます。その後ろに、実行結果 (設定したブレークポイントの情報) が「xxx(属性名)=”値”」の形で続きます。どのコマンドに対して何が返ってくるかは GDB/MI のマニュアル ( <a href="https://sourceware.org/gdb/onlinedocs/gdb/GDB_002fMI.html">https://sourceware.org/gdb/onlinedocs/gdb/GDB_002fMI.html</a> ) を参照してください。</p>

<p>ここでは「number=”1”」は GDB のブレークポイント番号です。number, addr, file, line の値から GDB の実行結果の文字列「Breakpoint 1 at 0x100000f4e: file sample.c, line 10.」を生成できることがわかります。GDB/MI は IDE でも使われています。IDE では、戻り値のうち必要な情報だけを取り出し、整形して表示します。</p>

<h3 id="ブレークポイントに条件をつける">ブレークポイントに条件をつける</h3>

<p>GDB で条件付きブレークポイントを設定するには、if の後ろに条件を記述します。</p>

<p>ここでは、「変数 line の値が 7 のとき」を条件に指定します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) b sample.c:10 if line==7
Breakpoint 1 at 0x100000f4e: file sample.c, line 10.</code></pre></figure>

<p>GDB/MI では -c オプション (condition) を使用して条件を記述します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) 
-break-insert -c line==7 -f sample.c:10
^done,bkpt=^done,bkpt={number="1",type="breakpoint",disp="keep",enabled="y",addr="0x0000000100000f4e",\
func="main",file="sample.c",fullname="/Users/xxx/tmp/sample.c",line="10",\
thread-groups=["i1"],cond="line==7",times="0",original-location="sample.c:10"}</code></pre></figure>

<h3 id="テンポラリブレークポイント-一時ブレークポイント-を設定する">テンポラリブレークポイント (一時ブレークポイント) を設定する</h3>

<p>テンポラリブレークポイントは、1 回限り有効なブレークポイントです。テンポラリブレークポイントは一度停止したら設定自体が削除されてしまうのが、通常のブレークポイントと異なります。</p>

<p>IDE ではよくある「カーソル位置まで実行」は、カーソルで指定された行にテンポラリブレークポイントを設定すると実装できます。<sup id="fnref:8" role="doc-noteref"><a href="#fn:8" class="footnote">8</a></sup></p>

<p>GDB でテンポラリブレークポイントを設定するには tbreak を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) tbreak sample.c:10
Temporary breakpoint 1 at 0x100000f4e: file sample.c, line 10.</code></pre></figure>

<p>GDB/MI は、ブレークポイントを設定するコマンド -break-insert に -t オプションをつけるとテンポラリブレークポイントになります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) 
-break-insert -t -f sample.c:10
^done,bkpt={number="1",type="breakpoint",disp="del",enabled="y",addr="0x0000000100000f4e",\
func="main",file="sample.c",fullname="/Users/xxx/tmp/sample.c",line="10",\
thread-groups=["i1"],times="0",original-location="sample.c:10"}</code></pre></figure>

<h3 id="ブレークポイントで停止した時に得られる情報">ブレークポイントで停止した時に得られる情報</h3>

<p>ブレークポイントで停止した時に得られる情報も、GDB と GDB/MI では異なります。</p>

<p>GDB では次のように表示されます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Breakpoint 1, main () at sample.c:10
10	    cnt = line * 5;</code></pre></figure>

<p>GDB/MI の場合、次のように表示されます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">*stopped,reason="breakpoint-hit",disp="keep",bkptno="1",frame={addr="0x0000000100000f4e",\
func="main",args=[],file="sample.c",fullname="/Users/xxx/tmp/sample.c",line="10"},\
thread-id="1",stopped-threads="all"</code></pre></figure>

<p>GDB/MI では、ブレークポイントで停止した時は停止理由が reason=”breakpoint-hit” のように”reason=xx”の形で返ってきます。</p>

<h3 id="停止後に実行を再開する">停止後に実行を再開する</h3>

<p>ブレークポイントやステップ実行で一時停止した後、続きを実行したい場合、
GDB では continue (省略形は c) を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) c</code></pre></figure>

<p>GDB/MI の場合、 -exec-continue を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) 
-exec-continue
^running</code></pre></figure>

<h3 id="ステップ実行する">ステップ実行する</h3>

<p>ステップ実行は、次の実行行が関数内部の場合、関数の中も 1 行ずつ実行します。このような動作をステップインといいます。</p>

<p>GDB は step (省略形は s) を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) s
11	    printf("result=%d\n",cnt);</code></pre></figure>

<p>GDB/MI では -exec-step を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) 
-exec-step
^running
*running,thread-id="all"
(gdb) 
*stopped,reason="end-stepping-range",frame={addr="0x0000000100000f5b",func="main",\
args=[],file="sample.c",fullname="/Users/xxx/tmp/sample.c",line="11"},thread-id="1",\
stopped-threads="all"</code></pre></figure>

<p>ステップ実行で停止した時は停止理由が reason=”end-stepping-range” となります。</p>

<h3 id="関数単位で実行する">関数単位で実行する</h3>

<p>「関数単位で実行する」はステップインとは違い、次の行が関数の場合は、関数内では止まらず関数を実行した後に止まります。このような動作をステップオーバーと言います。</p>

<p>GDB は next (省略形は n) を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) n
11	    printf("result=%d\n",cnt);</code></pre></figure>

<p>GDB/MI では -exec-next を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) 
-exec-next
^running
*running,thread-id="all"
(gdb) 
*stopped,reason="end-stepping-range",frame={addr="0x0000000100000f5b",func="main",\
args=[],file="sample.c",fullname="/Users/xxx/tmp/sample.c",line="11"},thread-id="1",\
stopped-threads="all"</code></pre></figure>

<h3 id="変数の値を表示する">変数の値を表示する</h3>

<p>GDB は「print 変数名」(省略形は p) を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) p line
$1 = 10</code></pre></figure>

<p>GDB/MI では「-data-evaluate-expression 変数名」を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) 
-data-evaluate-expression line
^done,value="10"</code></pre></figure>

<h2 id="nomitory-のしくみ">nomitory のしくみ</h2>

<p>ここまでは、GDB と GDB/MI の話をしました。</p>

<p>ここからは、GDB または GDB/MI を使って、mruby 上の Ruby コードをデバッグするにはどのようにしたら実現できるか述べます。</p>

<p>使用しているサンプルコードは <a href="https://github.com/yurie/rubima50/blob/master/rubima2.c">https://github.com/yurie/rubima50/blob/master/rubima2.c</a> です。</p>

<h3 id="ブレークポイントのしくみ">ブレークポイントのしくみ</h3>

<p>Ruby のコードにブレークポイントを設定しても GDB にはわかりません。一方、C で実装されている mruby 本体のコードに「今 Ruby のどの行を実行しているか」が分かるところがあれば、その情報をもとにブレークポイントを設定できます。
<img src="../../images/0050-nomitory/codefetch.png" alt="codefetch.png" /></p>

<p>上図は mrubyVM でバイトコードが実行されるときの動作イメージです。</p>

<p>VM のバイトコードを実行しているところで「今実行しているバイトコードは Ruby のコードのどの部分か」が取得できます。
それが、図の「CODE_FETCH_HOOK」のところです。詳しくは、次の code_fetch_hook で紹介します。</p>

<h4 id="code_fetch_hook">code_fetch_hook</h4>

<p>mruby.h ( <a href="https://github.com/mruby/mruby/blob/master/include/mruby.h">https://github.com/mruby/mruby/blob/master/include/mruby.h</a> ) に定義されている mrb_state 構造体に以下のような定義があります。<sup id="fnref:9" role="doc-noteref"><a href="#fn:9" class="footnote">9</a></sup></p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">#ifdef ENABLE_DEBUG
void (*code_fetch_hook)(struct mrb_state* mrb, struct mrb_irep *irep, mrb_code *pc, mrb_value *regs);
(略)
#endif</code></pre></figure>

<p>code_fetch_hook 関数ポインタに指定された関数は、バイトコードを実行するたびに毎回呼び出されます。(図の CODE_FETCH_HOOK のところです)
ここでは説明の都合上、code_fetch 関数という名前の関数をセットすることにします。以降、code_fetch 関数とはここにセットした関数名を指します。</p>

<p>code_fetch_hook に指定する関数 (code_fetch 関数) の引数は、 以下のようになります。</p>

<ul>
  <li>1 番目が mrb_state 構造体</li>
  <li>2 番目がバイトコードなどの情報が入っている mrb_irep 構造体</li>
  <li>3 番目が現在実行しているバイトコードへのポインタ</li>
  <li>最後が VM のレジスタ</li>
</ul>

<p>code_fetch 関数内では、この引数の mrb_irep 構造体に入っている情報から、実行している Ruby のファイル名、行番号、変数の値など、デバッグに必要な情報を取り出します。</p>

<h4 id="停止する条件">停止する条件</h4>

<p>この code_fetch 関数内で、</p>

<ul>
  <li>現在実行している Ruby のファイル名 = ブレークポイントを設定したい Ruby のファイル名</li>
  <li>現在実行している Ruby の行番号 = ブレークポイントを設定したい Ruby の行番号</li>
</ul>

<p>上記２つの条件が一致したときブレークポイントで止まるようにすると、Ruby コードのブレークポイントが実装できます。
nomitory の場合、この 2 つの条件をブレークポイントの条件式で指定するようにしました。</p>

<h4 id="ruby-コード-1-行はバイトコード-1-行とは限らない">Ruby コード 1 行はバイトコード 1 行とは限らない</h4>

<p>ここでひとつ気をつけなければならないことがあります。
code_fetch 関数は、バイトコードを実行するたびに呼ばれます。つまり、1 行の Ruby のコードが複数のバイトコードになる場合、同じ行に対して複数回呼ばれてしまいます。</p>

<p>ここでは簡単のため 、以下のスクリプト rubima.rb を使用します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">x = 2
y = 1
y = x + y</code></pre></figure>

<p><img src="../../images/0050-nomitory/bytecode3.png" alt="bytecode3.png" /></p>

<p>この問題を回避するために、1 行の Ruby コードに対して 1 度しか呼ばれないところに条件付きブレークポイントを設定します。nomitory では、code_fetch 関数が 1 行の Ruby コードに対して 2 回以上呼ばれていないかチェックした後の処理に、条件付きブレークポイントを設定するようにしました。</p>

<p>参考) バイトコードを出力するには -v オプションとファイル名をつけて mruby コマンドを実行します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">~/git/mruby/bin/mruby -v rubima.rb</code></pre></figure>

<p>実行結果例を以下に示します。</p>

<p>赤丸で囲った部分が Ruby コードの行番号です。3 行目は複数行のバイトコードになっていることがわかります。
<img src="../../images/0050-nomitory/bytecode-output5.png" alt="bytecode-output5.png" /></p>

<h4 id="ブレークポイントの実装例-">ブレークポイントの実装例 <sup id="fnref:10" role="doc-noteref"><a href="#fn:10" class="footnote">10</a></sup></h4>

<p>GDB (C) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) b sample.c:15</code></pre></figure>

<p>GDB (Ruby) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) break rubima2.c:89 if (((int)md_strcmp((const char *)filename,(const char *)"rubycode.rb"))==0 \
&amp;&amp; line==13)
Breakpoint 2 at 0x100001411: file rubima2.c, line 89.</code></pre></figure>

<p>GDB/MI (Ruby) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) 
-break-insert -c "(md_strcmp((const char *)filename,\
(const char *)\"/Users/xxx/rubima2/rubycode.rb\"))==0 &amp;&amp; line==13" -f rubima2.c:89
^done,bkpt={number="1",type="breakpoint",disp="keep",enabled="y",addr="0x0000000100001411",\
func="mrb_gdb_code_fetch",file="rubima2.c",fullname="/Users/xxx/rubima2/rubima2.c",\
line="89",thread-groups=["i1"],cond="(md_strcmp((const char *)filename,\
(const char *)\"/Users/xxx/rubima2/rubycode.rb\"))==0 &amp;&amp; line==13",times="0",\
original-location="rubima2.c:89"}</code></pre></figure>

<h3 id="ステップ実行のしくみ">ステップ実行のしくみ</h3>

<p>GDB の場合はステップインは step コマンド、ステップオーバーは next コマンドでした。当然ですが、この GDB の step, next は C のコードを基準としていますので、Ruby のコードを実行する際には使用できません。
そのため、同等の処理を別途実装します。</p>

<p>早速、実装方法をみていきましょう。</p>

<h4 id="ステップイン">ステップイン</h4>

<p>まずはステップインです。ステップインの実現はそう難しくはありません。先ほどの Ruby 用ブレークポイントのしくみを利用できます。</p>

<p>code_fetch 関数内に、ファイル名、行番号を指定しないでブレークポイントを設定すると、ステップインの実装ができます。Ruby のコード 1 行が複数行のバイトコードになっていた場合の対策は code_fetch 関数内で行っているので、ここでは単純に「次に止まるのは次の行が実行されたとき」とみなすことができます。
しかし、ファイル名、行番号を指定しないでブレークポイントを設定すると、プログラムが終了するまで 1 行動作しては止まります。1 行だけ実行したい場合は、一度止まったらブレークポイントを削除しなければなりません。</p>

<p>そこで nomitory では、テンポラリブレークポイントを使用します。テンポラリブレークポイントは 1 度だけ有効なブレークポイントです。step が呼ばれたら、テンポラリブレークポイントを設定して実行します。こうすれば、一度止まった後は再度 step (または next) を呼ばない限り止まらなくなるので、期待するステップインの動作になります。</p>

<h4 id="ステップインの実装例">ステップインの実装例</h4>

<p>GDB (C) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) step</code></pre></figure>

<p>GDB (Ruby) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) tbreak rubima2.c:89
Temporary breakpoint 2 at 0x100001411: file rubima2.c, line 89.</code></pre></figure>

<p>GDB/MI (Ruby) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb)
-break-insert -t -f rubima2.c:89
^done,bkpt={number="2",type="breakpoint",disp="del",enabled="y",addr="0x0000000100001411",\
func="mrb_gdb_code_fetch",file="rubima2.c",fullname="/Users/xxx/rubima2/rubima2.c",\
line="89",thread-groups=["i1"],times="0",original-location="rubima2.c:89"}</code></pre></figure>

<h4 id="ステップオーバー">ステップオーバー</h4>

<p>次はステップオーバーです。ステップオーバーは、ステップインの処理を拡張します。</p>

<p>ステップオーバーは関数の場合その中に入りません。さて、今実行している行が関数の中かどうかはどのように判断すればよいでしょうか。</p>

<p>関数の中に入ると変わる値を監視すればよいですね。その監視対象が callinfo です。</p>

<p>callinfo は関数の呼び出しごとに作られる関数スタックで、関数に入ると一つ増え、関数を抜けると一つ減ります。mruby の場合、mrb_callinfo 構造体が mruby.h に定義されています。</p>

<p>実行前にこの callinfo のスタックの深さを取得しておき、callinfo の深さを条件にしたテンポラリブレークポイントを実行します。そうすると、関数の中に入るとはスタックが深くなるためブレークポイントでは止まらず、関数から出るとブレークポイントで止まるようになります。</p>

<h4 id="ステップオーバーの実装例">ステップオーバーの実装例</h4>

<p>GDB (C) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) next</code></pre></figure>

<p>GDB (Ruby) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) tbreak rubima2.c:89 if mrb_gdb_get_callinfosize(mrb)&lt;=0
Temporary breakpoint 3 at 0x100001411: file rubima2.c, line 89.</code></pre></figure>

<p>GDB/MI (Ruby) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb)
-break-insert -t -c mrb_gdb_get_callinfosize(mrb)&lt;=0 -f rubima2.c:89
^done,bkpt={number="3",type="breakpoint",disp="del",enabled="y",addr="0x0000000100001411",\
func="mrb_gdb_code_fetch",file="rubima2.c",fullname="/Users/xxx/rubima2/rubima2.c",\
line="89",thread-groups=["i1"],cond="mrb_gdb_get_callinfosize(mrb)&lt;=0",times="0",\
original-location="rubima2.c:89"}</code></pre></figure>

<h3 id="変数表示のしくみ">変数表示のしくみ</h3>

<p>最後に Ruby の変数の値を表示する方法を説明します。</p>

<p>GDB で C の変数の値は「print 変数名」で分かりますが、Ruby の変数は認識してくれません。</p>

<p>そこで mruby 側で変数名を引数で渡すと、変数の値を返す関数を作成し、GDB なら print、GDB/MI の場合は -data-evaluate-expression で呼び出します。</p>

<p>この変数を返す関数の中身は次のようなしくみです。</p>

<p>変数に関する情報も mrb_state 構造体にあります。引数で渡された変数名に該当するシンボルを mrb_state 構造体にある配列リストから探して値を取得します。</p>

<p>変数の値を取得するには、Ruby の inspect メソッドを使用します。
ここで気をつけなければならないのが、デバッガの実装に Ruby の関数を使用したときの動作です。inspect メソッドは Ruby の関数のため、デバッグ対象のプログラム同様にバイトコードとして実行され、 code_fetch 関数も呼び出してしまいます。呼び出された code_fetch 関数はデバッグ対象のプログラムではなくデバッガが呼び出した inspect メソッドの実行結果を返します。このようなことが起きないように inspect メソッド実行中は code_fetch 関数を呼ばないようにしておきましょう。</p>

<p>nomitory の場合、IDE の一部として機能しているので、変数ウィンドウに変数一覧を表示するための関数も作成しました。<sup id="fnref:11" role="doc-noteref"><a href="#fn:11" class="footnote">11</a></sup></p>

<h4 id="変数表示の実装例">変数表示の実装例</h4>

<p>GDB (C) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">print v</code></pre></figure>

<p>GDB (Ruby) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(gdb) p mrb_gdb_get_localvalue(mrb, "v")
$2 = 0x1000814c0 &lt;ret&gt; "result={name=\"v\",value=\"5\",type=\"Fixnum\"}"</code></pre></figure>

<p>GDB/MI (Ruby) の場合</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">-data-evaluate-expression "mrb_gdb_get_localvalue(mrb, \"v\")"
^done,value="0x1000814c0 &lt;ret&gt; \"result={name=\\\"v\\\",value=\\\"5\\\",type=\\\"Fixnum\\\"}\""</code></pre></figure>

<h2 id="おわりに">おわりに</h2>

<p>GDB を使って mruby 上で動作する Ruby のデバッグを可能にする方法を紹介しました。もし、Eclipseでnomitoryを使ってみたくなったら、<a href="http://yamanekko.github.io/nomitory/">http://yamanekko.github.io/nomitory/</a> を参考にインストールしてください。</p>

<p>GDB/MI については資料が容易に見つけられなかったこともあり、紹介しました。</p>

<p>一番苦労したのは Java で CDT を拡張したところですが、さすがに場違いすぎるので別の機会に紹介できればと思います。</p>

<p>mruby を使いはじめたものの、気がつくと周辺整備ばかりしていて、結局 mruby を使ったコードはほとんど書けていません。
ようやくデバッガの目処がついたので、今度こそ mruby を使って何か作ることができそうです。</p>

<p>何かお気づきの点がありましたら、 <a href="https://github.com/yurie/rubima50/issues">https://github.com/yurie/rubima50/issues</a> にいただけると幸いです。</p>

<p>最後になりましたが、この原稿は <a href="http://www.sessame.jp/">SESSAME</a> メンバー、<a href="http://taiyaki.ru/">たいやき部</a>部員のみなさんにレビューしていただきました。この場を借りて御礼申し上げます。（レビューしていただいた後にサンプルコードを追加したので気がついたことがあればこっそり教えてください！）</p>

<h2 id="著者について">著者について</h2>

<p><a href="http://www.slideshare.net/yamanekko">チーム yamanekko</a> のサブリーダー (リーダーは猫のちーちゃん)</p>

<p>組込み方面で “たのしい mruby” の実現に向けて日々模索中。</p>

<p>主に組込み向けの mrbgems を作りながら、Eclipse を mruby 用にカスタマイズしています。</p>

<p>最近手がけているのは、<a href="http://dev.toppers.jp/trac_user/ev3pf/wiki/WhatsEV3RT">EV3RT</a><sup id="fnref:12" role="doc-noteref"><a href="#fn:12" class="footnote">12</a></sup> の API を mruby 用に移植すること。</p>

<hr />

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>nomitory という名前は発表後のたいやき部新年会で「すとうさん」がつけてくれました。感謝 <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>フロントエンドの実装は Java なので <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p>GDB, GDB/MI のコマンドについては、簡単のため、複数の書き方があるものは 1 種類のみ紹介します。 <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:4" role="doc-endnote">
      <p>GDB でデバッグするには、あらかじめ GCC で -g3 オプションをつけてコンパイルしておきます。 <a href="#fnref:4" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:5" role="doc-endnote">
      <p>現時点では mi1 と mi2 の 2 種類がありますが、mi のみ指定すると最新のもの (mi2) が指定されたことになります。 https://sourceware.org/gdb/onlinedocs/gdb/Interpreters.html#Interpreters <a href="#fnref:5" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:6" role="doc-endnote">
      <p>引用する際にシンプルに表示したかったため使用しただけです。 <a href="#fnref:6" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:7" role="doc-endnote">
      <p>まだ何も設定していませんから、ここで試した場合は、プログラムは最後まで実行されて終了します。びっくりしないでね:) <a href="#fnref:7" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:8" role="doc-endnote">
      <p>nomitory ではまだ実装していませんが・・・ <a href="#fnref:8" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:9" role="doc-endnote">
      <p>この機能を使用するには、mrbconf.h で #define ENABLE_DEBUG を有効にします。 <a href="#fnref:9" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:10" role="doc-endnote">
      <p>Ruby の実装例は https://github.com/yurie/rubima50/blob/master/rubycode.rb と https://github.com/yurie/rubima50/blob/master/rubima2.c を使用しています。 <a href="#fnref:10" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:11" role="doc-endnote">
      <p>変数一覧を返す関数を mruby 側で作成しておき、 -data-evaluate-expression で呼んでいるだけですが <a href="#fnref:11" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:12" role="doc-endnote">
      <p>EV3 用の RTOS(Real-Time Operating System) <a href="#fnref:12" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
  </body>
</html>
