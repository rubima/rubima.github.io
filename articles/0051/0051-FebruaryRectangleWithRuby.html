<!DOCTYPE html>
<html>
  



  <head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41117431-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-41117431-1');
  </script>
  <script src="../../js/gtag.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ruby で暦を研究する</title>
  <meta name="description" content="">

  <script src="../../js/jquery.min.js"></script>
  <script src="../../js/bootstrap.min.js"></script>
  <link href="../../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../../css/theme.css" rel="stylesheet" type="text/css">
  <link href="../../css/syntax.css" rel="stylesheet" type="text/css">
  <link href="../../css/sharebutton.css" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="https://magazine.rubyist.net/articles/0051/0051-FebruaryRectangleWithRuby.html">
  <link rel="alternate" type="application/rss+xml" title="Rubyist Magazine" href="https://magazine.rubyist.net/feed.xml">
  <link rel="shortcut icon" href="../../images/favicon.ico">
</head>

  <body>
    <div class="container-fluid">
        <div class="row full">
            <div class="col-md-2 hidden-xs sidebar">
                <h4>

</h4>

<h4>バックナンバー</h4>
<ul>
    
        <li><a href="../../articles/0058/0058-index.html">0058号(2018-08)</a></li>
    
        <li><a href="../../articles/prerubykaigi2018/preRubyKaigi2018-index.html">RubyKaigi 2018 直前特集号</a></li>
    
        <li><a href="../../articles/0057/0057-index.html">0057号(2018-02)</a></li>
    
        <li><a href="../../articles/prerubykaigi2017/preRubyKaigi2017-index.html">RubyKaigi 2017 直前特集号</a></li>
    
        <li><a href="../../articles/0056/0056-index.html">0056号(2017-08)</a></li>
    
        <li><a href="../../articles/0055/0055-index.html">0055号(2017-03)</a></li>
    
        <li><a href="../../articles/0054/0054-index.html">0054号(2016-08)</a></li>
    
        <li><a href="../../articles/pretokyorubykaigi11/preTokyoRubyKaigi11-index.html">東京 Ruby 会議 11 直前特集号</a></li>
    
        <li><a href="../../articles/0053/0053-index.html">0053号(2016-04)</a></li>
    
        <li><a href="../../articles/0052/0052-index.html">0052号(2015-12)</a></li>
    
        <li><a href="../../articles/0051/0051-index.html">0051号(2015-09)</a></li>
    
        <li><a href="../../articles/0050/0050-index.html">0050号(2015-05)</a></li>
    
        <li><a href="../../articles/0049/0049-index.html">0049号(2014-12)</a></li>
    
        <li><a href="../../articles/0048/0048-index.html">0048号(2014-09)</a></li>
    
        <li><a href="../../articles/0047/0047-index.html">0047号(2014-06)</a></li>
    
        <li><a href="../../articles/0046/0046-index.html">0046号(2014-04)</a></li>
    
        <li><a href="../../articles/0045/0045-index.html">0045号(2013-12)</a></li>
    
        <li><a href="../../articles/0044/0044-index.html">0044号(2013-09)</a></li>
    
        <li><a href="../../articles/0043/0043-index.html">0043号(2013-07)</a></li>
    
        <li><a href="../../articles/0042/0042-index.html">0042号(2013-05)</a></li>
    
        <li><a href="../../articles/ruby200specialen/Ruby200SpecialEn-index.html">2.0.0 Special (EN)</a></li>
    
        <li><a href="../../articles/0041/0041-index.html">0041号(2013-02)</a></li>
    
        <li><a href="../../articles/0040/0040-index.html">0040号(2012-11)</a></li>
    
        <li><a href="../../articles/0039/0039-index.html">0039号(2012-09)</a></li>
    
        <li><a href="../../articles/rubykaja/kaja.html">RubyKaja のご紹介</a></li>
    
        <li><a href="../../articles/0038/0038-index.html">0038号(2012-05)</a></li>
    
        <li><a href="../../articles/0037/0037-index.html">0037号(2012-02)</a></li>
    
        <li><a href="../../articles/0036/0036-index.html">0036号(2011-11)</a></li>
    
        <li><a href="../../articles/0035/0035-index.html">0035号(2011-09)</a></li>
    
        <li><a href="../../articles/prerubykaigi2011/preRubyKaigi2011-index.html">RubyKaigi2011直前特集号</a></li>
    
        <li><a href="../../articles/0034/0034-index.html">0034号(2011-06)</a></li>
    
        <li><a href="../../articles/0033/0033-index.html">0033号(2011-04)</a></li>
    
        <li><a href="../../articles/0032/0032-index.html">0032号(2011-01)</a></li>
    
        <li><a href="../../articles/0031/0031-index.html">0031号(2010-10)</a></li>
    
        <li><a href="../../articles/prerubykaigi2010/preRubyKaigi2010-index.html">RubyKaigi2010直前特集号</a></li>
    
        <li><a href="../../articles/0030/0030-index.html">0030号(2010-06)</a></li>
    
        <li><a href="../../articles/0029/0029-index.html">0029号(2010-03)</a></li>
    
        <li><a href="../../articles/0028/0028-index.html">0028号(2009-12)</a></li>
    
        <li><a href="../../articles/0027/0027-index.html">0027号(2009-09)</a></li>
    
        <li><a href="../../articles/0026/0026-index.html">0026号(2009-06)</a></li>
    
        <li><a href="../../articles/0025/0025-index.html">0025号(2009-02)</a></li>
    
        <li><a href="../../articles/0024/0024-index.html">0024号(2008-10)</a></li>
    
        <li><a href="../../articles/0023/0023-index.html">0023号(2008-03)</a></li>
    
        <li><a href="../../articles/0022/0022-index.html">0022号(2007-12)</a></li>
    
        <li><a href="../../articles/0021/0021-index.html">0021号(2007-09)</a></li>
    
        <li><a href="../../articles/0020/0020-index.html">0020号(2007-08)</a></li>
    
        <li><a href="../../articles/0019/0019-index.html">0019号(2007-05)</a></li>
    
        <li><a href="../../articles/0018/0018-index.html">0018号(2007-02)</a></li>
    
        <li><a href="../../articles/0017/0017-index.html">0017号(2006-11)</a></li>
    
        <li><a href="../../articles/0016/0016-index.html">0016号(2006-09)</a></li>
    
        <li><a href="../../articles/0015/0015-index.html">0015号(2006-07)</a></li>
    
        <li><a href="../../articles/rubykaigi2006/RubyKaigi2006-index.html">日本 Ruby カンファレンス 2006 特別号</a></li>
    
        <li><a href="../../articles/0014/0014-index.html">0014号(2006-05)</a></li>
    
        <li><a href="../../articles/0013/0013-index.html">0013号(2006-02)</a></li>
    
        <li><a href="../../articles/0012/0012-index.html">0012号(2005-12)</a></li>
    
        <li><a href="../../articles/0011/0011-index.html">0011号(2005-11)</a></li>
    
        <li><a href="../../articles/0010/0010-index.html">0010号(2005-10)</a></li>
    
        <li><a href="../../articles/0009/0009-index.html">0009号(2005-09)</a></li>
    
        <li><a href="../../articles/0008/0008-index.html">0008号(2005-07)</a></li>
    
        <li><a href="../../articles/0007/0007-index.html">0007号(2005-06)</a></li>
    
        <li><a href="../../articles/0006/0006-index.html">0006号(2005-05)</a></li>
    
        <li><a href="../../articles/0005/0005-index.html">0005号(2005-02)</a></li>
    
        <li><a href="../../articles/0004/0004-index.html">0004号(2004-12)</a></li>
    
        <li><a href="../../articles/0003/0003-index.html">0003号(2004-11)</a></li>
    
        <li><a href="../../articles/0002/0002-index.html">0002号(2004-10)</a></li>
    
        <li><a href="../../articles/0001/0001-index.html">0001号(2004-09)</a></li>
    
</ul>
<p class="rss-subscribe"><a href="/feed.xml">RSS</a></p>

            </div>
            <div class="col-md-10 main">
                <div class="row">
                    <div class="col-md-12">
                        <img src="../../images/rubima_logo_l.png">
                        <h1>Ruby で暦を研究する</h1>
                        <div class="social-buttons">
                            <div class='sns'>            
    <ul class="clearfix">
       <li class="twitter"><a href="https://twitter.com/share?text=Ruby で暦を研究する&amp;url=https://magazine.rubyist.net/articles/0051/0051-FebruaryRectangleWithRuby.html" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-twitter"></i></a></li>
       <li class="facebook"><a href="https://www.facebook.com/sharer.php?u=https://magazine.rubyist.net/articles/0051/0051-FebruaryRectangleWithRuby.html&amp;t=Ruby で暦を研究する" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-facebook"></i></a></li>
       <li class="hatebu"><a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=https://magazine.rubyist.net/articles/0051/0051-FebruaryRectangleWithRuby.html&amp;Ruby で暦を研究する" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa">B!</i></a></li>
    </ul>
</div>
                        </div>
                        <div class="post_info">
                            



                        </div>
                        
<ul id="markdown-toc">
  <li><a href="#はじめに" id="markdown-toc-はじめに">はじめに</a></li>
  <li><a href="#最初の調査" id="markdown-toc-最初の調査">最初の調査</a></li>
  <li><a href="#二つ目の調査" id="markdown-toc-二つ目の調査">二つ目の調査</a></li>
  <li><a href="#6-年間隔11-年間隔の謎に迫る" id="markdown-toc-6-年間隔11-年間隔の謎に迫る">6 年間隔、11 年間隔の謎に迫る</a></li>
  <li><a href="#意外な伏兵" id="markdown-toc-意外な伏兵">意外な伏兵</a></li>
  <li><a href="#まとめ" id="markdown-toc-まとめ">まとめ</a></li>
  <li><a href="#おまけ" id="markdown-toc-おまけ">おまけ</a></li>
  <li><a href="#あとがき" id="markdown-toc-あとがき">あとがき</a></li>
  <li><a href="#謝辞" id="markdown-toc-謝辞">謝辞</a></li>
  <li><a href="#著者について" id="markdown-toc-著者について">著者について</a></li>
</ul>

<p>書いた人 : m.sotta (@swallow_life <a href="https://twitter.com/swallow_life">Twitter</a> <a href="https://github.com/swallow-life">GitHub</a>)</p>

<h2 id="はじめに">はじめに</h2>

<p>2015 年 7 月 1 日にうるう秒が挿入され、ニュースに取り上げられていました。
とかく暦に関することは皆に影響するためか関心を集めやすいのかもしれません。
暦といえばちょっと前のことになりますが 2015 年 2 月を覚えていますか？
この月は日曜始まりのカレンダーの場合ちょうど 4 週で収まるめずらしい月でした。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2015/2
SunMonTueWedThuFriSat
1  2  3  4  5  6  7
8  9  10 11 12 13 14
15 16 17 18 19 20 21
22 23 24 25 26 27 28</code></pre></figure>

<p>このような 2 月が現れるのは 2009 年以来と言う話が Twitter 上で話題になっており、それを見て私はこの事象に気がつきました。
興味を持って Google で調べてみたところ前回が 2009 年という話は見つけられたのですが、次回がいつ来るのかという話は見つけられませんでした。</p>

<p>見つけられないのであれば自分で探してしまえ、ということで前置きが長くなりましたが、本記事では Ruby を使って、この「2 月が 4 週で収まる事象」の性質を解き明かしていきたいと思います。
ひとまずの目標は、この事象がいかなる法則性で出現するのか解き明かすこと、あるいは、発生に法則性がないことを確認することです。
また、それ以外にも この問題を解きながら何かおもしろい発見があればよいなと思います。</p>

<p>本記事の内容は実生活に全く役に立たないと思いますが、知的エンターテイメントとしてお楽しみいただければ幸いです。</p>

<p>最初に 2 月が 4 週で収まる事象に名前を付けたいと思います。 (かなり呼びづらいので……。)
私はカレンダーの形がちょうど四角くなることから Rectangle February Problem と名付けました<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>。
本記事では省略して RectFeb 問題としました。</p>

<h2 id="最初の調査">最初の調査</h2>

<p>さて、まずは Ruby を使ってある年の 2 月が RectFeb かどうかを判定させてみたいと思います。
2015 年と 2009 年を見比べてみると、2 つの月に共通する性質は 2 月 1 日が日曜である、ということがわかります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2015/2                 2009/2
SunMonTueWedThuFriSat  SunMonTueWedThuFriSat
1  2  3  4  5  6  7    1  2  3  4  5  6  7
8  9  10 11 12 13 14   8  9  10 11 12 13 14
15 16 17 18 19 20 21   15 16 17 18 19 20 21
22 23 24 25 26 27 28   22 23 24 25 26 27 28</code></pre></figure>

<p>これは日曜始まりのカレンダーにキレイに収まるのですから自明なことですね。
出来るだけシンプルに Ruby で表現してみましょう。
ここからのプログラムリストは irb にコピー・ペーストして実行できます。
ぜひお手元でお試しください。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">require "date"

def create_feb_first_day(year=Date.today.year)
  Date.new year, 2, 1
end
alias feb create_feb_first_day

def rectangle_february? (feb)
  feb.sunday?
end
alias rect_feb? rectangle_february?</code></pre></figure>

<p>実行してみましょう。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">rect_feb? feb 2015 #=&gt; true
rect_feb? feb 2009 #=&gt; true
rect_feb? feb 2014 #=&gt; false</code></pre></figure>

<p>良さそうです。</p>

<p>さて次は 2015 年と 2009 年以外の RectFeb を探してみます。
2009 年からさかのぼっていくと 2004 年 2 月が日曜日始まりであることがわかります。
(逆に 2015 年以降を探しにいってしまうと中々見つかりません……。)</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">rect_feb? feb 2004 #=&gt; true</code></pre></figure>

<p>しかし、カレンダーを確認すると 2004 年 2 月は四角ではありません。
これはなぜでしょうか？
カレンダーを見ればすぐにわかりますね。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2004/2
SunMonTueWedThuFriSat
1  2  3  4  5  6  7
8  9  10 11 12 13 14
15 16 17 18 19 20 21
22 23 24 25 26 27 28
29 </code></pre></figure>

<p>そうです、うるう年です。
2004 年は 2 月 29 日が存在するため RectFeb ではありません。
つまり、RectFeb は 2 月 1 日が日曜であり、かつ、うるう年ではない場合に出現するようです。
さっそく得られた知見を Ruby コードに反映しましょう。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def rectangle_february? (feb)
  feb.sunday? &amp;&amp; !feb.leap?
end
alias rect_feb? rectangle_february?

rect_feb? feb 2004 #=&gt; false</code></pre></figure>

<p>次はどちらに進みましょう？
RectFeb の法則性を見つけるため、すこし範囲を広げて 2 月 1 日の曜日をチェックしてみましょう。
そのためのコードを書きましょう。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def convert_febs year_range
  year_range.map {|y| feb y}
end
alias conv convert_febs

def weekday feb
  feb.strftime("%a")
end

def febs_detail febs
  febs.map {|feb| "#{feb.year}:#{weekday (feb)}:#{rect_feb?(feb)}:#{'leap' if feb.leap?}"}
end

puts febs_detail conv(2000..2050)</code></pre></figure>

<p>2000 年から 2050 年の範囲で</p>

<ul>
  <li>2 月 1 日の曜日</li>
  <li>RectFeb かどうか</li>
  <li>うるう年かどうか</li>
</ul>

<p>を表示するコードを追加しています。
実行結果は以下のようになりました。 (少し長いです。)</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2000:Tue:false:leap
2001:Thu:false:
2002:Fri:false:
2003:Sat:false:
2004:Sun:false:leap
2005:Tue:false:
2006:Wed:false:
2007:Thu:false:
2008:Fri:false:leap
2009:Sun:true:
2010:Mon:false:
2011:Tue:false:
2012:Wed:false:leap
2013:Fri:false:
2014:Sat:false:
2015:Sun:true:
2016:Mon:false:leap
2017:Wed:false:
2018:Thu:false:
2019:Fri:false:
2020:Sat:false:leap
2021:Mon:false:
2022:Tue:false:
2023:Wed:false:
2024:Thu:false:leap
2025:Sat:false:
2026:Sun:true:
2027:Mon:false:
2028:Tue:false:leap
2029:Thu:false:
2030:Fri:false:
2031:Sat:false:
2032:Sun:false:leap
2033:Tue:false:
2034:Wed:false:
2035:Thu:false:
2036:Fri:false:leap
2037:Sun:true:
2038:Mon:false:
2039:Tue:false:
2040:Wed:false:leap
2041:Fri:false:
2042:Sat:false:
2043:Sun:true:
2044:Mon:false:leap
2045:Wed:false:
2046:Thu:false:
2047:Fri:false:
2048:Sat:false:leap
2049:Mon:false:
2050:Tue:false:</code></pre></figure>

<p>長いですね……。でも、どうやら次の RectFeb は 2026 年であることがわかりました。
その次は 2037 年、2043 年とつづくようです。</p>

<h2 id="二つ目の調査">二つ目の調査</h2>

<p>うーん、ちょっとここから法則性を見つけるのは難しそうです。
別のアプローチを考えましょう。
というわけで先ほど列挙した Feb の中から RectFeb だけを抜き出してながめてみましょう。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def select_rect_febs febs
  febs.select {|feb| rect_feb? feb}
end

puts febs_detail select_rect_febs conv(2000..2050)</code></pre></figure>

<p>実行結果は下記のようになりました。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2009:Sun:true:
2015:Sun:true:
2026:Sun:true:
2037:Sun:true:
2043:Sun:true:</code></pre></figure>

<p>さっきよりはよいかもしれません。
2009 年から 2015 年は 6 年の間隔で
2015 年以降は 11 年ごとに RectFeb になるようです。
Ruby のコードでも RectFeb の間隔を確かめてみます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def febs_distance rect_febs
  prev = nil
  rect_febs.map do |feb|
    y = feb.year
    year_distance =  "#{y}"
    year_distance += ":#{(y - prev)}" if prev
    prev = y
    year_distance
  end
end

puts febs_distance (select_rect_febs conv 2000..2050)</code></pre></figure>

<p>実行結果は下記のようになりました。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2009
2015:6
2026:11
2037:11
2043:6</code></pre></figure>

<p>おっと勘違いがあったようです。2037 年から 2043 年の間隔は 6 年でした。
そうすると RectFeb は 6 年もしくは 11 年間隔で発生しているのでは？という仮説がたちます。
試しに 2043 年の 6 年後、11 年後が RectFeb かどうか確かめてみましょう。
(ただし 2049 年は 2050 年まで調べた時に RectFeb として出てきていないので RectFeb ではなさそうですね。)</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">rect_feb? feb 2049 #=&gt; false
rect_feb? feb 2054 #=&gt; true</code></pre></figure>

<p>ここでも 11 年後が RectFeb になるようです。
さらにもう一度確かめます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">rect_feb? feb 2060 #=&gt; false
rect_feb? feb 2065 #=&gt; true</code></pre></figure>

<p>やはり 11 年後が RectFeb になるようです。</p>

<p>最初に比べてだいぶわかったことが増えてきました。
いったんまとめましょう。</p>

<ul>
  <li>2009 年、2015 年は RectFeb である</li>
  <li>RectFeb は 2 月 1 日が日曜でその年がうるう年でないことを確認すれば判定できる</li>
  <li>2015 年以降は 2026 年、2037 年、2043 年に現れる</li>
  <li>RectFeb の発生間隔は 6 年もしくは 11 年である可能性が高い (推測)</li>
</ul>

<h2 id="6-年間隔11-年間隔の謎に迫る">6 年間隔、11 年間隔の謎に迫る</h2>

<p>さて、この次はどうしましょうか。
候補としては</p>

<ul>
  <li>さらに広範囲を調べてみる</li>
  <li>なぜ 6 年間隔、11 年間隔になるかの謎を調べる</li>
</ul>

<p>のどちらか、でしょうか。
先に、より難しそうな (そしてよりおもしろそうな) 6 年間隔、11 年間隔の謎を調べてみましょう。
6 年間隔のサンプルとして 2009 年から 2015 年に注目します。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts febs_detail conv(2009..2015)</code></pre></figure>

<p>実行結果は下記のようになりました。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2009:Sun:true:
2010:Mon:false:
2011:Tue:false:
2012:Wed:false:leap
2013:Fri:false:
2014:Sat:false:
2015:Sun:true:</code></pre></figure>

<p>2009 年から 2010 年で Sun → Mon となっていますので曜日が 1 つだけ進んでいることがわかります。
こうなる理由ですが、1 年は 365 日なので 1 週間の 7 で割ると 52 週と余り 1 日になる、ゆえに、同じ月日 (ここでは 2 月 1 日) に着目すると 1 年ごとに曜日が 1 つ進むから、ですね。</p>

<p>でも、そうすると 2009 年の Sun から次の Sun に戻るまでには 7 年必要になるはずです。
なぜならば以下のように Sun → Mon → Tue → Wed → Thu → Fri → Sat → Sun と Sun → Sun に戻ってくるには 7 年分の曜日が進む必要があるからです。
ところが、実際には 6 年後の 2015 年が Sun になっています。
なぜなのでしょうか？</p>

<p>そう思いながら見ていくと 2012 年から 2013 年にかけては Web→Fri と曜日が 2 つ進んでいます。
これは 2012 年がうるう年のため 366 日あり 52 週と余り 2 日で曜日が 2 つ進むからのようです。
したがって RectFeb から次の RectFeb までにうるう年が 1 回だけ発生する場合は、6 年間隔になるということが言えそうです。</p>

<p>2037 年と 2043 年に関して確認してみると同様の結果が得られました。 (2040 年だけがうるう年。)</p>

<p>11 年間隔についてはどうでしょうか？</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts febs_detail conv(2015..2026)</code></pre></figure>

<p>実行結果は下記のようになりました。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2015:Sun:true:
2016:Mon:false:leap
2017:Wed:false:
2018:Thu:false:
2019:Fri:false:
2020:Sat:false:leap
2021:Mon:false:
2022:Tue:false:
2023:Wed:false:
2024:Thu:false:leap
2025:Sat:false:
2026:Sun:true:</code></pre></figure>

<p>順に見ていくと 2016 年にうるう年で 2 つ曜日が進み 2020 年にも 2 つ曜日が進んでいます。
特筆すべきは 2020 年は Sat なので次の年が RectFeb になりそうなのですが
うるう年のため 2 つ曜日が進みます。そのため Sun がスキップされ、もう 1 周曜日が進まないと RectFeb が発生しない点です。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2020:Sat:false:leap
2021:Mon:false:</code></pre></figure>

<p>2021 年以降はうるう年が 1 回発生しておりこれは 6 年間隔と同じ経過のようです。
したがって「2020 年までの 5 年 + 2021 年以降の 6 年 = 11 年間隔」となるようです。</p>

<p>もうひとつの 11 年間隔の期間である 2026 年から 2037 年も見てみましょう。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts febs_detail conv(2026..2037)</code></pre></figure>

<p>実行結果は下記のようになりました。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2026:Sun:true:
2027:Mon:false:
2028:Tue:false:leap
2029:Thu:false:
2030:Fri:false:
2031:Sat:false:
2032:Sun:false:leap
2033:Tue:false:
2034:Wed:false:
2035:Thu:false:
2036:Fri:false:leap
2037:Sun:true:</code></pre></figure>

<p>同じパターンかなと思ったのですが 2032 年が Sun で、かつうるう年のため
RectFeb でなくなっている点が大きな違いです。
こちらは「2032 年までの 6 年 + 2033 年以降の 5 年 = 11 年間隔」となるようです。</p>

<p>また、5 年 + 6 年のパターン (Sat:leap) と 6 年 + 5 年のパターン (Sun:leap) のどちらもうるう年が 3 回発生している点が共通しています。</p>

<p>さて、まとめると RectFeb と次の RectFeb の間には以下のような法則があるようです。</p>

<ul>
  <li>Sat でうるう年の Feb がある場合、11 年間隔</li>
  <li>Sun でうるう年の Feb がある場合、11 年間隔</li>
  <li>それ以外の場合、6 年間隔</li>
</ul>

<h2 id="意外な伏兵">意外な伏兵</h2>

<p>6 年、11 年間隔の謎がわかったところで広範囲の探索に移りたいと思います。
広範囲と簡単に言ってしまいましたが、その意味するところは、その範囲を探索すれば RectFeb のすべての出現パターンが確実に存在する範囲のことを指しています。</p>

<p>でも、いったいどうやってそんな範囲を決めればいいんでしょう……。
かなり悩んでしまいます。
こういった場合、途方に暮れていても問題は解決しないのですよね。
いろいろ試して使える情報を増やしてみるか今までの情報を整理してみると突破口が開けそうです (筆者の経験則です) 。</p>

<p>ということで試しに 2000 年から 100 年の間を調べてみます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts febs_distance (select_rect_febs conv 2000..2100)</code></pre></figure>

<p>実行結果は下記のようになりました。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2009
2015:6
2026:11
2037:11
2043:6
2054:11
2065:11
2071:6
2082:11
2093:11
2099:6</code></pre></figure>

<p>6 年、11 年間隔以外のパターンはないようです。
しかし、やはりこれですべてパターンを網羅しているかどうかは確信が持てません。</p>

<p>そこで情報を整理する方向を模索します。
ここまでを振り返ってみると、うるう年が重要な役割を果たしていることがわかりました。
ちょっと調べるとうるう年の定義は以下のようです<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>。グレゴリオ暦法において、</p>

<ol>
  <li>西暦年号が 4 で割り切れる年をうるう年とする。</li>
  <li>例外として、西暦年号が 100 で割り切れて 400 で割り切れない年は平年とする。</li>
</ol>

<p>これらから、400 年周期で RectFeb の出現するパターンがかわる可能性があるのでは？と推測しました。
なので、少なくとも 400 年以上は調べてみないと RectFeb の出現パターンを網羅したとは言えなさそうです。
ではさっそく調べてみましょう。切りがいいので 2000 年から 3000 年を調べてみます。 (またしても長いです……。)</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts febs_distance (select_rect_febs conv 2000..3000)</code></pre></figure>

<p>実行結果は下記のようになりました。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2009
2015:6
2026:11
2037:11
2043:6
2054:11
2065:11
2071:6
2082:11
2093:11
2099:6
2105:6
2111:6
2122:11
2133:11
2139:6
2150:11
2161:11
2167:6
2178:11
2189:11
2195:6
2201:6
2207:6
2218:11
2229:11
2235:6
2246:11
2257:11
2263:6
2274:11
2285:11
2291:6
2303:12
2314:11
2325:11
2331:6
2342:11
2353:11
2359:6
2370:11
2381:11
2387:6
2398:11
2409:11
2415:6
2426:11
2437:11
2443:6
2454:11
2465:11
2471:6
2482:11
2493:11
2499:6
2505:6
2511:6
2522:11
2533:11
2539:6
2550:11
2561:11
2567:6
2578:11
2589:11
2595:6
2601:6
2607:6
2618:11
2629:11
2635:6
2646:11
2657:11
2663:6
2674:11
2685:11
2691:6
2703:12
2714:11
2725:11
2731:6
2742:11
2753:11
2759:6
2770:11
2781:11
2787:6
2798:11
2809:11
2815:6
2826:11
2837:11
2843:6
2854:11
2865:11
2871:6
2882:11
2893:11
2899:6
2905:6
2911:6
2922:11
2933:11
2939:6
2950:11
2961:11
2967:6
2978:11
2989:11
2995:6</code></pre></figure>

<p>これは！？お気付きになられたでしょうか？
気付いておられない方は 2303 年と 2703 年をご覧下さい。
レアキャラの 12 年間隔が出現しています！！
まだ謎が残っているようですね… …。
なんと奥深いことか。</p>

<p>2303 年とその一つ前の RecrFeb を調べてみましょう。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts febs_detail conv(2291..2303)</code></pre></figure>

<p>実行結果は下記のようになりました。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">2291:Sun:true:
2292:Mon:false:leap
2293:Wed:false:
2294:Thu:false:
2295:Fri:false:
2296:Sat:false:leap
2297:Mon:false:
2298:Tue:false:
2299:Wed:false:
2300:Thu:false:
2301:Fri:false:
2302:Sat:false:
2303:Sun:true:</code></pre></figure>

<p>2296 年は Sat:leap にも関わらず 2297 年から次の RectFeb まで 7 年になっています。
それに、うるう年が 2 回しかありませんね。
どのうるう年がなくなったのかと見ていくと 2300 年は「100 で割り切れて 400 で割り切れない年」に一致します。
ですので、2300 年はうるう年ではありません。
ここがポイントのようです。
11 年のパターンの最後のうるう年が平年になったため RectFeb まで 1 年余分にかかる、というのが結論のようです。</p>

<p>さらに 2703 年は 2303 年のちょうど 400 年後ですね。
ここから、RectFeb の周期は 400 年であることが示唆されます。
400 年ごとに同じパターンで出現するのであれば、ある 400 年間を調べればすべての出現パターンを網羅できたといえますよね。
このことの確認 (証明？) は読者への宿題とします。 (筆者は体力がつきました……。)</p>

<h2 id="まとめ">まとめ</h2>

<p>最後にここまでにわかった法則性を整理／検討すると</p>

<ul>
  <li>ある RectFeb から次の RectFeb の間隔は必ず 6 年、11 年、12 年のどれかになる</li>
  <li>RectFeb は 400 年周期の出現パターンを持つ</li>
  <li>400 年の間で 6 年間隔は 17 回、11 年間隔は 26 回、12 年間隔は 1 回出現する</li>
  <li>RectFeb は全部で 44 回 / 400 年、平均で 9.09 年に 1 度出現する</li>
</ul>

<p>ということがわかりました。</p>

<p>以上で RectFeb 問題のまとめとします。
ひとしごとおしまい。
ここまでの長旅ご苦労様でした。</p>

<p>記事中で使用した Ruby コードをまとめておきます。
興味のある方は、<a href="../../images/0051-FebruaryRectangleWithRuby/rect_feb.rb">rect_feb.rb</a> からダウンロードしてください。</p>

<h2 id="おまけ">おまけ</h2>

<p>RectFeb に法則性があることがわかったので当初の目的のとおり (覚えていますか？) 、法則性を踏まえた上で自分で任意の年の次に来る RectFeb を見つける方法を考えたいと思います。
一応、紙と鉛筆があれば PC を使わずとも計算できるはずです。</p>

<p>まず 400 年周期を 100 年ごとに分割します。
分割方法は以下のようにします。</p>

<ul>
  <li>次の RectFeb を調べたい年を y とします</li>
  <li>y を 400 で割った余りを y400 とします</li>
  <li>y400 の値を以下に当てはめて分類します。例: y = 2672 年とすると 2672 / 400 = 6 余り 272、y400 = 272 なので 200 ≦ 272 ≦ 300。よって 2672 年は 200 年期になります。
    <ul>
      <li>[ 0 ≦ y400 &lt; 100 ] → 400 年期 (0 年期とも名付けられますが 100 年間であることを表すため 400 年期としています)</li>
      <li>[ 100 ≦ y400 &lt; 200 ] → 100 年期</li>
      <li>[ 200 ≦ y400 &lt; 300 ] → 200 年期</li>
      <li>[ 300 ≦ y400 &lt; 400 ] → 300 年期</li>
    </ul>
  </li>
</ul>

<p>各 100 年期ごとに最初の RectFeb の年を覚えておきます。
400 年期から 200 年期までは 4 ずつ減っていくと覚えると覚えやすいと思います。
なお、300 年期の初めての RectFeb は 12 年間隔のため 4 ずつ減っていくという法則に当てはまらない模様です。</p>

<ul>
  <li>400 年期: 9 年目 (最初の RectFeb は 2009、2409、2809 など)</li>
  <li>100 年期: 5 年目 (最初の RectFeb は 2105、2505、2905 など)</li>
  <li>200 年期: 1 年目 (最初の RectFeb は 2201、2601、3001 など)</li>
  <li>300 年期: 3 年目 (最初の RectFeb は 2303、2703、3103 など)</li>
</ul>

<p>調べたい年を超えるまで最初の RectFeb の年に 6, 11, 11 の数を繰り返しこの順に加算していきます。
計算した結果が次の RectFeb の年になります。</p>

<p>例: y = 2672 年の次に現れる RectFeb を調べたい場合、2601 + 6 + 11 + 11 + 6 + 11 + 11 + 6 + 11 = 2674 年。</p>

<p>確認してみましょう。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">rect_feb? feb 2674 #=&gt; true</code></pre></figure>

<p>OK ですね。
これで (一生涯で本記事以外では使うことがないであろう) RectFeb の算出方法がわかりました！</p>

<h2 id="あとがき">あとがき</h2>

<p>暦はある時点の太陽と地球の相対位置を表していると考えられます。
もし、うるう年がないとします。その場合、暦というシステムを実装するには楽なのですが、
それでは全く役に立たないものになってしまうことでしょう。
なぜならば、年を経るごとに、同じ月なのに、太陽と地球の相対位置がずれていってしまうからです。
そうした場合、例えば各月の平均降水量だとか平均気温だとかいった統計を比較することの意味がなくなってしまいます。
意味のある比較にするには暦を使う側がずれを考慮しなければならず、でもそれはとても面倒くさいですね。
暦を使う側が楽を出来るようにうるう年 (あるいはうるう秒) の様な複雑なルールが作られているわけですね。
(と本記事を書きながら理解しました。)</p>

<p>Ruby でも「ある仕事を行なうとき、そのためにプログラミング言語を使う人と、そのためのプログラミング言語を作る人の割合は、言語を作る人のほうが圧倒的に少ない。であれば、苦労すべきはプログラミング言語を作る人だ<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup>」とのことですのでこういった面では似ているのかもしれませんね。</p>

<p>それにしても次の 12 年間隔 RectFeb が出現する 2303 年には私は確実に生きていないです。当然この記事を読んでいるあなたも。
われわれの子供ですら生きていないでしょう。
Ruby は生き残っているのでしょうか？
遠大な気分になりますね。
そんなとりとめのないことを考えながら本記事を終わりといたします。</p>

<h2 id="謝辞">謝辞</h2>

<p>本記事は<a href="http://regional.rubykaigi.org/tochigi06/">とちぎ Ruby 会議 06</a> に参加した影響のもとで書きあげました。
書くにあたって多大なインスピレーションをいただいた、とちぎ Ruby 会議 06 のスタッフの方々、発表者の方々、参加者の方々にお礼を申し上げます。
ありがとうございます。</p>

<p>特に<a href="http://www.slideshare.net/sinara.h/toruby2015-hara0621">原信一郎さんの発表</a>が本記事を書く直接のきっかけになりました。ありがとうございます。</p>

<p>本記事を書くにあたって使用した Ruby は大変つかいやすく
切れ味のよいナイフで問題を切り分けているような感覚を覚えました。
開発をなされているコミッタの方々に感謝いたします。ありがとうございます。</p>

<p>普段 (というかこれまでの人生で一度も) 感謝したことはありませんが
暦を作った方 (方々？) に感謝いたします。ありがとうございます。</p>

<p>最後になりますが、
いつも陽に陰に支えてくれる妻と本記事が掲載される頃には産まれているはずの子供に
本記事を捧げたいと思います。 (読んでくれるかな？)</p>

<h2 id="著者について">著者について</h2>

<p>ふつうのプログラマ兼ソフトウェアエンジニア兼システムエンジニア。
カウンセリング、リーダーシップ、パターンランゲージなどが好き。
最近読んだおもしろい本は『<a href="http://www.hayakawa-online.co.jp/product/books/11971.html">火星の人</a>』、感動した本は『<a href="http://books.bunshun.jp/ud/book/num/9784163900704">きみは赤ちゃん</a>』。</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p><a href="https://twitter.com/swallow_life/status/561879404972765184">RectFeb の命名に関する筆者の一連のツイート</a>。本記事を書いている途中に、私と同じく RectFeb という命名をしている記事「<a href="http://www.vox.com/2015/2/13/8034855/february-pretty-rectangle">Cool take: February is a pretty rectangle</a>」を見つけました <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>http://www.nao.ac.jp/faq/a0306.html <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>http://ascii.jp/elem/000/000/143/143399/index-4.html <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
  </body>
</html>
