<!DOCTYPE html>
<html>
  



  <head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41117431-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-41117431-1');
  </script>
  <script src="../../js/gtag.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ruby ではじめるプログラミング 【第 2 回】</title>
  <meta name="description" content="">

  <script src="../../js/jquery.min.js"></script>
  <script src="../../js/bootstrap.min.js"></script>
  <link href="../../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../../css/theme.css" rel="stylesheet" type="text/css">
  <link href="../../css/syntax.css" rel="stylesheet" type="text/css">
  <link href="../../css/sharebutton.css" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="https://magazine.rubyist.net/articles/0003/0003-FirstProgramming.html">
  <link rel="alternate" type="application/rss+xml" title="Rubyist Magazine" href="https://magazine.rubyist.net/feed.xml">
  <link rel="shortcut icon" href="../../images/favicon.ico">
</head>

  <body>
    <div class="container-fluid">
        <div class="row full">
            <div class="col-md-2 hidden-xs sidebar">
                <h4>

</h4>

<h4>バックナンバー</h4>
<ul>
    <li><a href="../../articles/backnumber/backnumber.html">記事単位</a></li>
    <hr>
    
        <li><a href="../../articles/0061/0061-index.html">0061号(2020-02)</a></li>
    
        <li><a href="../../articles/0060/0060-index.html">0060号(2019-08)</a></li>
    
        <li><a href="../../articles/prerubykaigi2019/preRubyKaigi2019-index.html">RubyKaigi 2019 直前特集号</a></li>
    
        <li><a href="../../articles/0059/0059-index.html">0059号(2019-01)</a></li>
    
        <li><a href="../../articles/0058/0058-index.html">0058号(2018-08)</a></li>
    
        <li><a href="../../articles/prerubykaigi2018/preRubyKaigi2018-index.html">RubyKaigi 2018 直前特集号</a></li>
    
        <li><a href="../../articles/0057/0057-index.html">0057号(2018-02)</a></li>
    
        <li><a href="../../articles/prerubykaigi2017/preRubyKaigi2017-index.html">RubyKaigi 2017 直前特集号</a></li>
    
        <li><a href="../../articles/0056/0056-index.html">0056号(2017-08)</a></li>
    
        <li><a href="../../articles/0055/0055-index.html">0055号(2017-03)</a></li>
    
        <li><a href="../../articles/0054/0054-index.html">0054号(2016-08)</a></li>
    
        <li><a href="../../articles/pretokyorubykaigi11/preTokyoRubyKaigi11-index.html">東京 Ruby 会議 11 直前特集号</a></li>
    
        <li><a href="../../articles/0053/0053-index.html">0053号(2016-04)</a></li>
    
        <li><a href="../../articles/0052/0052-index.html">0052号(2015-12)</a></li>
    
        <li><a href="../../articles/0051/0051-index.html">0051号(2015-09)</a></li>
    
        <li><a href="../../articles/0050/0050-index.html">0050号(2015-05)</a></li>
    
        <li><a href="../../articles/0049/0049-index.html">0049号(2014-12)</a></li>
    
        <li><a href="../../articles/0048/0048-index.html">0048号(2014-09)</a></li>
    
        <li><a href="../../articles/0047/0047-index.html">0047号(2014-06)</a></li>
    
        <li><a href="../../articles/0046/0046-index.html">0046号(2014-04)</a></li>
    
        <li><a href="../../articles/0045/0045-index.html">0045号(2013-12)</a></li>
    
        <li><a href="../../articles/0044/0044-index.html">0044号(2013-09)</a></li>
    
        <li><a href="../../articles/0043/0043-index.html">0043号(2013-07)</a></li>
    
        <li><a href="../../articles/0042/0042-index.html">0042号(2013-05)</a></li>
    
        <li><a href="../../articles/ruby200specialen/Ruby200SpecialEn-index.html">2.0.0 Special (EN)</a></li>
    
        <li><a href="../../articles/0041/0041-index.html">0041号(2013-02)</a></li>
    
        <li><a href="../../articles/0040/0040-index.html">0040号(2012-11)</a></li>
    
        <li><a href="../../articles/0039/0039-index.html">0039号(2012-09)</a></li>
    
        <li><a href="../../articles/rubykaja/kaja.html">RubyKaja のご紹介</a></li>
    
        <li><a href="../../articles/0038/0038-index.html">0038号(2012-05)</a></li>
    
        <li><a href="../../articles/0037/0037-index.html">0037号(2012-02)</a></li>
    
        <li><a href="../../articles/0036/0036-index.html">0036号(2011-11)</a></li>
    
        <li><a href="../../articles/0035/0035-index.html">0035号(2011-09)</a></li>
    
        <li><a href="../../articles/prerubykaigi2011/preRubyKaigi2011-index.html">RubyKaigi2011直前特集号</a></li>
    
        <li><a href="../../articles/0034/0034-index.html">0034号(2011-06)</a></li>
    
        <li><a href="../../articles/0033/0033-index.html">0033号(2011-04)</a></li>
    
        <li><a href="../../articles/0032/0032-index.html">0032号(2011-01)</a></li>
    
        <li><a href="../../articles/0031/0031-index.html">0031号(2010-10)</a></li>
    
        <li><a href="../../articles/prerubykaigi2010/preRubyKaigi2010-index.html">RubyKaigi2010直前特集号</a></li>
    
        <li><a href="../../articles/0030/0030-index.html">0030号(2010-06)</a></li>
    
        <li><a href="../../articles/0029/0029-index.html">0029号(2010-03)</a></li>
    
        <li><a href="../../articles/0028/0028-index.html">0028号(2009-12)</a></li>
    
        <li><a href="../../articles/0027/0027-index.html">0027号(2009-09)</a></li>
    
        <li><a href="../../articles/0026/0026-index.html">0026号(2009-06)</a></li>
    
        <li><a href="../../articles/0025/0025-index.html">0025号(2009-02)</a></li>
    
        <li><a href="../../articles/0024/0024-index.html">0024号(2008-10)</a></li>
    
        <li><a href="../../articles/0023/0023-index.html">0023号(2008-03)</a></li>
    
        <li><a href="../../articles/0022/0022-index.html">0022号(2007-12)</a></li>
    
        <li><a href="../../articles/0021/0021-index.html">0021号(2007-09)</a></li>
    
        <li><a href="../../articles/0020/0020-index.html">0020号(2007-08)</a></li>
    
        <li><a href="../../articles/0019/0019-index.html">0019号(2007-05)</a></li>
    
        <li><a href="../../articles/0018/0018-index.html">0018号(2007-02)</a></li>
    
        <li><a href="../../articles/0017/0017-index.html">0017号(2006-11)</a></li>
    
        <li><a href="../../articles/0016/0016-index.html">0016号(2006-09)</a></li>
    
        <li><a href="../../articles/0015/0015-index.html">0015号(2006-07)</a></li>
    
        <li><a href="../../articles/rubykaigi2006/RubyKaigi2006-index.html">日本 Ruby カンファレンス 2006 特別号</a></li>
    
        <li><a href="../../articles/0014/0014-index.html">0014号(2006-05)</a></li>
    
        <li><a href="../../articles/0013/0013-index.html">0013号(2006-02)</a></li>
    
        <li><a href="../../articles/0012/0012-index.html">0012号(2005-12)</a></li>
    
        <li><a href="../../articles/0011/0011-index.html">0011号(2005-11)</a></li>
    
        <li><a href="../../articles/0010/0010-index.html">0010号(2005-10)</a></li>
    
        <li><a href="../../articles/0009/0009-index.html">0009号(2005-09)</a></li>
    
        <li><a href="../../articles/0008/0008-index.html">0008号(2005-07)</a></li>
    
        <li><a href="../../articles/0007/0007-index.html">0007号(2005-06)</a></li>
    
        <li><a href="../../articles/0006/0006-index.html">0006号(2005-05)</a></li>
    
        <li><a href="../../articles/0005/0005-index.html">0005号(2005-02)</a></li>
    
        <li><a href="../../articles/0004/0004-index.html">0004号(2004-12)</a></li>
    
        <li><a href="../../articles/0003/0003-index.html">0003号(2004-11)</a></li>
    
        <li><a href="../../articles/0002/0002-index.html">0002号(2004-10)</a></li>
    
        <li><a href="../../articles/0001/0001-index.html">0001号(2004-09)</a></li>
    
</ul>
<p class="rss-subscribe"><a href="/feed.xml">RSS</a></p>

            </div>
            <div class="col-md-10 main">
                <div class="row">
                    <div class="col-md-12">
                        <img src="../../images/rubima_logo_l.png">
                        <h1>Ruby ではじめるプログラミング 【第 2 回】</h1>
                        <div class="social-buttons">
                            <div class='sns'>            
    <ul class="clearfix">
       <li class="twitter"><a href="https://twitter.com/share?text=Ruby ではじめるプログラミング 【第 2 回】&amp;url=https://magazine.rubyist.net/articles/0003/0003-FirstProgramming.html" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-twitter"></i></a></li>
       <li class="facebook"><a href="https://www.facebook.com/sharer.php?u=https://magazine.rubyist.net/articles/0003/0003-FirstProgramming.html&amp;t=Ruby ではじめるプログラミング 【第 2 回】" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-facebook"></i></a></li>
       <li class="hatebu"><a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=https://magazine.rubyist.net/articles/0003/0003-FirstProgramming.html&amp;Ruby ではじめるプログラミング 【第 2 回】" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa">B!</i></a></li>
    </ul>
</div>
                        </div>
                        <div class="post_info">
                            

  <span class="created_on">初稿：2004-11-15</span>



                        </div>
                        
<p>著者：だん</p>

<h2 id="はじめに">はじめに</h2>

<dl>
  <dt>前回 (<a href="../../articles/0002/0002-FirstProgramming.html">Ruby ではじめるプログラミング 【第 1 回】</a>) は次のこのようなプログラムの基本的な部分を紹介しました。</dt>
  <dd><img src="../../images/0003-FirstProgramming/mage2_s.png" alt="mage2_s.png" /></dd>
</dl>

<ul>
  <li>Ruby を実行するまでの手順</li>
  <li>変数やメソッド（命令）呼び出し</li>
  <li>プログラムには流れがあるということ</li>
  <li>制御命令を使って流れをコントロールできるということ</li>
</ul>

<p>今回は知っているととても便利な機能を紹介します。</p>

<h2 id="式展開">式展開</h2>

<p>「あなたの名前は○○○です。」の○○○の部分に変数を当てはめて表示するプログラムを作ってみましょう。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts '名前を入力してください。'
name = gets
print 'あなたの名前は'
print name
puts 'です。'</code></pre></figure>

<p>puts メソッドを使うと途中で改行されてしまうので、改行を行わない print メソッドを使用しています。しかし、このプログラムを実行すると期待通りの結果になりません。</p>

<p>「名前を入力してください。」と表示されたらキーボードから dan と入力してみます。
すると、実行結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">あなたの名前はdan
です。</code></pre></figure>

<p>dan のところで改行されてしまいました。これは gets メソッドで入力した文字列データの最後には改行コードが付いているからです。文字列の末尾の改行コードは __chomp メソッド__で取り除くことができます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts '名前を入力してください。'
name = gets.chomp
print 'あなたの名前は'
print name
puts 'です。'</code></pre></figure>

<p>実行結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">あなたの名前はdanです。</code></pre></figure>

<p>gets の後ろにある <strong>chomp</strong> は gets の戻り値である文字列を操作するメソッドです。入力された文字列の末尾の改行コードを取り除いてから変数 name に代入しているわけです。</p>

<h3 id="式展開で文字列に変数を埋め込む">式展開で文字列に変数を埋め込む</h3>

<p>このプログラムは__式展開__という機能を使うとこのように書くことができます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts '名前を入力してください。'
name = gets.chomp
puts "あなたの名前は#{ name }です。"</code></pre></figure>

<p>__ #{} <strong>の中に変数を書いておくと、その変数の中身が文字列として埋め込まれます。
それから、式展開の機能を使うためには文字列を</strong> ‘ （シングルコーテーション）<strong>ではなく</strong> “（ダブルコーテーション）__で囲む必要があります。</p>

<p>また、実は__ #{} __の中には変数以外にもいろいろなものを書くことができます。例えば四則演算やメソッド呼び出しが書けます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts "1+1= #{1+1} です。"
puts "10*10+5= #{10*10+5} です。"</code></pre></figure>

<p>このプログラムは実行すると次のようになります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">1+1= 2 です。
10*10+5= 105 です。</code></pre></figure>

<p>もちろん変数を使うこともできます。また、式展開では数値も自動的に文字列へ変換されます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">a = 5
b = 2
puts "#{a}+#{b}= #{a+b} です。"
puts "#{a}-#{b}= #{a-b} です。"</code></pre></figure>

<p>このプログラムは実行すると次のようになります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">5+2= 7 です。
5-2= 3 です。</code></pre></figure>

<p>自分で実際に動かしながらいろいろ遊んでみてください。</p>

<h3 id="やってみようその-1-">やってみよう（その 1 ）</h3>

<p>式展開を使って作った文字列を変数に代入し、その変数を別の文字列の中で式展開してみましょう。</p>

<h2 id="p-メソッド">p メソッド</h2>

<p>__p メソッド__を使うと様々な__オブジェクト__の中身を人間に__わかりやすい形で表示__することができます。</p>

<p>__オブジェクト__とは、これまでに紹介した__数値__や__文字列データ__のことです。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">p 100
p 'abc'</code></pre></figure>

<p>この__ 100 <strong>や</strong> ‘abc’ __が__オブジェクト__です。このプログラムを実行すると次のような結果が表示されます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">100
"abc"</code></pre></figure>

<p>文字列データ（文字列オブジェクト）は “ で囲まれて表示されます。
次のようにオブジェクトを変数に代入しても同様に中身を表示することができます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">a = 100
b = 'abc'
p a
p b</code></pre></figure>

<p>gets メソッドの戻り値を p メソッドで表示してみましょう</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">name = gets
p name</code></pre></figure>

<p>実行結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">dan           # ここで dan と入力する
"dan\n"</code></pre></figure>

<p>入力した文字列が表示されていますが、文字列の最後に__ \n __という文字が付いています。この \n が改行コードです。
改行コードを出力すると、コマンドプロンプト上では改行して表示されます。</p>

<p>chomp メソッドを使って末尾の改行コードを取り除くとこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">name = gets.chomp
p name</code></pre></figure>

<p>実行結果です。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">dan           # ここで dan と入力する
"dan"</code></pre></figure>

<p>\n がなくなっているのがわかりますね。</p>

<p>p メソッドを使うといろいろなオブジェクトの中身を表示することができます。</p>

<h2 id="times-によるループ">times によるループ</h2>

<p>__times メソッド__は前回も紹介しました。 times には便利な機能があるので紹介します。</p>

<p>times を使用したサンプルプログラムです。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">5.times do |n|
  puts n
end</code></pre></figure>

<p>実行結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">0
1
2
3
4</code></pre></figure>

<table>
  <tbody>
    <tr>
      <td>5.times do の後ろに__</td>
      <td>n</td>
      <td>__という見慣れないコードがあります。</td>
    </tr>
  </tbody>
</table>

<p>この n は変数です。変数 n には 0,1,2,3,4 が順番に n に代入されながらループ処理が実行されていきます。この機能はこの後の配列の解説でも使用するので覚えておいてください。</p>

<h2 id="エラー">エラー</h2>

<p>便利な機能の紹介からは話がずれますが、ここではエラーについて簡単に説明します。</p>

<p>いざプログラムを実行してみると、思わぬ__エラー__が発生してプログラムが動かないことがあります。
エラーは単純な入力ミスや誤った文法でプログラムを書けばすぐに発生します。
エラーが発生すると、その原因を調べるための手がかりが__エラーメッセージ__として表示されます。</p>

<p>では、わざとエラーを起こしてエラーメッセージを実際に確認してみましょう。</p>

<h3 id="エラーになるプログラム">エラーになるプログラム</h3>

<p>これは変数 a を表示する正常なプログラムです。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">a = 0
puts a</code></pre></figure>

<p>エラーが起こるように 1 行目をわざとコメントにします。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># a = 0
puts a</code></pre></figure>

<p>このプログラムを実行すると次のようなエラーメッセージが表示されます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">test.rb:2: undefined local variable or method `a' for main:Object (NameError)</code></pre></figure>

<p>このエラーメッセージは a という名前の変数やメソッドは存在しないということを知らせています。</p>

<p>次のプログラムでは文字列データの「こんにちは」の最後に ‘ がありません。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts 'こんにちは</code></pre></figure>

<p>これを実行すると、文字列が閉じられていないという旨のエラーメッセージが表示されます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">test.rb:1: unterminated string meets end of file</code></pre></figure>

<p>次のプログラムは if に対応する end をコメントにして消してあります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">a = 0
if a == 0
  puts 'a は 0 です。'
# end</code></pre></figure>

<p>これもエラーになります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">test.rb:5: syntax error</code></pre></figure>

<p>「syntax error」は文法が間違っているときに出るエラーメッセージです。</p>

<h3 id="行番号に注目">行番号に注目</h3>

<p>それぞれのエラーメッセージの先頭を見ると <strong>test.rb:数字:</strong> と表示されています。
test.rb はプログラムのソースファイル名です。その後ろの数字はエラーが発生している場所の__行番号__を示しています。</p>

<p>エラーには他にも種類がありますが、ほとんどの場合は該当する行番号の部分になんらかの間違いがあります。エラーが発生した場合はエラーメッセージを頼りにもう一度ソースファイルをよく確かめてみてください。</p>

<p>基本的にエラーメッセージは英語で表示されるのでつい敬遠したくなるかもしれません。しかし、エラーメッセージはトラブル解決の重要な手がかりになるので、英語が苦手でも注意深く見るようにしてください。</p>

<h2 id="配列">配列</h2>

<p>多くのプログラミング言語には__配列（はいれつ）__という便利な機能があります。もちろん Ruby でも配列を使うことができます。</p>

<p>配列は少々難しい機能ですが、Ruby プログラミングを修得するうえでは避けて通れません。とても重要な機能なので、ここでは配列についてあせらずじっくりと解説します。</p>

<h3 id="配列を作る">配列を作る</h3>

<p>配列を使うと複数のオブジェクト（データ）をひとまとめにすることができます。配列を作るにはいくつかの方法がありますが、今回紹介するのはこの形です。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">変数名 = [オブジェクト0, オブジェクト1, オブジェクト2, ……]</code></pre></figure>

<p>オブジェクト（データ）を <strong>,</strong> で区切ってデータ全体を__ [ <strong>と</strong> ] __で囲みます。そして作られた配列に変数を使って名前を付けます。</p>

<p>次のプログラムを見てください。ある 3 人の身長データを配列でまとめたものです。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">values = [150, 174, 180]</code></pre></figure>

<p>このプログラムでは 150 と 174 と 180 という 3 つのデータをひとまとめにして、それに values という名前を付けています。values は好きなように決めることができる変数名です。</p>

<p>values の中身は 3 つの数字が順番に並んだ配列です。150 という数値にアクセスするには次のようにします。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">values[0]</code></pre></figure>

<p>これで 150 という数値を取り出すことができます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">values = [150, 174, 180]
p values[0] # 150 を表示
p values[1] # 174 を表示
p values[2] # 180 を表示</code></pre></figure>

<p>実行結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">150
174
180</code></pre></figure>

<p>__ = __を使って内容を変更することもできます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">values = [150, 174, 180]
values[0] = 155
p values[0] # 中身は 150 から 155 に変わっている
p values[1]
p values[2]</code></pre></figure>

<p>実行結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">155
174
180</code></pre></figure>

<p>ここでひとつ注意があります。上記のコードを見るとわかるように配列内の最初のデータは values[1] ではなく values[0] で得られます。
2 番目のデータは values[1]、3 番目のデータは values[2] です。普段わたしたちはモノを数えるときは 1 から 1, 2, 3, ……と数えますが、コンピュータは 0 から 0, 1, 2, …… と数えるのです。この慣習は少々やっかいですが、慣れればたいしたことはありません。</p>

<h3 id="添字インデックス">添字（インデックス）</h3>

<p>values の 後ろに書いた [0] や [1] の数字部分を__添字（そえじ）__といいます。添字は__インデックス__と呼ばれることもあります。添字には数値を代入した変数を用いることができます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">values = [150, 174, 180]
index = 1          # 変数 index に 1 を代入
p values[index] # 174 が表示される</code></pre></figure>

<p>これはとても便利です。前回紹介した「じゃんけんロボット」は、配列を使うと次のように書くことができます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">puts 'じゃんけん'
sleep 1
values = ['グー', 'チョキ', 'パー']
r = rand(3) # r に 0 ? 2 の乱数を代入
puts values[r]</code></pre></figure>

<p>なんと if 文も case 文もなくなってしまいました。プログラム全体が短くなりましたね。</p>

<p>配列の中には数値だけでなく、文字列やその他のオブジェクトを入れることもできます。</p>

<h3 id="平均身長">平均身長</h3>

<p>次のプログラムは配列にセットされた身長データから、全員の平均身長を求めるプログラムです。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">180</span><span class="p">]</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">values</span><span class="p">.</span><span class="nf">size</span>
<span class="nb">puts</span> <span class="s2">"values には </span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2"> 人分のデータがあります。"</span>

<span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">n</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">index</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"身長が </span><span class="si">#{</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> cm の人がいます。"</span>
  <span class="n">total</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">"全員の身長の合計は </span><span class="si">#{</span><span class="n">total</span><span class="si">}</span><span class="s2"> cm です。"</span>
<span class="nb">puts</span> <span class="s2">"全員の身長の平均は </span><span class="si">#{</span><span class="n">total</span><span class="o">/</span><span class="n">n</span><span class="si">}</span><span class="s2"> cm です。"</span>

</code></pre></div></div>

<p>3 行目の__ .size __は配列の要素数を返すメソッドです。ここでは変数 n に 3 が代入されます。</p>

<p>7 行目の index は変数です。index には 0, 1, 2 から順に数値が代入されながらループ処理が実行されていきます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">total += values[index]</code></pre></figure>

<p>この部分は変数 total に values[index] の値を加算する処理です。</p>

<p>この平均身長計算プログラムの実行結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">values には 3 人分のデータがあります。
身長が 150 cm の人がいます。
身長が 174 cm の人がいます。
身長が 180 cm の人がいます。
全員の身長の合計は 504 cm です。
全員の身長の平均は 168 cm です。</code></pre></figure>

<p>values の中身を変更・追加していろいろ試してみてください。</p>

<h3 id="配列もオブジェクト">配列もオブジェクト</h3>

<p>配列の中にはどんなオブジェクトも入れることもできます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">values = [0, 5, 'abc', 'あいう']</code></pre></figure>

<p>そして、配列もひとつのオブジェクトとしてあつかうことができます。p メソッドで中身を表示してみましょう。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">values = [0, 5, 'abc', 'xyz']
p values</code></pre></figure>

<p>実行結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">[0, 5, "abc", "xyz"]</code></pre></figure>

<p>p メソッドを使うといつでも簡単に配列の中身を確認できるのでとても便利です。
__配列全体もひとつのオブジェクト__だったのです。</p>

<h3 id="配列データの追加と削除">配列データの追加と削除</h3>

<p>__push メソッド__で配列の最後にオブジェクト（データ）を追加することができます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">values = []    # 空の配列を作成
p values       # values の中身を表示
values.push 0  # values に 0 を追加
p values
values.push 1  # values に 1 を追加
p values</code></pre></figure>

<p>実行結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">[]
[0]
[0, 1]</code></pre></figure>

<p>__pop メソッド__で配列の最後のオブジェクト（データ）を取り出すことができます。取り出したオブジェクトは配列から削除されます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">values = ['a', 'b']
p values
puts values.pop  # values から 'b' を削除
p values
puts values.pop  # values から 'a' を削除
p values</code></pre></figure>

<p>実行結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">["a", "b"]
["a"]
[]</code></pre></figure>

<h3 id="配列の中に配列多次元配列">配列の中に配列（多次元配列）</h3>

<p>配列にはどんなオブジェクトでも入れることができます。そして、配列もひとつのオブジェクトなので、配列に配列を入れることもできます。</p>

<p>試してみましょう。 tbl はただの変数名です。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">tbl = [[0,1,2], [3,4,5], ['a','b','c']]
p tbl</code></pre></figure>

<p>このプログラムでは、配列 tbl の中に 3 つの配列オブジェクトが入っています。このように配列の中に配列があるオブジェクトを 2 次元配列といいます。</p>

<p>実行してみましょう。表示結果はこうなります。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">[[0, 1, 2], [3, 4, 5], ["a", "b", "c"]]</code></pre></figure>

<p>p メソッドは、多次元配列の中身も表示してくれます。</p>

<p>tbl から要素を取り出すにはこうします。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">tbl = [[0,1,2], [3,4,5], ['a','b','c']]
p tbl[0]
p tbl[1]
p tbl[2]
p tbl[0][0]
p tbl[0][1]
p tbl[0][2]
p tbl[2][0]
p tbl[2][1]</code></pre></figure>

<p>実行結果です。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">[0, 1, 2]
[3, 4, 5]
["a", "b", "c"]
0
1
2
"a"
"b"</code></pre></figure>

<p>tbl[0] は [0, 1, 2] を指しています。 tbl[0][0] で 0 を取り出すことができます。 tbl[0][1] で 1 を tbl[2][0] で 3 を取り出すことができます。</p>

<p>プログラムと実行結果を照らし合わせて、どのような仕組みになっているのか自分で考えてみてください。</p>

<p>さて、同じ配列定義をこのように書くこともできます。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">tbl = [
  [0,1,2],
  [3,4,5],
  ['a','b','c'],
]
p tbl</code></pre></figure>

<p>実行結果はまったく同じです。要素の数が多い場合はこのように改行を入れた方が見やすくなります。</p>

<p>2 次元配列と先ほど説明した times のループ機能を使ってこのようなプログラムを作ってみました。画面にある文字絵を表示するプログラムです。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tbl</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">y_max</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">.</span><span class="nf">size</span>
<span class="n">y_max</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">y</span><span class="o">|</span>
  <span class="n">x_max</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="nf">size</span>
  <span class="n">x_max</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
    <span class="k">if</span> <span class="n">tbl</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
      <span class="nb">print</span> <span class="s2">"■"</span>
    <span class="k">else</span>
      <span class="nb">print</span> <span class="s2">"□"</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="nb">print</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="c1"># 改行する</span>
<span class="k">end</span>

</code></pre></div></div>

<p>2 重ループと 2 次元配列を使ったすこしややこしいプログラムですが、もう特に説明する必要はないでしょう。
パズルゲームを解く気持ちでひとつひとつの処理を自分で追ってみてください。</p>

<h3 id="やってみようその-2-">やってみよう（その 2 ）</h3>

<p>このプログラムを 3 次元配列（ 3 重ループ）に改造して複数の絵を表示するプログラムを作成してください。</p>

<h2 id="配列を使ったゲームブック">配列を使ったゲームブック</h2>

<p>前回作成したゲームブックプログラムを配列を使って作ってみます。
プログラムを見ただけでは動作をイメージできないので、実際に実行してから次のソースを見てください。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">msg0</span> <span class="o">=</span> <span class="s2">"３本の分かれ道があります。どの道を進みますか。</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span>
       <span class="s2">"  1 左の道</span><span class="se">\n</span><span class="s2">  2 真ん中の道</span><span class="se">\n</span><span class="s2">  3 右の道"</span>
<span class="n">msg1</span> <span class="o">=</span> <span class="s2">"あっ！</span><span class="se">\n</span><span class="s2">落とし穴に落ちてしまいました。</span><span class="se">\n</span><span class="s2">〜 GAME "</span> <span class="o">+</span>
       <span class="s2">"OVER 〜"</span>
<span class="n">msg2</span> <span class="o">=</span> <span class="s2">"真ん中の道をまっすぐ歩いていくと……</span><span class="se">\n</span><span class="s2">宝箱をみつ"</span> <span class="o">+</span>
       <span class="s2">"けました！</span><span class="se">\n</span><span class="s2">  1 そのままにしておく</span><span class="se">\n</span><span class="s2">  2 あける"</span>
<span class="n">msg3</span> <span class="o">=</span> <span class="s2">"しばらく歩き続けると　もとの場所にもどってしまい"</span> <span class="o">+</span>
       <span class="s2">"ました。</span><span class="se">\n</span><span class="s2">  1 次へ"</span>
<span class="n">msg4</span> <span class="o">=</span> <span class="s2">"宝箱には見向きもせず　お家に帰りました。</span><span class="se">\n</span><span class="s2">〜 GAM"</span> <span class="o">+</span>
       <span class="s2">"E OVER 〜"</span>
<span class="n">msg5</span> <span class="o">=</span> <span class="s2">"パカッ</span><span class="se">\n</span><span class="s2">まばゆい光があふれだす……</span><span class="se">\n</span><span class="s2">１００枚の金"</span> <span class="o">+</span>
       <span class="s2">"貨を手に入れました！"</span>

<span class="n">tbl</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="n">msg0</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span>   <span class="mi">3</span><span class="p">],</span>
  <span class="p">[</span><span class="n">msg1</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">],</span>
  <span class="p">[</span><span class="n">msg2</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="kp">nil</span><span class="p">],</span>
  <span class="p">[</span><span class="n">msg3</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">],</span>
  <span class="p">[</span><span class="n">msg4</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">],</span>
  <span class="p">[</span><span class="n">msg5</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">scene</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="kp">true</span>
  <span class="n">scene_data</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="n">scene</span><span class="p">]</span>
  <span class="n">message</span> <span class="o">=</span> <span class="n">scene_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="n">message</span>

  <span class="k">if</span> <span class="n">scene_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kp">nil</span>
    <span class="nb">exit</span>
  <span class="k">end</span>

  <span class="nb">print</span> <span class="s1">'  数字を入力してください '</span>
  <span class="n">input_value</span> <span class="o">=</span> <span class="nb">gets</span><span class="p">.</span><span class="nf">to_i</span>

  <span class="k">if</span> <span class="n">input_value</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">next_scene</span> <span class="o">=</span> <span class="n">scene_data</span><span class="p">[</span><span class="n">input_value</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">next_scene</span> <span class="o">==</span> <span class="kp">nil</span>
      <span class="nb">puts</span> <span class="s1">'不正な値が入力されました'</span>
    <span class="k">else</span>
      <span class="n">scene</span> <span class="o">=</span> <span class="n">next_scene</span>
    <span class="k">end</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s1">'不正な値が入力されました'</span>
  <span class="k">end</span>

  <span class="nb">sleep</span> <span class="mf">0.5</span>
  <span class="nb">print</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">end</span>

</code></pre></div></div>

<p>先頭の msg0 ? msg5 はゲームの各場面で表示するメッセージです。スペースの都合で 2 行に渡って文字列を代入しています。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">m0 = "abcxyz"
m1 = "abc" + "xyz"
m2 = "abc" +
     "xyz"</code></pre></figure>

<p>m0, m1, m2 はまったく同じ内容になります。</p>

<h3 id="tbl-のデータ構造">tbl のデータ構造</h3>

<p>14 行目の tbl は シーンデータの配列です。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">tbl = [
  シーンデータ,
  シーンデータ,
  シーンデータ,
]</code></pre></figure>

<p>シーンデータはそのシーンで表示する「メッセージ」と「ジャンプ先 ID」の配列です。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">["メッセージ", ジャンプ先 ID1, ジャンプ先 ID2, ジャンプ先 ID3 ]</code></pre></figure>

<p>「ジャンプ先 ID 」にはそのシーンで選択された選択肢に対応したジャンプ先の ID （インデックス）を入れておきます。</p>

<ul>
  <li>__選択肢 1 __が選択されたときは「ジャンプ先 ID1 」へジャンプする</li>
  <li>__選択肢 2 __が選択されたときは「ジャンプ先 ID2 」へジャンプする</li>
  <li>__選択肢 3 __が選択されたときは「ジャンプ先 ID3 」へジャンプする</li>
</ul>

<p><strong>nil</strong> は特別なオブジェクトです。今回は nil について説明しませんが、選択肢がない場合は nil を入れておくことにします。また、__選択肢 1 __が nil だった場合はそのシーンでゲームを終了することにします。</p>

<p>まとめると tbl は以下のような構造の 2 次元配列です。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">tbl = [
  ["メッセージ", ジャンプ先 ID1, ジャンプ先 ID2, ジャンプ先 ID3 ],
  ["メッセージ", ジャンプ先 ID1, ジャンプ先 ID2, ジャンプ先 ID3 ],
  ["メッセージ", ジャンプ先 ID1, ジャンプ先 ID2, ジャンプ先 ID3 ],
]</code></pre></figure>

<h3 id="シーンデータを取り出す">シーンデータを取り出す</h3>

<figure class="highlight"><pre><code class="language-text" data-lang="text">scene_data = tbl[scene]</code></pre></figure>

<p>でその場面のシーンデータ（メッセージとジャンプ先 ID）の配列を変数 scene_data に代入しています。変数 scene には場面番号が入っています。場面番号が tbl のインデックスとなり、tbl[scene] でその場面のシーンを取り出すことができます。</p>

<h3 id="プログラムの終了条件">プログラムの終了条件</h3>

<figure class="highlight"><pre><code class="language-text" data-lang="text">if scene_data[1] == nil
  exit
end</code></pre></figure>

<p>という部分は「ジャンプ先 ID」が <strong>nil</strong> だったらプログラムを終了するという意味です。</p>

<h3 id="シーンの変更">シーンの変更</h3>

<p>input_value には選択された数字が代入されます。gets.to_i で入力された文字を数値に変換していますが、to_i メソッドは数字以外の文字が与えられた場合は 0 を返します。</p>

<p>input_value が 0 より大きい値だった場合は正常処理を行い、それ以外（0 以下）の場合は不正な値が入力されたとみなし、シーン変更の処理は行いません。 36 行目がこの場合わけの判定になります。</p>

<p>input_value が 0 より大きい値だった場合は</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">next_scene = scene_data[input_value]</code></pre></figure>

<p>で次のシーンの番号を取り出します。ここで問題があります。input_value の値が 4 以上だった場合はシーンデータ配列の範囲外のデータを取り出そうとしてしまいます。Ruby では配列の範囲外のデータを取り出そうとした場合は <strong>nil</strong> が返ります。38 行目の</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">if next_scene == nil</code></pre></figure>

<p>で場合わけをすれば next_scene に正しい値が代入できたかどうかが判定できます。
正しい値だった場合は 41 行目の</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">scene = next_scene</code></pre></figure>

<p>で scene を書き換えます。scene が書き換わると場面も移行します。</p>

<h3 id="配列の利点">配列の利点</h3>

<p>前回は場面をすべて if 文や case 文で場合わけすることで処理していました。
つまり場面が増えるとその分 if 文や case 文の場合わけを追加して制御構造を追加する必要がありました。</p>

<p>しかし、今回のプログラムではシーンデータを配列データにしたことにより、場面を増やす場合は配列内のデータを増やすだけです。シーンをいくつ増やしても制御構造を増やす必要はありません。これはとても大きなメリットです。テーブルデータを変更するだけで新しいシナリオを追加したり、シーンジャンプの仕組みを変更したりできます。</p>

<h3 id="やってみようその-3">やってみよう（その 3）</h3>

<p>テーブルデータを変更して新しいシナリオのゲームを作成しながら遊んでみてください。
面白いスクリプトができたら、ぜひ <a href="mailto:magazine@ruby-no-kai.org">るびま編集部</a> まで送ってください。</p>

<h2 id="まとめ">まとめ</h2>

<p>今回はいくつかの便利な機能と配列について紹介しました。
そして、特に配列に重点を置いて解説しました。</p>

<p>配列を使ってゲームで使用するメッセージやシーンのジャンプデータをテーブル化する方法はとても便利です。
プロジェクトが大きくなればなるほど、このような工夫が開発効率を高めることにつながります。そして、開発効率がよくなれば同じ労力でより優れたアプリケーションが作ることができます。</p>

<p>次回は今回紹介したデータテーブルをより使いやすくする方法を紹介します。</p>

<h2 id="著者について">著者について</h2>

<p>だん (dan at dgames dot jp)</p>

<p>ゲームメーカーに勤めるゲームクリエイター。</p>

<p>最近までずっとコンシューマーゲームソフトの開発という閉じた世界にいた。
Ruby 歴は 2 年と短く、まだまだ勉強中の初心者。</p>

<h2 id="ruby-ではじめるプログラミング-連載一覧">Ruby ではじめるプログラミング 連載一覧</h2>

<ul>
  <li>
    <p><a href="../../articles/0005/0005-FirstProgramming.html">Ruby ではじめるプログラミング 【最終回】</a></p>
  </li>
  <li>
    <p><a href="../../articles/0004/0004-FirstProgramming.html">Ruby ではじめるプログラミング 【第 3 回】</a></p>
  </li>
  <li>
    <p><a href="../../articles/0003/0003-FirstProgramming.html">Ruby ではじめるプログラミング 【第 2 回】</a></p>
  </li>
  <li>
    <p><a href="../../articles/0002/0002-FirstProgramming.html">Ruby ではじめるプログラミング 【第 1 回】</a></p>
  </li>
</ul>

<hr />


                    </div>
                </div>
            </div>
        </div>
    </div>
  </body>
</html>
