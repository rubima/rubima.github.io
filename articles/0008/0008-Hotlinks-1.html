<!DOCTYPE html>
<html>
  



  <head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41117431-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-41117431-1');
  </script>
  <script src="../../js/gtag.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Rubyist Hotlinks 【第 8 回】 田中哲さん その1</title>
  <meta name="description" content="">

  <script src="../../js/jquery.min.js"></script>
  <script src="../../js/bootstrap.min.js"></script>
  <link href="../../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../../css/theme.css" rel="stylesheet" type="text/css">
  <link href="../../css/syntax.css" rel="stylesheet" type="text/css">
  <link href="../../css/sharebutton.css" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="https://magazine.rubyist.net/articles/0008/0008-Hotlinks-1.html">
  <link rel="alternate" type="application/rss+xml" title="Rubyist Magazine" href="https://magazine.rubyist.net/feed.xml">
  <link rel="shortcut icon" href="../../images/favicon.ico">
</head>

  <body>
    <div class="container-fluid">
        <div class="row full">
            <div class="col-md-2 hidden-xs sidebar">
                <h4>

</h4>

<h4>バックナンバー</h4>
<ul>
    <li><a href="../../articles/backnumber/backnumber.html">記事単位</a></li>
    <hr>
    
        <li><a href="../../articles/0060/0060-index.html">0060号(2019-08)</a></li>
    
        <li><a href="../../articles/prerubykaigi2019/preRubyKaigi2019-index.html">RubyKaigi 2019 直前特集号</a></li>
    
        <li><a href="../../articles/0059/0059-index.html">0059号(2019-01)</a></li>
    
        <li><a href="../../articles/0058/0058-index.html">0058号(2018-08)</a></li>
    
        <li><a href="../../articles/prerubykaigi2018/preRubyKaigi2018-index.html">RubyKaigi 2018 直前特集号</a></li>
    
        <li><a href="../../articles/0057/0057-index.html">0057号(2018-02)</a></li>
    
        <li><a href="../../articles/prerubykaigi2017/preRubyKaigi2017-index.html">RubyKaigi 2017 直前特集号</a></li>
    
        <li><a href="../../articles/0056/0056-index.html">0056号(2017-08)</a></li>
    
        <li><a href="../../articles/0055/0055-index.html">0055号(2017-03)</a></li>
    
        <li><a href="../../articles/0054/0054-index.html">0054号(2016-08)</a></li>
    
        <li><a href="../../articles/pretokyorubykaigi11/preTokyoRubyKaigi11-index.html">東京 Ruby 会議 11 直前特集号</a></li>
    
        <li><a href="../../articles/0053/0053-index.html">0053号(2016-04)</a></li>
    
        <li><a href="../../articles/0052/0052-index.html">0052号(2015-12)</a></li>
    
        <li><a href="../../articles/0051/0051-index.html">0051号(2015-09)</a></li>
    
        <li><a href="../../articles/0050/0050-index.html">0050号(2015-05)</a></li>
    
        <li><a href="../../articles/0049/0049-index.html">0049号(2014-12)</a></li>
    
        <li><a href="../../articles/0048/0048-index.html">0048号(2014-09)</a></li>
    
        <li><a href="../../articles/0047/0047-index.html">0047号(2014-06)</a></li>
    
        <li><a href="../../articles/0046/0046-index.html">0046号(2014-04)</a></li>
    
        <li><a href="../../articles/0045/0045-index.html">0045号(2013-12)</a></li>
    
        <li><a href="../../articles/0044/0044-index.html">0044号(2013-09)</a></li>
    
        <li><a href="../../articles/0043/0043-index.html">0043号(2013-07)</a></li>
    
        <li><a href="../../articles/0042/0042-index.html">0042号(2013-05)</a></li>
    
        <li><a href="../../articles/ruby200specialen/Ruby200SpecialEn-index.html">2.0.0 Special (EN)</a></li>
    
        <li><a href="../../articles/0041/0041-index.html">0041号(2013-02)</a></li>
    
        <li><a href="../../articles/0040/0040-index.html">0040号(2012-11)</a></li>
    
        <li><a href="../../articles/0039/0039-index.html">0039号(2012-09)</a></li>
    
        <li><a href="../../articles/rubykaja/kaja.html">RubyKaja のご紹介</a></li>
    
        <li><a href="../../articles/0038/0038-index.html">0038号(2012-05)</a></li>
    
        <li><a href="../../articles/0037/0037-index.html">0037号(2012-02)</a></li>
    
        <li><a href="../../articles/0036/0036-index.html">0036号(2011-11)</a></li>
    
        <li><a href="../../articles/0035/0035-index.html">0035号(2011-09)</a></li>
    
        <li><a href="../../articles/prerubykaigi2011/preRubyKaigi2011-index.html">RubyKaigi2011直前特集号</a></li>
    
        <li><a href="../../articles/0034/0034-index.html">0034号(2011-06)</a></li>
    
        <li><a href="../../articles/0033/0033-index.html">0033号(2011-04)</a></li>
    
        <li><a href="../../articles/0032/0032-index.html">0032号(2011-01)</a></li>
    
        <li><a href="../../articles/0031/0031-index.html">0031号(2010-10)</a></li>
    
        <li><a href="../../articles/prerubykaigi2010/preRubyKaigi2010-index.html">RubyKaigi2010直前特集号</a></li>
    
        <li><a href="../../articles/0030/0030-index.html">0030号(2010-06)</a></li>
    
        <li><a href="../../articles/0029/0029-index.html">0029号(2010-03)</a></li>
    
        <li><a href="../../articles/0028/0028-index.html">0028号(2009-12)</a></li>
    
        <li><a href="../../articles/0027/0027-index.html">0027号(2009-09)</a></li>
    
        <li><a href="../../articles/0026/0026-index.html">0026号(2009-06)</a></li>
    
        <li><a href="../../articles/0025/0025-index.html">0025号(2009-02)</a></li>
    
        <li><a href="../../articles/0024/0024-index.html">0024号(2008-10)</a></li>
    
        <li><a href="../../articles/0023/0023-index.html">0023号(2008-03)</a></li>
    
        <li><a href="../../articles/0022/0022-index.html">0022号(2007-12)</a></li>
    
        <li><a href="../../articles/0021/0021-index.html">0021号(2007-09)</a></li>
    
        <li><a href="../../articles/0020/0020-index.html">0020号(2007-08)</a></li>
    
        <li><a href="../../articles/0019/0019-index.html">0019号(2007-05)</a></li>
    
        <li><a href="../../articles/0018/0018-index.html">0018号(2007-02)</a></li>
    
        <li><a href="../../articles/0017/0017-index.html">0017号(2006-11)</a></li>
    
        <li><a href="../../articles/0016/0016-index.html">0016号(2006-09)</a></li>
    
        <li><a href="../../articles/0015/0015-index.html">0015号(2006-07)</a></li>
    
        <li><a href="../../articles/rubykaigi2006/RubyKaigi2006-index.html">日本 Ruby カンファレンス 2006 特別号</a></li>
    
        <li><a href="../../articles/0014/0014-index.html">0014号(2006-05)</a></li>
    
        <li><a href="../../articles/0013/0013-index.html">0013号(2006-02)</a></li>
    
        <li><a href="../../articles/0012/0012-index.html">0012号(2005-12)</a></li>
    
        <li><a href="../../articles/0011/0011-index.html">0011号(2005-11)</a></li>
    
        <li><a href="../../articles/0010/0010-index.html">0010号(2005-10)</a></li>
    
        <li><a href="../../articles/0009/0009-index.html">0009号(2005-09)</a></li>
    
        <li><a href="../../articles/0008/0008-index.html">0008号(2005-07)</a></li>
    
        <li><a href="../../articles/0007/0007-index.html">0007号(2005-06)</a></li>
    
        <li><a href="../../articles/0006/0006-index.html">0006号(2005-05)</a></li>
    
        <li><a href="../../articles/0005/0005-index.html">0005号(2005-02)</a></li>
    
        <li><a href="../../articles/0004/0004-index.html">0004号(2004-12)</a></li>
    
        <li><a href="../../articles/0003/0003-index.html">0003号(2004-11)</a></li>
    
        <li><a href="../../articles/0002/0002-index.html">0002号(2004-10)</a></li>
    
        <li><a href="../../articles/0001/0001-index.html">0001号(2004-09)</a></li>
    
</ul>
<p class="rss-subscribe"><a href="/feed.xml">RSS</a></p>

            </div>
            <div class="col-md-10 main">
                <div class="row">
                    <div class="col-md-12">
                        <img src="../../images/rubima_logo_l.png">
                        <h1>Rubyist Hotlinks 【第 8 回】 田中哲さん その1</h1>
                        <div class="social-buttons">
                            <div class='sns'>            
    <ul class="clearfix">
       <li class="twitter"><a href="https://twitter.com/share?text=Rubyist Hotlinks 【第 8 回】 田中哲さん その1&amp;url=https://magazine.rubyist.net/articles/0008/0008-Hotlinks-1.html" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-twitter"></i></a></li>
       <li class="facebook"><a href="https://www.facebook.com/sharer.php?u=https://magazine.rubyist.net/articles/0008/0008-Hotlinks-1.html&amp;t=Rubyist Hotlinks 【第 8 回】 田中哲さん その1" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-facebook"></i></a></li>
       <li class="hatebu"><a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=https://magazine.rubyist.net/articles/0008/0008-Hotlinks-1.html&amp;Rubyist Hotlinks 【第 8 回】 田中哲さん その1" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa">B!</i></a></li>
    </ul>
</div>
                        </div>
                        <div class="post_info">
                            



                        </div>
                        
<h2 id="インタビュー-13">インタビュー (1/3)</h2>

<table>
  <tbody>
    <tr>
      <td>[ 1</td>
      <td><a href="../../articles/0008/0008-Hotlinks-2.html">2</a></td>
      <td><a href="../../articles/0008/0008-Hotlinks-3.html">3</a> ]</td>
    </tr>
  </tbody>
</table>

<ul id="markdown-toc">
  <li><a href="#インタビュー-13" id="markdown-toc-インタビュー-13">インタビュー (1/3)</a>    <ul>
      <li><a href="#好きな言葉" id="markdown-toc-好きな言葉">好きな言葉</a></li>
      <li><a href="#尊敬する人" id="markdown-toc-尊敬する人">尊敬する人</a></li>
      <li><a href="#主な作品" id="markdown-toc-主な作品">主な作品</a></li>
      <li><a href="#好きなメソッド嫌いなメソッド" id="markdown-toc-好きなメソッド嫌いなメソッド">好きなメソッド嫌いなメソッド</a></li>
      <li><a href="#rubyist-になったきっかけ" id="markdown-toc-rubyist-になったきっかけ">Rubyist になったきっかけ</a>        <ul>
          <li><a href="#resolvrb-が実は田中さんの作品だったという件について" id="markdown-toc-resolvrb-が実は田中さんの作品だったという件について">resolv.rb が実は田中さんの作品だったという件について</a></li>
          <li><a href="#posix-には-timegm3-が入っていない" id="markdown-toc-posix-には-timegm3-が入っていない">POSIX には timegm(3) が入っていない</a></li>
        </ul>
      </li>
      <li><a href="#ruby-とのつきあい" id="markdown-toc-ruby-とのつきあい">Ruby とのつきあい</a>        <ul>
          <li><a href="#使いやすさについて-1" id="markdown-toc-使いやすさについて-1">使いやすさについて (1)</a></li>
          <li><a href="#pthread-といっても出来具合は玉石混淆" id="markdown-toc-pthread-といっても出来具合は玉石混淆">pthread といっても出来具合は玉石混淆</a></li>
          <li><a href="#ruby-の-trap-のイマイチ使えない仕様" id="markdown-toc-ruby-の-trap-のイマイチ使えない仕様">Ruby の trap のイマイチ使えない仕様</a></li>
          <li><a href="#qwikweb-の素晴らしさ" id="markdown-toc-qwikweb-の素晴らしさ">qwikWeb の素晴らしさ</a></li>
          <li><a href="#ruby-の習得" id="markdown-toc-ruby-の習得">Ruby の習得</a></li>
          <li><a href="#プログラミングと美しさ" id="markdown-toc-プログラミングと美しさ">プログラミングと美しさ</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="好きな言葉">好きな言葉</h3>

<p><strong>笹田</strong>　好きな言葉、座右の銘などはありますか。</p>

<p><strong>田中</strong>　それが特にっていうことはないのですが、これはどうかな。「文字列が一方の端を持っているなら、もう片方の端も持っているに違いない」</p>

<p><strong>笹田</strong>　それはどういう意味で？</p>

<p><img class="right" src="https://images-fe.ssl-images-amazon.com/images/I/618K90DWMVL._SL160_.jpg" />
<strong>田中</strong>　どうなんでしょうね。これは作者不詳<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>で、たしか <a href="https://www.amazon.co.jp/PostScript-Language-Program-Design-Systems/dp/0201143968?SubscriptionId=AKIAIXYTNSOEGXJVP5SQ&amp;tag=cshs-22&amp;linkCode=xm2&amp;camp=2025&amp;creative=165953&amp;creativeASIN=0201143968">‘PostScript の Green Book’</a> の「デバッグテクニック」の章の頭に引用されていたたものなんですけど。まあ普通はそうなんだけど、嘘の事もあるなあと思って。</p>

<p><strong>笹田</strong>　印字するときに文字列はかっちり決まってるっていう意味？</p>

<p><strong>田中</strong>　あー、印字というイメージではないですね。C のメモリでのイメージです。少なくとも C では嘘の事がありますよね。</p>

<p><strong>笹田</strong>　ええ。なんかその言葉が気に入っていると。</p>

<p><strong>田中</strong>　気に入っているというかまあ、「セキュリティは重要なんだよ」ということですかね (笑) あるいは、信じられると思った事であっても、実は常に信じられるわけではない、とか。Ruby が完璧だと (笑) 信じている人は、ちょっと疑ったほうがいいのではないか。core も吐くし。</p>

<h3 id="尊敬する人">尊敬する人</h3>

<p><strong>笹田</strong>　尊敬する人は？</p>

<p><strong>田中</strong>　これも困りますが。無難な所で Guy Steele Jr.<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> とかどうでしょう。</p>

<p><strong>笹田</strong>　おお普通ですね。どのへん？</p>

<p><strong>田中</strong>　いやべつに、だから特に理由はない。特にそうだと思ってるとも限らないし。</p>

<p><strong>笹田</strong>　(笑) 日本人とかいないですか。</p>

<p><strong>田中</strong>　あんまり人を尊敬しない人間なのかも。</p>

<p><strong>笹田</strong>　なるほど。</p>

<p><strong>田中</strong>　じゃあ笹田さん、とか言っておきますか。「いやあアクティブで素晴らしい」</p>

<p><strong>笹田</strong>　(笑)</p>

<p><strong>田中</strong>　あとは「外部資金を得るのに積極的で素晴らしい」とか言っておきましょう。</p>

<p><strong>笹田</strong>　(笑)</p>

<h3 id="主な作品">主な作品</h3>

<p><strong>笹田</strong>　代表作は何になりますかね。沢山ありますよね。</p>

<p><strong>田中</strong>　代表作ねえ。ユーザーが一応ついていて、私がメインに作ったもので、となると、おそらく<a href="http://cvs.m17n.org/viewcvs/ruby/samidare/">五月雨</a>が一番多いのではないかな。</p>

<p>そうでなければ、他の人のソフトウェアに抱き合わせでなんかちょっと入っているっていう意味では、Ruby に入っているやつが一番かな。いや、<a href="http://www.zsh.org">Zsh</a> という可能性もあるかもしれない。<a href="http://viewcvs.sf.net">ViewCVS</a> はもっと少ないと思うんだけど。Ruby と Zsh てどっちが多いと思います？</p>

<p><strong>笹田</strong>　難しいですねそれは。どっちなんだろう。Zsh だと何になるんですか？</p>

<p><strong>田中</strong>　completion function <sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup>を沢山書いた。だから cvs とか apt-get でタブを打って出てくるのは、私のコードが動いているに違いない。</p>

<p><strong>笹田</strong>　へー。なるほど。</p>

<p><strong>田中</strong>　あとは <a href="http://www.cs.wisc.edu/~ghost/">Ghostscript</a> ですが、私が手掛けたやつは、最近はみんな使ってないだろうな。</p>

<p><strong>笹田</strong>　著作のほうは？</p>

<p><strong>田中</strong>　著作？　論文が少々。本はないですね。</p>

<p><strong>笹田</strong>　あと雑誌記事とかですか。</p>

<p><strong>田中</strong>　雑誌記事はあんまり誘われないので。</p>

<p><strong>笹田</strong>　Zsh の話は読んだ気がする。</p>

<p><strong>田中</strong>　ああ、それは書きましたね。</p>

<h3 id="好きなメソッド嫌いなメソッド">好きなメソッド嫌いなメソッド</h3>

<p><strong>笹田</strong>　好きなメソッドは？</p>

<p><strong>田中</strong>　それは前に聞かれた時<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup>から変わってないんですが、好きなのは <a href="ruby-man:Regexp#to_s">Regexp#to_s</a> かな。最初に聞かれたときは、よく思いつかなくて <a href="http://pub.cozmixng.org/~the-rwiki/rw-cgi.rb?cmd=view;name=%B7%D1%C2%B3">callcc</a> にしたんだっけ。</p>

<p><strong>笹田</strong>　なぜ Regexp#to_s が好きなんですか。</p>

<p><strong>田中</strong>　まぁ、自分で提案して自分で実装したというのがひとつですが、それだけなら他にもあるか。これがとくにという理由は、宣伝してないのに良く使われていて、しかも暗黙に呼ばれて表に出ないってところかな。re.to_s は /xxx#{re}xxx/ みたいなときに呼ばれて、普通のユーザは to_s を書かないんで。</p>

<p>あとは、regexp<sup id="fnref:5"><a href="#fn:5" class="footnote">5</a></sup> の埋め込みを実現する方法としては正しくないってところも面白いですね。やっぱり文字列化して展開してパーズし直すってのは間違っているでしょう。埋め込みを正しくやるんなら、木構造のレベルでやるべきでしょう。でも、正しくなくてもみんな気がつかないというのが面白い。</p>

<p><strong>笹田</strong>　嫌いなのは？</p>

<p><strong>田中</strong>　嫌いなのねえ。1.4 の頃は filter が嫌いでしたが。</p>

<p><strong>笹田</strong>　仕様変わったんですか。</p>

<p><strong>田中</strong>　なくなりました。</p>

<p><strong>笹田</strong>　filter って何するもの？map？</p>

<p><strong>田中</strong>　map!</p>

<p><strong>笹田</strong>　あーはいはい。</p>

<p><strong>田中</strong>　あるいは今だと何かな。うむ、嫌いというほどではないですが、iterator の中での retry とか。</p>

<p><strong>笹田</strong>　なるほど。たしかに嫌ですね<sup id="fnref:6"><a href="#fn:6" class="footnote">6</a></sup>。なしにしましょう。あれ。</p>

<p><strong>田中</strong>　うむ。なしにするのがいいと思うな。だれも使ってないと思うし。</p>

<p><strong>笹田</strong>　うん。作るのだけが大変なんですよ。ああでもあれか。ループにしたときにループのリトライってやりたい、ループというか</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">#(A)
10.times do |i|
   retry
end</code></pre></figure>

<p>てやったらやっぱり (A) に戻ってほしいようなことはあるかもとか。ループ構文として考えたら。</p>

<p><strong>田中</strong>　ループ構文ねえ。それは動かないんじゃないの？　動くの？</p>

<p><strong>笹田</strong>　10.times で retry は動きますよ。</p>

<p><strong>田中</strong>　えっと、times の中でだよねえ。block の中では……ああ、あれは動くかもしれないな。でも、retry はネストに対応してないしなあ。</p>

<p><strong>笹田</strong>　あー。</p>

<p><strong>田中</strong>　Lexical じゃなくて dynamic にやるんだよね。</p>

<p><strong>笹田</strong>　あれは<a href="http://www.atdot.net/~ko1/w3ml/w3ml.cgi/yarv-dev/msg/182">バグだ</a>って言ってるじゃないですか。</p>

<p><strong>田中</strong>　バグなの？</p>

<p><strong>笹田</strong>　うん。だから直すって言ってましたよ<sup id="fnref:7"><a href="#fn:7" class="footnote">7</a></sup>。</p>

<p><strong>田中</strong>　直すかわりに消したほうがいいと思うんだけど。</p>

<p><strong>笹田</strong>　いちおうもう YARV ではうごいてるから、YARV になれば治る。</p>

<p><strong>田中</strong>　なるほど。まぁ、それならそれで。</p>

<p><strong>田中</strong>　他には、あんまり REXML は使わなくなっちゃったからなんですけど、REXML のイテレータはなんとか with なんとかっていうのが convention が違うっていうのが非常に嫌かなあ。使わないからいいんだけど。</p>

<p><strong>笹田</strong>　昔は使ってたんですか？</p>

<p><strong>田中</strong>　ちょっと試しましたよ。</p>

<p><strong>笹田</strong>　で <a href="http://raa.ruby-lang.org/project/HTree">HTree</a> を自分で作った、と。</p>

<p><strong>田中</strong>　ええ。結局そうしました。</p>

<p><strong>笹田</strong>　じゃあまあ、そんな感じですかね。嫌いなメソッドは。</p>

<p><strong>田中</strong>　ああ <a href="ruby-man:Values">Values</a><sup id="fnref:8"><a href="#fn:8" class="footnote">8</a></sup> が嫌いだな。クラスだけど。</p>

<p><strong>笹田</strong>　なきゃ困るでしょう。</p>

<p><strong>田中</strong>　見えてほしくない。</p>

<p><strong>笹田</strong>　うん。</p>

<p><strong>田中</strong>　嫌いってほどでもないけど <a href="http://www.ruby-lang.org/ja/man/?cmd=view;name=Array#flatten">Array#flatten</a> もなあ。recursive なところが嫌かな。</p>

<p><strong>笹田</strong>　私はけっこう好きですけどね。</p>

<p><strong>田中</strong>　recursive なのが？</p>

<p><strong>笹田</strong>　うん。</p>

<p><strong>田中</strong>　いやまああってもいいと思うんだけど、recursive なのがない世界で用意するものだとは思えない。単に primitive 好きっていう傾向を示しているだけかもしれないけど。</p>

<p>Ruby のメソッドってなんか recursive なのが入ってる事が多いですよね。recursive な性質がいろいろ。</p>

<p><strong>笹田</strong>　intern とか？</p>

<p><strong>田中</strong>　え、intern が？</p>

<p><strong>笹田</strong>　あ、inspect の間違い。</p>

<p><strong>田中</strong>　あー、inspect とかが再帰的なのは自然なことだと思うんですよ。でも、たとえば、puts とかでさ、配列を渡すといきなりその配列の中身に recursive に入っていくとかあるわけです。でも、べつに puts は文字列しか受け取れないという仕様だったとしてもおかしくないでしょう。でも、なぜか配列も受け取れるんです。そういうのが Ruby 的だってことなのかもしれませんが、たまに recursive じゃないのが欲しいと思う事があって、そのときにない事に気付くと、簡単に出来るはずのことが出来ないわけで憤りを感じる。</p>

<p><strong>笹田</strong>　レベルが指定できるようなやつがなんかあったような気もしますね。</p>

<p><strong>田中</strong>　レベルはあんまり。</p>

<p><strong>笹田</strong>　いらないですか。一段だけでいい？</p>

<p><strong>田中</strong>　一段だけでいい。</p>

<h3 id="rubyist-になったきっかけ">Rubyist になったきっかけ</h3>

<h4 id="resolvrb-が実は田中さんの作品だったという件について"><a href="ruby-man:Resolv">resolv.rb</a> が実は田中さんの作品だったという件について</h4>

<p><strong>笹田</strong>　えーと Ruby について。Rubyist になったきっかけはいつごろで。どんな感じだったんでしょうか。</p>

<p><img src="../../images/0008-Hotlinks-1/akr12.jpg" alt="akr12.jpg" />
<strong>田中</strong>　いつからか憶えてませんけど、高校か大学から Perl を使い始めて、随分と長い間 Perl 使いだったんです。で一時期 Python も調べて (たしか 0.7 とかそういう世界でしたが)、まあ結局移りきれなくて Perl に戻って、大学院時代でもまだずっと Perl 使いでしたね。あぁ、ただ Python は電卓として重宝していました。</p>

<p>でも Ruby っていうのがあるっていうのは知ってて、同じ研究室の知り合いが、Ruby いいよとかいうわけです。でもまあ、Perl で済んでるからいいかということで使わないんですが。ただ、その頃は Perl4 なんですけども、データ構造が必要だったり、あるいはスレッドが使いたくなったら Ruby を使おうと決心はしていました。そのふたつって Perl4 では困難で、スレッド無いし、データ構造は全部 Hash と文字列で組み上げなくちゃいけないし、だからそれが必要になったら Ruby を使おうと前から思ってました。で、そういう機会が巡ってきたのが大学院から出た後ですね。</p>

<p>で、それが何だったかっていうと、アンテナなんですね。えとアンテナっていっても五月雨ではなくてそのもっと前のやつなんだけど。これは<a href="http://cvs.m17n.org/viewcvs/ruby/chenpi/">陳皮</a>っていうもので、今でも CVS にはあります。まあ別に宣伝も何もしていませんし自分でも使っていませんが。アンテナなので、まずいろんなサイトに並行にアクセスしたいからスレッドが必要だと。また各データをいろいろ取っておきたいので、Hash で組み上げるのはさすがに嫌と。で、まあ Ruby を使ってみようということにしました。そういうわけで、それを書いて、それ以降だんだんと Ruby を使う部分が増えていって、まあ最終的にこうなったわけですよね。最後まで Ruby を使わなかったのは何だったかというと、たしか電卓ですね。python から irb に移ればいいんですけど、たしか 16進変換が Python より Ruby が面倒臭くてなかなか移れなかった。まぁ、それも現在は irb を使っています。ruby -e と直接書くことも多々ありますが。</p>

<p>それはそれとして、陳皮のコードの一部は今も残っていて、<a href="ruby-man:Resolv">resolv.rb</a> っていうのはそのために書いたものです。</p>

<p><strong>笹田</strong>　今標準添付の？</p>

<p><strong>田中</strong>　標準添付のやつ。なぜかっていうと、リゾルバっていうのは C のレベルで <a href="man:gethostbyname">gethostbyname(3)</a> ってやつなんだけど、あれに入るとプロセス全体が block してしまうわけですね。で、block してる途中は他のスレッドは動けないから、複数のサイトに HTTP で繋げているときに、どこかでリゾルバが走ると、他のスレッドが全部止まってしまう。で止まっているうちに HTTP のサーバーがタイムアウトして、アクセスできないという、不幸な、非常に不幸な目にあったわけです。</p>

<p>これの解決法はプロセスを分けるとかいくつかあるんですけど、まあよりによって Ruby でリゾルバを書くという。なんかアンテナのためにリゾルバのライブラリを書くっていうのはちょっとやりすぎな気もしないでもありませんが、まあ書いたというか、書いてしまったわけです。オーバーエンジニアリングもいいところですね。</p>

<p>で、あるときにやっぱり同じような問題を持ってる人がいて、「こういうのがあるよ」って書いたら、「入れていい？」ってまつもとさんが聞いたので「いいよ」と答えたのが入った(<a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/10485">ruby-talk:10485</a>)。</p>

<p>まあだから、Ruby を使うようになったっていうのはそれが、アンテナを作ろうと思ったのがきっかけです。これは非常にハッキリしてます。</p>

<p><strong>笹田</strong>　resolv.rb はどうやって動いてるんですか？ UDP とか。</p>

<p><strong>田中</strong>　うん。単に UDP、まあ中身はもうちょっと真面目に書いてあるけど、使ってる所は UDP で送って UDP で待ってるっていう。ものですね。</p>

<p><strong>笹田</strong>　なるほど。</p>

<h4 id="posix-には-timegm3-が入っていない">POSIX には <a href="man:timegm">timegm(3)</a> が入っていない</h4>

<p><strong>笹田</strong>　開発に入ったのもリゾルバの話？</p>

<p><strong>田中</strong>　いやそれは、リゾルバのころはまだ commit 権限はもらわなくて、単にまつもとさんが入れただけ。</p>

<p><strong>笹田</strong>　なるほど。</p>

<p><strong>田中</strong>　で名前も何も書いてないから、あのライブラリの、誰が作ったかって不明だったんだよね。今は確か名前を書いておいたと思いますが、そのころは誰が作ったかを調べるのはひじょうに困難だったのではないかと。</p>

<p>committer になったのはもっと後で、えっとたしか time.c の <a href="http://www.ruby-lang.org/ja/man/index.cgi?cmd=view;name=Time#Time.2eutc">Time.utc</a> のところを叩き直した時だと思う。Time.utc っていうのは UTC (協定世界時) における年月日時分秒から Time オブジェクトを作るやつですけども、この中身が当時色々と、難しい問題を孕んでいたんです。特に夏時間の話が問題で、まあ<a href="http://www.rubyist.net/~matz/20050305.html#p04">まつもとさんがしばらく前に日記に書いてました</a>けども、どうも毎回、夏時間の切り替わりのときになるとバグレポートが来たんだそうです。で、なんかの拍子に、きっかけは忘れましたが、それに対してバグレポートを送ったんですね。それが夏時間の話だったかはちょっと憶えてませんが、というか Time.utc だから協定世界時の話だったはずですが。でも、どうも直り方が、直ったというんだけど直ってないとか、あるいは壊れた所があるとか。どうも正しく直してると思えなかったんです。</p>

<p>っていうのは、これはまあ、まつもとさんのせいというよりは POSIX のせいなんですが、Time オブジェクトの中身は time_t っていうやつですけども、協定世界時から time_t に変換するっていう関数は POSIX にないんですよ。ふざけたことに。で、ないからどうしていたかというと、<a href="man:mktime">mktime(3)</a> というのがあって、local time から time_t にするっていうのはある。だからこっちを使って、local time と UTC の差を微妙に補正するっていう実装だったんです。でも、これは、なんていうかな、あからさまにとちりそうな、難しい問題で、特にまあ、夏時間との切り替わりとかはうまくいかないんですよ。</p>

<p>でまあ、そんなこんながあってですね、まあこれまつもとさんにまかせておくと治りそうにないなと。しょうがないし、それにそういう難しいプログラムは好きなので、自分で書いて、でその patch を送って、で何回目かに update した段階で commit 権が来たんだと思います</p>

<p><strong>笹田</strong>　もう勝手にやれと。</p>

<p><strong>田中</strong>　うむ。まあそう。</p>

<p>それからも何回か手を入れた気がしますね。time.c を調べれば分かりますが、mktime(3) から補正するのから、まずは二分探索に変えました。ようするに、逆に time_t から年月日を調べる関数はあるわけです。だからその逆変換をかけるわけ</p>

<p><strong>笹田</strong>　なるほど。</p>

<p><strong>田中</strong>　逆変換をどうやるかっていうのは、どうやってもいいんですが、32bit time_t の中を探索するわけなんで、例えば二分探索でやれば 32 回で済むわけです。まあそれでだいたい動くんじゃないの、というのが最初のコンセプトでした。けどまあ、紆余曲折あって、現在ではそれは最後の手段でデフォルトではないんだけど。</p>

<p>実は glibc だとか tzcode っていって BSD や商用 UNIX にもよく使われているライブラリでは、<a href="man:timegm">timegm(3)</a> っていうのがあるんですよ。標準じゃないんですけど。で、それがあれば使うんです。</p>

<p>それはそれとして自前でやる場合には細かい問題がいろいろあって、たとえば time_t が 32bit じゃなくて、64bit だったら、まあ 64 回になるだけだからいいじゃんと思うわけです。思いますよね。ところが 64bit だとこれは今度は 32bit year が overflow するんですね。struct tm の tm_year が。年が overflow するって信じらんないと思いますけれど、するんですよ。そうすると、time_t の両端は struct tm に変換できなくてエラーになっちゃうんで、両端は初期値としてはダメなんです。使えない。</p>

<p><strong>笹田</strong>　なるほどぉ。</p>

<p><strong>田中</strong>　で、だからまあ、閏秒無しと仮定して予測した所から±1日くらいっていうのを初期値とするようなコードを入れたりとかいろいろやって、微妙なメンテナンスをして、今に至ってます。最近はトラブルは聞かないから問題はないんでしょう。まあ、<a href="man:zdump">zdump(8)</a> ですべての time zone の切り替わりの所が分かるんですけど、その時間についてちゃんと変換⇔逆変換して round trip することを確認したので、おそらくちゃんと動いているんだと思いますが。</p>

<p><strong>笹田</strong>　それ夏時間とかも入るとめんどくさいっていう話でしたけど、テストとかってどうやればいいんですか。テストとかって、今入ってるテストコードとかってやってるんですか。</p>

<p><strong>田中</strong>　いやあそこではやってない。単に一回作ったときに試しただけ。まあ、それは困んないと思うな (笑) それでも。あんまり壊れないと思うし。</p>

<p><strong>笹田</strong>　えーっと、committer になったきっかけはそんな所と。</p>

<p><strong>田中</strong>　うんそう。日本にも夏時間が入ると、もし入ると、そのへんが日本でも役に立つようになるかもしれませんね。</p>

<p><strong>笹田</strong>　(笑)</p>

<p><strong>田中</strong>　まあだから、日本に夏時間を導入すべきかどうかという件に関しては心境はちょっと複雑でしてね、そうやって手間をかけて書いたプログラムが役に立つって嬉しいじゃないですか。まあでも (笑) 　全体を見れば、そういう手間をかける必要がない世界のほうが幸せかなと思いますけど。でも、でもやっぱり自分が書いたコードが役に立つのは嬉しいので、あー夏時間来い来いとか、そういう面もないわけではない (笑) まあもちろんでも、毎回書くのかよと思うと、いややっぱりそれは嫌だと思いますが。</p>

<p>どうなるんでしょうねあれ。</p>

<p><strong>笹田</strong>　いやぁ、夏時間なんてないほうがいいでしょ。</p>

<p><strong>田中</strong>　まあそうですかね。ぜひ書いてみませんか (笑)</p>

<p><strong>笹田</strong>　いやです (笑)</p>

<p><strong>田中</strong>　なかなか難しいんで楽しいですよ。</p>

<p><strong>笹田</strong>　あー、だって、一部だけだったらいいと思いますけど、全部それチェックするのって嫌じゃないですかきっと。システムを。</p>

<p><strong>田中</strong>　うーん、どうでしょう</p>

<p><strong>笹田</strong>　まあでもノウハウあるからいいのかな。ちなみに他の人、glibc でしたっけ？</p>

<p><strong>田中</strong>　ん？　何が？</p>

<p><strong>笹田</strong>　逆変換の話。</p>

<p><strong>田中</strong>　逆変換は別に POSIX にあるんで。</p>

<p><strong>笹田</strong>　あれ POSIX にないっていう話はなんでしたっけ</p>

<p><strong>田中</strong>　ああだからええと、local time の逆変換はあるんです。UTC の逆変換がない。time_t と struct tm ですけど、time_t から struct tm は local time 版と UTC 版が両方ある。で逆変換は local time 版はあるんだけど UTC 版がない。だから、それだけですけど。<a href="man:localtime">localtime(3)</a> と、<a href="man:gmtime">gmtime(3)</a> か。今何時ですかっていうのは調べられるんだけど、何時の時の time_t は何かっていうのは分からない。local time はあるんだけど、UTC がない。</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">struct tm (UTC) &lt;---gmtime--- time_t ---localtime---&gt; struct tm (local time)
               (---timegm---&gt;)        &lt;---mktime---</code></pre></figure>

<p>まあ、なぜないかっていうのは、推測になりますが、おそらく計算で出るからかな。閏秒がない世界では計算で出るんです。UTC だから難しいってことはないんで。でもまあ、現実には閏秒を付けて運用する事もある……って滅多にないか。だからそれを気にしなければいいんですけど (笑)、だから関数が用意されてないのではないかという気がする。</p>

<p>で ruby では閏秒を付けている場合には、閏秒も含めた厳密な逆変換をしてますが。</p>

<p><strong>笹田</strong>　なるほど<sup id="fnref:9"><a href="#fn:9" class="footnote">9</a></sup>。</p>

<p><strong>田中</strong>　でも役に立つ事はあんまりないですね。ってゆーかそれを嬉しいっていわれた事もないな (笑)</p>

<p><strong>笹田</strong>　他のやつで既にあれば使うっていう話だったじゃないですか。そっちはどうやって書いてあるんですか？</p>

<p><strong>田中</strong>　あー。timegm(3) があれば、それは使います。</p>

<p>たぶん tzcode や glibc 内部で実装しているのは難しくないんじゃないかな。time zone の情報は zoneinfo っていうやつのなかに入ってますが、localtime(3) とかはそのデータを読んで変換しているわけです。そのデータを参照できるんなら逆変換を実装するのも別に難しくはないはずです。<sup id="fnref:10"><a href="#fn:10" class="footnote">10</a></sup></p>

<p><strong>笹田</strong>　はあ。なるほど。システムが持っている情報を使うから楽っていう。</p>

<p><strong>田中</strong>　えぇ、中身を覗ければ楽に実現可能だっていう話ですかね。Ruby からはそのデータを覗けないので厄介なんですが。</p>

<p><strong>笹田</strong>　うぅん。なるほど。総当たりみたいにやる必要はない</p>

<p><strong>田中</strong>　2分探索を総当たりと呼ぶかというとなんですが、まあもうちょっと簡単ですね。</p>

<h3 id="ruby-とのつきあい">Ruby とのつきあい</h3>

<p><strong>笹田</strong>　現在の Ruby との付き合いは何ですか。</p>

<p><strong>田中</strong>　開発。committer ですが。</p>

<p><strong>笹田</strong>　はい。</p>

<p><strong>田中</strong>　でもあんまり commit しないね、アクティブな人ほどには。どちらかというとバグレポートが多いですね。</p>

<p>バグレポートをどのぐらいしてるかっていうのは数えたことがあって、一年に百個以上やってるんです。</p>

<p><strong>笹田</strong>　(笑) 三日に一回は。</p>

<p><strong>田中</strong>　三日に一回。ですかね。</p>

<p><strong>笹田</strong>　バグレポートって ruby-dev に投げるの？</p>

<p><strong>田中</strong>　最近は ruby-dev が多いですよね。以前は、今は亡き Ruby の BTS<sup id="fnref:11"><a href="#fn:11" class="footnote">11</a></sup>に投げてましたが。基本的には修正するであろう人が読んでいるところに出しています。</p>

<p><strong>笹田</strong>　なるほど。まあバグ出し屋さんということで。</p>

<p><strong>田中</strong>　うむ</p>

<p><strong>笹田</strong>　使ってる言語としてはやっぱこればっかり？　他も使ってます？</p>

<p><strong>田中</strong>　日本語とか。</p>

<p><strong>笹田</strong>　いやまあそっち<sup id="fnref:12"><a href="#fn:12" class="footnote">12</a></sup>じゃなくて。</p>

<p><strong>田中</strong>　えー。プログラムはまあそうですね、C と Ruby を使えば、まだいたい済むかなぁ。</p>

<p>最近サボって何もやってないんでなんですが、ViewCVS の開発者でもあるので、それをやることがあるとすれば Python を使いますね。</p>

<p><strong>笹田</strong>　へー。</p>

<p><strong>田中</strong>　Python で書かれているので。</p>

<p>あるいはなんだろう、Zsh で completion function を書くときには zsh を使いますけど。ほかには何かな。</p>

<p><strong>笹田</strong>　Java とか。</p>

<p><strong>田中</strong>　Java。まあ使えないわけではないけど。普段は使わないですね。</p>

<p>PostScript は、最近ぜんぜん書かないな。</p>

<p><strong>笹田</strong>　前は書いてた、と。</p>

<p><strong>田中</strong>　ええまあ Ghostscript の日本語化 patch を一時保守していたし。</p>

<p><strong>笹田</strong>　なるほど</p>

<p><strong>田中</strong>　別にそんなに難しくはないので、書くことはありました。</p>

<h4 id="使いやすさについて-1">使いやすさについて (1)</h4>

<p><strong>笹田</strong>　Ruby の好きなところと嫌いなところを教えてください。</p>

<p><strong>田中</strong>　好きなところと嫌いなところですか。</p>

<p>うむ。どうなんでしょう。好きなところはなんですかね、まあ使いやすさに optimize してるところですかね。で、嫌いなところはなんでしょうね、使いやすさに optimize してるってことを、まつもとさん以外の開発者があんまり分かってなさそうだってことですかね。あとは……</p>

<p><strong>笹田</strong>　えっ、分かってはいるんじゃない……ええと、どこが使いやすいところかっていうのはまあ議論の分かれるところだとは思いますが、まつもとさんの使いやすさに optimize しているという観点はそれなりの了解はありそうですが。</p>

<p><strong>田中</strong>　ああじゃあそれを実践できてない人が多そうな気がする。</p>

<p><strong>笹田</strong>　使いやすさを有効に利用してるってことですか。</p>

<p><strong>田中</strong>　ライブラリを書く人ですけど。必ずしもあのレベル、core の部分の使いやすさと同程度なものを、ライブラリの使いやすさが実現しているとはちょっと思わない</p>

<p><strong>笹田</strong>　あー。なるほど。他のライブラリが使いやすさに追従できてないってことですよね。</p>

<p><strong>田中</strong>　うむ。</p>

<p>あと好きか嫌いか。そうですね。コミットをまとめる開発者が嫌いだとかどうでしょう。</p>

<p><strong>笹田</strong>　なにそれ。</p>

<p><strong>田中</strong>　たくさんの変更をまとめて commit する開発者が嫌い。</p>

<p><strong>笹田</strong>　あー、私のスタイルですね orz</p>

<p><strong>田中</strong>　えー、そうなの。</p>

<p><strong>笹田</strong>　うん。</p>

<p><strong>田中</strong>　別に笹田さんを想定しているわけではないんですけど。</p>

<p><strong>笹田</strong>　えだってめんどくさくないですかコミットって。</p>

<p><strong>田中</strong>　そうかな。</p>

<p><strong>笹田</strong>　まあ、まあもちろん理想は一変更一コミットだとは思いますが。ついつい一晩、こうずっと変更しちゃって、で夜が明けたらコミットっていう生活をしてしまって。</p>

<p><strong>田中</strong>　いやまあ一日ならまだましなんですがねえ。じゃあ、じゃあテストに失敗した状態で commit するプロジェクトリーダーは嫌いだっていうのはどうでしょうね。</p>

<p><strong>笹田</strong>　(笑) プロジェクトリーダーとか言わないでくださいよ。</p>

<p><strong>田中</strong>　えーじゃあ、別に開発者でもいいですけど。</p>

<p><strong>笹田</strong>　(笑)</p>

<p><strong>田中</strong>　じゃあコンパイルできない状態で commit する開発者が嫌いだとか。</p>

<p><strong>笹田</strong>　(このへん笑いっぱなし)</p>

<p><strong>田中</strong>　じゃあ ChangeLog に書かない変更を commit する開発者が嫌いだとか。</p>

<p><strong>笹田</strong>　(笑)</p>

<p><strong>田中</strong>　じゃあ後は、<a href="http://pub.cozmixng.org/~the-rwiki/rw-cgi.rb?cmd=view;name=K%26R+%A4%CA%B4%D8%BF%F4%C4%EA%B5%C1">K&amp;R スタイルの関数定義</a>が嫌いだっていうのはどうでしょう。</p>

<p><strong>笹田</strong>　(笑) 嫌いなんですか。</p>

<p><strong>田中</strong>　K&amp;R は好きじゃないですねえ。嫌いというか、問題の発見が遅れることになることがあるので。</p>

<p><strong>笹田</strong>　あーなるほど。</p>

<p><strong>田中</strong>　まあ機能的な問題ですね。見かけの問題に関しては私は感覚が弱いので。</p>

<p>あと <a href="http://www.haskell.org">Haskell</a> やら <a href="http://www.standardml.org">ML</a> やらのパターンマッチがないのが。</p>

<p><strong>笹田</strong>　パターンマッチが入れられると思いますか。</p>

<p><strong>田中</strong>　不可能ではないと思うんですが。</p>

<p><strong>笹田</strong>　多重代入が今もって理解できないんですが。</p>

<p><strong>田中</strong>　んー、どっちかっつと、case みたいな形式で表さざるを得ないと思いますが。</p>

<p><strong>笹田</strong>　もっと使いやすくしろと。</p>

<p><strong>田中</strong>　いや、case って再帰的なパターンが使えないじゃないですか。もっといろんな組み合わせが欲しい。いろんな組み合わせのやつをちゃんと簡単に書きたい。</p>

<p><strong>笹田</strong>　そういう文法要素とか提案してみるというのは。</p>

<p><strong>田中</strong>　うーん。そうですねえ。</p>

<p><strong>笹田</strong>　好きなところが少ないですね。</p>

<p><strong>田中</strong>　好きなところ？　好きなところは、うーん。</p>

<p><strong>笹田</strong>　Perl とかに比べればやっぱりなんか、まあスレッドとかって言ってましたけど。</p>

<p><strong>田中</strong>　ああだから使えるツールとしてはそのとおりですが。好きかどうか……。</p>

<p><strong>笹田</strong>　これまで見たりしてきたなかのコメントで、「自分の考えにぴったり合ってる」とか「やろうとしたことがそのままかける」とかいうのがよく言われてますが、そういう点はどうでしょう。</p>

<p><strong>田中</strong>　自分が思うように変えようと思うと、抵抗にあうんですけど (笑)</p>

<p><strong>笹田</strong>　(笑) じゃぁ、現状では自分の考えにあわないところが多いんですか。</p>

<p><strong>田中</strong>　えー？あいや別に経験としてですけど。えーっと例えば多重代入とかさ。あるいは宣言の話とか。</p>

<p><strong>笹田</strong>　え、宣言の話なんてありました？</p>

<p><strong>田中</strong>　つまり</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">if false then
   foo = nil
else
   p foo
end</code></pre></figure>

<p>でエラーにならずに nil が表示されるのが嫌なのですが</p>

<p><strong>笹田</strong>　あーはいはいはいはい</p>

<p>いやあれはもちろん嫌なんじゃないですかみんな。あれは lexer の作り方でしょうがなく。</p>

<p><strong>田中</strong>　いや別に、つくりの問題とはまた別の問題だと思いますが。</p>

<p><strong>笹田</strong>　えーとでは、なんだっけ、細かいところまでいちゃうとそういう話がいろいろ出てくると思うんですけど、全体として。</p>

<p><strong>田中</strong>　全体としてですか。いや Python と同じような感じなんじゃないですか。</p>

<p><strong>笹田</strong>　特に変わらない？</p>

<p><strong>田中</strong>　まあ私が Python を使ってた頃はまだ、今ほど Python も使いやすくはなかったので、なんですけど。例えば C に比べて使いやすいかといえば、それは使いやすいですよ。あるいは Java に比べてとかいえば。でもじゃあ shell に比べて使いやすいかというと、shell のほうが簡単に書ける類のことはありますよね。いやまあ shell は細かいところに手が届かないんでまあいろいろと困るんですが、ただコマンドを起動したいだけなときには Ruby 使わないし。使えるところで使えばいいんじゃないですか。</p>

<p><strong>笹田</strong>　まあ確かに。ごもっともです。何の話だったっけ、好きなところ嫌いなところ。まあじゃあ特に好きっていうのはまあ使いやすさの話にオプティマイズしているところという。</p>

<p><strong>田中</strong>　まあ、ま少なくともそのポリシーは非常に興味深い。</p>

<h4 id="pthread-といっても出来具合は玉石混淆">pthread といっても出来具合は玉石混淆</h4>

<p><strong>笹田</strong>　Ruby を使って成功だったなあとかそういう事例は。</p>

<p><strong>田中</strong>　Ruby を使って成功？</p>

<p><strong>笹田</strong>　うん、特に Ruby だったからみたいなのはあります？</p>

<p><strong>田中</strong>　Ruby 自体を変えるときには必然的に Ruby を使いますよね。これは成功だと言えるか。</p>

<p><strong>笹田</strong>　(笑) いやまああんまりそれは言わないでしょうね</p>

<p><strong>田中</strong>　じゃあ Ruby のライブラリを作るときにはやっぱり Ruby で書かなければいけない。</p>

<p><strong>笹田</strong>　(笑) まあね。</p>

<p><strong>田中</strong>　でそうでないとすればアプリケーションの話になるんだけれども、アプリケーションで例えば五月雨やらなんやらを、たとえばアンテナを作るときには Perl に比べて Ruby を選んだわけです。それは理由はさっき言いましたが、データ構造とスレッドで、まあそれは成功だったと。Perl4 に比べれば成功だったと言えるのではないでしょうか。</p>

<p><strong>笹田</strong>　今の Python と比べたらどっちでもいいよねっていう感じですか。</p>

<p><strong>田中</strong>　うーむ。そうかもしれない。</p>

<p>ただ Python のスレッドはネイティブスレッドなので、ネイティブのスレッドが腐ってる環境だと微妙ですが。</p>

<p><strong>笹田</strong>　え、デフォルトでそうなんですか?。</p>

<p><strong>田中</strong>　Python は 2.0 からデフォルトでネイティブスレッドがコンパイルされるはずです。</p>

<p>native スレッドというのは Unix 上では pthread のことだけど、pthread の性質はいろいろですから。</p>

<p><strong>笹田</strong>　なんかネイティブスレッドは使うなと言われて</p>

<p><strong>田中</strong>　いや、それははじめて聞きましたが。</p>

<p><strong>笹田</strong>　遅いから使うなーって聞いたのですが。</p>

<p><strong>田中</strong>　え、じゃあどうするの？</p>

<p><strong>笹田</strong>　ユーザーレベルスレッドにするんじゃないの？しらないけど。</p>

<p><strong>田中</strong>　ユーザーレベルのスレッドを作るの？今から？</p>

<p><strong>笹田</strong>　いやそうじゃなくて、Python レベルで、その前はそうだったんじゃないんですか？</p>

<p><strong>田中</strong>　いや俺が知ってるのは、Python は昔はスレッドがなかった。</p>

<p><strong>笹田</strong>　あ、そうなんですか。</p>

<p><strong>田中</strong>　てか Perl だってなかったよね。いや Perl は今でもあんまりデフォルトではなくて。<a href="GoogleJ:iThreads">Perl のスレッド</a>はかなり変で、というか特徴的で、今のはスレッド間でのデータ共有がすごい explicit にやんないとできないんです。昔はそうでないもうちょっと pthread ぽい、メモリ空間を共有してる感じだったのだけど、これはなんかすごい動きが怪しくて、やっぱりデフォルトにはなんなくて、で今のやつもまだデフォルトではコンパイルされない、と理解してますが。</p>

<p>Python は、昔はなくて 2.0 でネイティブスレッドになって。</p>

<p><strong>笹田</strong>　あ、そんななんですか。</p>

<p><strong>田中</strong>　と理解してます。</p>

<p><img src="../../images/0008-Hotlinks-1/akr14.jpg" alt="akr14.jpg" />
<strong>笹田</strong>　ロックをたくさんするから遅くなっちゃうよー、という話を聞きましたけど。</p>

<p><strong>田中</strong>　まあだからネイティブスレッドなら、ロック必要ですよね、いろいろ。</p>

<p><strong>笹田</strong>　で、なんか、ジャイアントロックにしてるからスループットが向上しない、といわれた。ただまあ、私自身は使ってないから、伝聞ですけど。</p>

<p>うーん、Ruby のユーザーレベルスレッドを頑張って実装しましたというのは特異な話なんですかね。</p>

<p><strong>田中</strong>　多分そうだと、俺は思ってますけど。</p>

<p><strong>笹田</strong>　あときちんとやってるのは Java とか。</p>

<p><strong>田中</strong>　あ、Java は頑張ってるね。はじめからスレッド前提でやって。</p>

<p><a href="http://www.shiro.dreamhost.com/scheme/gauche/">Gauche</a> は pthread だっけ。</p>

<p><strong>笹田</strong>　Gauche は pthread。ユーザーレベルはがんばってない。</p>

<p><strong>田中</strong>　だからなければないわけだよね。うん。</p>

<p><strong>笹田</strong>　じゃあ pthread がない環境って Python は？</p>

<p><strong>田中</strong>　スレッドがないんだと俺は信じてるんですけど、でもそういう環境は今はあんまりないかなあ。BSD 系もみんな入ったし。<a href="http://www.netbsd.org">NetBSD</a> も遂に 2.0 で入ったから。NetBSD は長らくなくて、1.x ではなかったんですよ。入ったのは確か 2.0 だったと思う。</p>

<p><strong>笹田</strong>　<a href="http://www.openbsd.org">OpenBSD</a> とかは？</p>

<p><strong>田中</strong>　OpenBSD は昔からユーザーレベルスレッドのライブラリがある。で、それは pthread なので。まあこれには問題はあるんですけど。つまりユーザーレベルでちゃんとスレッドを動かすには、いろいろ nonblocking IO が必要で、で、全部のファイルディスクリプタを nonblocking にするんだよね。そうすると、stderr を nonblocking にしちゃうんだけど、stderr っていろいろ共有されてるから、他のプロセスのほうでトラブルが出るという。</p>

<p><strong>笹田</strong>　あーそうなんですか。</p>

<p><strong>田中</strong>　という話が、OpenBSD にはなかったかな。<a href="http://www.freebsd.org">FreeBSD</a> 4 のがやっぱりそうで、FreeBSD の 5 はカーネルレベルスレッドになったのかな。まあいろいろ変遷してるのですが</p>

<p><strong>笹田</strong>　5.0 はあれです、<a href="http://www.freebsd.org/kse/">KSE</a> が入って、ユーザーレベルとネイティブと両方というやつ。</p>

<p><strong>田中</strong>　ああ、だからそっか。ネイティブが入ったのか。だから多分 IO まわりのそういうトラブルはなくなったんだと思うんだけど。</p>

<p>だから、十把一絡げに pthread で使えるとは言っても、それが幸せかというのは今ひとつわからない。</p>

<h4 id="ruby-の-trap-のイマイチ使えない仕様">Ruby の <a href="http://www.ruby-lang.org/ja/man/index.cgi?cmd=view;name=Signal#Signal.2etrap">trap</a> のイマイチ使えない仕様</h4>

<p><strong>田中</strong>　ただ pthread は今調べようと思っていて、キャンセレーションポイントの概念をちょっと勉強しようと思ってますが。これはなぜかというと、Signal.trap の話なんですけど。Ruby の trap ていうのは、C の signal と同じ不幸があるわけです。</p>

<p>signal の不幸というのはなにかというと、C の signal handler というのは、どこで実行されるのかわからない。それこそ、どの命令とどの命令の間なのかわからない。ここでいう命令というのはアセンブラ・機械語なわけだけど。そうすると変なところで実行されてるかもしれないから、なんかデータ構造をいじくろうとおもうと、いじくってる途中に signal がきて、signal handler のなかでさらにそのデータ構造をいじくると壊れちゃうんで、そういう操作は出来ない。これが前提なのでどうしようもなくて、せいぜいフラグを立てるくらいしか使いようがないわけです。</p>

<p>Ruby の trap も同じで、trap に登録された block が起動するタイミングって非常に不明で、どこでも動く可能性があるわけです。ということは同じようにデータ構造をいじくるコードは動かないわけです。trap の中で何ができるのかというと、やっぱりたいしたことはできない。</p>

<p><strong>笹田</strong>　その話はなんか……</p>

<p><strong>田中</strong>　あ、やっても Ruby は壊れないよ。signal handler をどう使っても OS は壊れないのと同じで、下のレイヤは壊れない。それはいいんだけど、もう一歩踏み込んでアプリケーションとして意味のあることをやるにはどうしたらいいかという話で。たとえば、あるスレッドを安全に止めたいとか、そうアプリケーションレベルの usage をうまくサポートできない。だって、スレッドいきなり殺したら困るしさ。困るというかどこで止まるかわかんないし。そういう意味で同じなんですよ。C と同じ性質の問題が Ruby レベルに上がっているだけで、使いやすさが向上していない。で、キャンセレーションポイントの話が、まだ調べてないのでなんですけども、もうちょっとましなのではないかと想像しているので。</p>

<p><strong>笹田</strong>　Ruby のメソッドにもキャンセレーションポイントをきちんと明確に定義しましょうという話をしたいと。</p>

<p><strong>田中</strong>　できればいいなあと。YARV では trap はどこで起動するんですか？</p>

<p><strong>笹田</strong>　考えてないんですが。しなきゃだめだよね (笑)</p>

<p><strong>田中</strong>　じゃあ、えーと、キャンセレーションポイントみたいなものを入れてしまう。YARV ではこうですと。</p>

<p><strong>笹田</strong>　なんだろう、トラップを起動する (かもしれない) メソッドを定義しておいて、どっかに入れとく？</p>

<p><strong>田中</strong>　だいたい、アプリケーションて 2 種類あると思うんですよ。IO をするスレッドというかプログラムと、計算をして黙り込んでいるプログラムがあると思うのですが、IO のほうは途中で止めるときは、自分でここは止まる可能性があると宣言するか、あるいはブロックするところで止まるのがいいのではないかと思うのですが。まあ、今回の青木さんの例 (<a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-dev/25755">ruby-dev:25755</a>) で言えばですね、block するところで止めたいわけだけど、それが止まんないから困ってるわけです。止まんないというか、これには深い話があるんですけど。で、計算するほうはぷちっと殺してもいいことがありまして、それはそれでいきなり殺す、つまりキャンセレーションポイントを宣言しなくても殺せる意味で、この二つの使い方を両方サポートするにはどうしたらいいかということですかね。とりあえず黙り込んでしまうものにはキャンセレーションポイントを入れなさいというのがひとつの可能性かな。あるいは勝手に……勝手に入るのはよくないか。</p>

<p><strong>笹田</strong>　やらなきゃいけないとは思ってて、今単純に考えているのはメソッド呼び出しと、後方ジャンプの時にその実行をやって、とは考えているのだけど。</p>

<p><strong>田中</strong>　それはさあ、Ruby が壊れないというレベルだよね。そうではなくてアプリケーションの usage を気にしてほしいんですけど。</p>

<p><strong>笹田</strong>　はあ。</p>

<p><strong>田中</strong>　だって困るじゃん、アプリケーションでどこの時点でも、例外が発生したり止まったしちゃうんじゃ困るじゃないですか。</p>

<p><strong>笹田</strong>　どうなんでしょうね。フラグを作る？<sup id="fnref:13"><a href="#fn:13" class="footnote">13</a></sup> スレッドごとに。</p>

<p><strong>田中</strong>　フラグはまさに C の問題がそのまま残っちゃうでしょう。ブロックする操作の直前にセットされたら検査できないし。ま、そういうことを考えていたりもする。だから、そのために先人の知恵ということで pthread を調べたいなと。pthread のプログラムをまじめに書いたことがなくて、まあやってみるのもいいかと。</p>

<p><strong>笹田</strong>　私もないです。</p>

<p><strong>田中</strong>　まつもとさんもほかのでスレッド書いたことがないとか言ってて、みんなそうなんだよね。(<a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-list/26180">ruby-list:26180</a>)</p>

<p><strong>笹田</strong>　Open とかなんとかで、どうこうするっていう話を全部定義しているっていうことだよね。だから <a href="man:pthread_cancel">pthread_cancel(3)</a> をどこで起動するかっていう話ですよね。</p>

<p><strong>田中</strong>　あ、まだ勉強してないんで、すいません、よくわかんないです。</p>

<p><strong>笹田</strong>　まあなんかそのへんか。まあ trap の話もありましたね。signal がどこで届くかとか。</p>

<p><strong>田中</strong>　IO が絡んだときの signal の話は、青木さんが困ってますけれども、実は再現に挑戦してみたのですが再現しないんですね。なかなか難しい。</p>

<h4 id="qwikweb-の素晴らしさ">qwikWeb の素晴らしさ</h4>

<p><strong>笹田</strong>　では、たぶんこれは人のライブラリとかアプリケーションって話だと思うんですけど、私のとってこれはキラーアプリケーションとか、よかったライブラリとかあれば紹介していただけると。まあ自分のでもいっか。</p>

<p><strong>田中</strong>　<a href="ruby-man:Tempfile">tempfile.rb</a> はよく使いますね。でもキラーってやつじゃないな (笑)</p>

<p><strong>笹田</strong>　まあ標準ですからね。</p>

<p><strong>田中</strong>　標準ですね。標準でないもので……、標準でないととたんに使う気がうせる (笑) よくないかなあ。</p>

<p><strong>笹田</strong>　まあわかりますけど。Ruby のアプリケーションだとどうですかね。</p>

<p><strong>田中</strong>　アプリケーション。使ってないような気がする。んー。</p>

<p><strong>笹田</strong>　五月雨？</p>

<p><strong>田中</strong>　自分では使ってます。自分で作ったものはそれなりには使いますよね。</p>

<p><strong>笹田</strong>　他に何か使ってますか？</p>

<p><strong>田中</strong>　他にですか。細かいものはもちろん使ってますが、メモを書くとか。自作のツールはいろいろとありますが、たとえば Wiki のデータを取ってくるとか<sup id="fnref:14"><a href="#fn:14" class="footnote">14</a></sup>。</p>

<p><strong>笹田</strong>　あーはいはいはい。</p>

<p><strong>田中</strong>　(田中さんしばらく考え中)</p>

<p><strong>笹田</strong>　Ruby のアプリケーションってあんまりないですもんね。</p>

<p><strong>田中</strong>　だから、<a href="http://www.quickml.com">QuickML</a> とかですかね (笑) 使っているという意味では。あ、<a href="http://www.qwik.jp">qwikWeb</a> も使ってます。まあ、インストールしたのは私じゃないんですが。グループでの作業として。</p>

<p><strong>笹田</strong>　仕事で？</p>

<p><strong>田中</strong>　いやあ、Linux Conference のプログラム委員の仕事に。</p>

<p><strong>笹田</strong>　便利ですか？</p>

<p><strong>田中</strong>　まあ便利ですね。メールに添付されたのが MUA を使わずに添付ファイルを見たりしますし、だから paper が添付されていたらクリックすればでてくる。</p>

<p><strong>笹田</strong>　<a href="http://www.tmtm.org/ruby/w3ml/">w3ml</a> みたいなメーリングリストのビューアーとの違いですね。もちろんコメントとか書ける？</p>

<p><strong>田中</strong>　コメントとか書けますね。そういうところかな。あーあとはだから、プログラム委員とかだとクローズドでないといけない。w3ml とかの普通のメールアーカイバだと、メンバー管理が面倒。メーリングリストのメンバー管理と別にやらないといけない気がしませんか？</p>

<p><strong>笹田</strong>　なるほど。</p>

<p><strong>田中</strong>　独立せざるをえない。それに対して、qwikWeb は、それが連動しているので、subscribe すればそれだけで、アーカイブがクローズドなのができる。</p>

<p><strong>笹田</strong>　あ、そうなんですか？</p>

<p><strong>田中</strong>　うん。あとは、どうでしょうね。Wiki のたぐいは Ruby だからってことはないですかね。</p>

<p><strong>笹田</strong>　<a href="http://www.atdot.net/nadoka/nadoka.ja.html">Nadoka</a> は？</p>

<p><strong>田中</strong>　Nadoka ？　あ、Nadoka は使ってます、はい。</p>

<p><strong>笹田</strong>　(笑) でも、これも他のやつと変わらないですね。</p>

<p><strong>田中</strong>　新しくインストールしたときには Nadoka を使いましたけど。まあべつに <a href="http://plum.madoka.org/">plum</a> もまだ動いてるしな。あ、ちなみに次回は Nadoka ではないやつにしようと思っています。</p>

<p><strong>笹田</strong>　がーん。</p>

<h4 id="ruby-の習得">Ruby の習得</h4>

<p><strong>笹田</strong>　えーと、Ruby の習得は簡単でしたか？</p>

<p><strong>田中</strong>　使えるようになるまでというなら簡単だった。</p>

<p><strong>笹田</strong>　なにか引っかかったこととかはない？</p>

<p><strong>田中</strong>　それは覚えがないですね。Ruby はそういう意味では普通の手続き型言語なので。Ruby の詳細を理解したかと言われれば、それはわかりません。たぶん永遠にわかんないと思います。</p>

<h4 id="プログラミングと美しさ">プログラミングと美しさ</h4>

<p><strong>笹田</strong>　いままで読んだ中で最も美しいソースコードは？</p>

<p><strong>田中</strong>　わからないんですが。</p>

<p><strong>笹田</strong>　あまり気にしたことがない？</p>

<p><strong>田中</strong>　うん。大きなソースコードは必然的にあまりきれいにならないと信じてる。小さいソースは宝石みたいなソースはありますが、それは……どうなのかな。</p>

<p><strong>笹田</strong>　宝石みたいというと、すごいシンプルだとか？</p>

<p><strong>田中</strong>　過不足なく記述されているというのが一番大きいかな。あるいは仕様の点からも本質的にエラーが起こらないとか。そういうの美しいと感じることはあります。</p>

<p>そういう意味では江渡さんの感覚<sup id="fnref:15"><a href="#fn:15" class="footnote">15</a></sup>とは違うかもしれませんが、Scheme の append が美しいと言った和田先生<sup id="fnref:16"><a href="#fn:16" class="footnote">16</a></sup>の意見は、まあそれなりに同意できなくもない。それに対して Scheme でいえば、append とかはいいんだけど、last とかあんまり好きではないですね。標準じゃないけど。last というのはリストの最後の要素を取り出すんですけども、空リストに対して定義できないじゃないですか。だからあんまり美しいとは思わない。</p>

<p>でもそういえばそれに対して car はあんまり気にならないのはなぜでしょうね。プリミティブだからかな。</p>

<p><strong>笹田</strong>　ないと困るから (笑)</p>

<p><strong>田中</strong>　そうそうそう (笑) そうかもしれません。あるいは、pair に対して過不足なく定義されているからかも。append は引数に対してすべて定義されていて、過不足のない定義が可能ですね。Ruby では、Ruby のコードってあんまりそういうことを感じない気がする。美しくはないな。うん。感動を覚えた覚えはない気がしますね。</p>

<hr />
<p>[ 1 | <a href="../../articles/0008/0008-Hotlinks-2.html">2</a> | <a href="../../articles/0008/0008-Hotlinks-3.html">3</a> ]</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>/usr/games/fortune が出典とされている <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Guy L. Steele Jr., 現 Sun Microsystems, Inc. Scheme の作者の一人、CLTL などの著者 <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>コマンドライン引数などを補完する関数 <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:4">
      <p>好きなメソッド: 読書会や飲み会、自己紹介の定番ネタ。 <a href="#fnref:4" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:5">
      <p>regexp: regular expression, 正規表現のこと <a href="#fnref:5" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:6">
      <p>retry: 田中さんは言語デザインという観点から言っていて、ささだは実装の観点からやりづらい (高速化しづらい) から無しにしようと言っている <a href="#fnref:6" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:7">
      <p>誰が? <a href="#fnref:7" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:8">
      <p>Values: 現在の処理系で多値を実現するためのクラス <a href="#fnref:8" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:9">
      <p>なるほど: ささだは結局よくわかってない <a href="#fnref:9" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:10">
      <p>zoneinfo: Ruby がこの仕組みを採用していないのは、Windows ではさっぱり使えないからだと思われる <a href="#fnref:10" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:11">
      <p>BTS: 例のクラック事件以降 JitterBug は停止して rubyforge.org を利用するようになった <a href="#fnref:11" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:12">
      <p>そっち: どっちだ <a href="#fnref:12" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:13">
      <p>フラグ: trap が行うのはそのフラグを操作するだけで、プログラム側で明示的にそのフラグをセンスするようなプログラムにするという意味 <a href="#fnref:13" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:14">
      <p>自作ツール: wikisuck <a href="#fnref:14" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:15">
      <p>美しさに関する江渡さんの感覚: 前々回の江渡さんのインタビュー参照 <a href="#fnref:15" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:16">
      <p>和田英一氏 現東京大学名誉教授。国内の伝説的ハッカー <a href="#fnref:16" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
  </body>
</html>
