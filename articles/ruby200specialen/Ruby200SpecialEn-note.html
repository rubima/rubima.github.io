<!DOCTYPE html>
<html>
  



  <head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41117431-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-41117431-1');
  </script>
  <script src="../../js/gtag.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ruby 2.0.0： Note</title>
  <meta name="description" content="">

  <script src="../../js/jquery.min.js"></script>
  <script src="../../js/bootstrap.min.js"></script>
  <link href="../../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../../css/theme.css" rel="stylesheet" type="text/css">
  <link href="../../css/syntax.css" rel="stylesheet" type="text/css">
  <link href="../../css/sharebutton.css" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="https://magazine.rubyist.net/articles/ruby200specialen/Ruby200SpecialEn-note.html">
  <link rel="alternate" type="application/rss+xml" title="Rubyist Magazine" href="https://magazine.rubyist.net/feed.xml">
  <link rel="shortcut icon" href="../../images/favicon.ico">
</head>

  <body>
    <div class="container-fluid">
        <div class="row full">
            <div class="col-md-2 hidden-xs sidebar">
                <h4>

</h4>

<h4>バックナンバー</h4>
<ul>
    
        <li><a href="../../articles/0058/0058-index.html">0058号(2018-08)</a></li>
    
        <li><a href="../../articles/prerubykaigi2018/preRubyKaigi2018-index.html">RubyKaigi 2018 直前特集号</a></li>
    
        <li><a href="../../articles/0057/0057-index.html">0057号(2018-02)</a></li>
    
        <li><a href="../../articles/prerubykaigi2017/preRubyKaigi2017-index.html">RubyKaigi 2017 直前特集号</a></li>
    
        <li><a href="../../articles/0056/0056-index.html">0056号(2017-08)</a></li>
    
        <li><a href="../../articles/0055/0055-index.html">0055号(2017-03)</a></li>
    
        <li><a href="../../articles/0054/0054-index.html">0054号(2016-08)</a></li>
    
        <li><a href="../../articles/pretokyorubykaigi11/preTokyoRubyKaigi11-index.html">東京 Ruby 会議 11 直前特集号</a></li>
    
        <li><a href="../../articles/0053/0053-index.html">0053号(2016-04)</a></li>
    
        <li><a href="../../articles/0052/0052-index.html">0052号(2015-12)</a></li>
    
        <li><a href="../../articles/0051/0051-index.html">0051号(2015-09)</a></li>
    
        <li><a href="../../articles/0050/0050-index.html">0050号(2015-05)</a></li>
    
        <li><a href="../../articles/0049/0049-index.html">0049号(2014-12)</a></li>
    
        <li><a href="../../articles/0048/0048-index.html">0048号(2014-09)</a></li>
    
        <li><a href="../../articles/0047/0047-index.html">0047号(2014-06)</a></li>
    
        <li><a href="../../articles/0046/0046-index.html">0046号(2014-04)</a></li>
    
        <li><a href="../../articles/0045/0045-index.html">0045号(2013-12)</a></li>
    
        <li><a href="../../articles/0044/0044-index.html">0044号(2013-09)</a></li>
    
        <li><a href="../../articles/0043/0043-index.html">0043号(2013-07)</a></li>
    
        <li><a href="../../articles/0042/0042-index.html">0042号(2013-05)</a></li>
    
        <li><a href="../../articles/ruby200specialen/Ruby200SpecialEn-index.html">2.0.0 Special (EN)</a></li>
    
        <li><a href="../../articles/0041/0041-index.html">0041号(2013-02)</a></li>
    
        <li><a href="../../articles/0040/0040-index.html">0040号(2012-11)</a></li>
    
        <li><a href="../../articles/0039/0039-index.html">0039号(2012-09)</a></li>
    
        <li><a href="../../articles/rubykaja/kaja.html">RubyKaja のご紹介</a></li>
    
        <li><a href="../../articles/0038/0038-index.html">0038号(2012-05)</a></li>
    
        <li><a href="../../articles/0037/0037-index.html">0037号(2012-02)</a></li>
    
        <li><a href="../../articles/0036/0036-index.html">0036号(2011-11)</a></li>
    
        <li><a href="../../articles/0035/0035-index.html">0035号(2011-09)</a></li>
    
        <li><a href="../../articles/prerubykaigi2011/preRubyKaigi2011-index.html">RubyKaigi2011直前特集号</a></li>
    
        <li><a href="../../articles/0034/0034-index.html">0034号(2011-06)</a></li>
    
        <li><a href="../../articles/0033/0033-index.html">0033号(2011-04)</a></li>
    
        <li><a href="../../articles/0032/0032-index.html">0032号(2011-01)</a></li>
    
        <li><a href="../../articles/0031/0031-index.html">0031号(2010-10)</a></li>
    
        <li><a href="../../articles/prerubykaigi2010/preRubyKaigi2010-index.html">RubyKaigi2010直前特集号</a></li>
    
        <li><a href="../../articles/0030/0030-index.html">0030号(2010-06)</a></li>
    
        <li><a href="../../articles/0029/0029-index.html">0029号(2010-03)</a></li>
    
        <li><a href="../../articles/0028/0028-index.html">0028号(2009-12)</a></li>
    
        <li><a href="../../articles/0027/0027-index.html">0027号(2009-09)</a></li>
    
        <li><a href="../../articles/0026/0026-index.html">0026号(2009-06)</a></li>
    
        <li><a href="../../articles/0025/0025-index.html">0025号(2009-02)</a></li>
    
        <li><a href="../../articles/0024/0024-index.html">0024号(2008-10)</a></li>
    
        <li><a href="../../articles/0023/0023-index.html">0023号(2008-03)</a></li>
    
        <li><a href="../../articles/0022/0022-index.html">0022号(2007-12)</a></li>
    
        <li><a href="../../articles/0021/0021-index.html">0021号(2007-09)</a></li>
    
        <li><a href="../../articles/0020/0020-index.html">0020号(2007-08)</a></li>
    
        <li><a href="../../articles/0019/0019-index.html">0019号(2007-05)</a></li>
    
        <li><a href="../../articles/0018/0018-index.html">0018号(2007-02)</a></li>
    
        <li><a href="../../articles/0017/0017-index.html">0017号(2006-11)</a></li>
    
        <li><a href="../../articles/0016/0016-index.html">0016号(2006-09)</a></li>
    
        <li><a href="../../articles/0015/0015-index.html">0015号(2006-07)</a></li>
    
        <li><a href="../../articles/rubykaigi2006/RubyKaigi2006-index.html">日本 Ruby カンファレンス 2006 特別号</a></li>
    
        <li><a href="../../articles/0014/0014-index.html">0014号(2006-05)</a></li>
    
        <li><a href="../../articles/0013/0013-index.html">0013号(2006-02)</a></li>
    
        <li><a href="../../articles/0012/0012-index.html">0012号(2005-12)</a></li>
    
        <li><a href="../../articles/0011/0011-index.html">0011号(2005-11)</a></li>
    
        <li><a href="../../articles/0010/0010-index.html">0010号(2005-10)</a></li>
    
        <li><a href="../../articles/0009/0009-index.html">0009号(2005-09)</a></li>
    
        <li><a href="../../articles/0008/0008-index.html">0008号(2005-07)</a></li>
    
        <li><a href="../../articles/0007/0007-index.html">0007号(2005-06)</a></li>
    
        <li><a href="../../articles/0006/0006-index.html">0006号(2005-05)</a></li>
    
        <li><a href="../../articles/0005/0005-index.html">0005号(2005-02)</a></li>
    
        <li><a href="../../articles/0004/0004-index.html">0004号(2004-12)</a></li>
    
        <li><a href="../../articles/0003/0003-index.html">0003号(2004-11)</a></li>
    
        <li><a href="../../articles/0002/0002-index.html">0002号(2004-10)</a></li>
    
        <li><a href="../../articles/0001/0001-index.html">0001号(2004-09)</a></li>
    
</ul>
<p class="rss-subscribe"><a href="/feed.xml">RSS</a></p>

            </div>
            <div class="col-md-10 main">
                <div class="row">
                    <div class="col-md-12">
                        <img src="../../images/rubima_logo_l.png">
                        <h1>Ruby 2.0.0： Note</h1>
                        <div class="social-buttons">
                            <div class='sns'>            
    <ul class="clearfix">
       <li class="twitter"><a href="https://twitter.com/share?text=Ruby 2.0.0： Note&amp;url=https://magazine.rubyist.net/articles/ruby200specialen/Ruby200SpecialEn-note.html" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-twitter"></i></a></li>
       <li class="facebook"><a href="https://www.facebook.com/sharer.php?u=https://magazine.rubyist.net/articles/ruby200specialen/Ruby200SpecialEn-note.html&amp;t=Ruby 2.0.0： Note" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa fa-facebook"></i></a></li>
       <li class="hatebu"><a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=https://magazine.rubyist.net/articles/ruby200specialen/Ruby200SpecialEn-note.html&amp;Ruby 2.0.0： Note" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"><i class="fa">B!</i></a></li>
    </ul>
</div>
                        </div>
                        <div class="post_info">
                            



                        </div>
                        
<ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#significant-incompatibilities" id="markdown-toc-significant-incompatibilities">Significant incompatibilities</a>    <ul>
      <li><a href="#character-encoding-incompatibility" id="markdown-toc-character-encoding-incompatibility">Character encoding incompatibility</a>        <ul>
          <li><a href="#the-default-script-encoding-change" id="markdown-toc-the-default-script-encoding-change">The default script encoding change.</a></li>
          <li><a href="#iconv-library-is-deleted" id="markdown-toc-iconv-library-is-deleted">iconv library is deleted</a></li>
          <li><a href="#-k-will-raise-warning" id="markdown-toc--k-will-raise-warning">-K will raise warning</a></li>
        </ul>
      </li>
      <li><a href="#stringlines-returns-an-array-rather-than-enumerator" id="markdown-toc-stringlines-returns-an-array-rather-than-enumerator">String#lines returns an array rather than Enumerator</a></li>
      <li><a href="#number-integer-and-float-is-frozen" id="markdown-toc-number-integer-and-float-is-frozen">Number (Integer and Float) is frozen</a></li>
    </ul>
  </li>
  <li><a href="#other-new-features" id="markdown-toc-other-new-features">Other new features</a>    <ul>
      <li><a href="#new-symbol-notation" id="markdown-toc-new-symbol-notation">New symbol notation</a></li>
      <li><a href="#new-method-moduleprepend" id="markdown-toc-new-method-moduleprepend">New method: Module#prepend</a></li>
      <li><a href="#new-method-enumerablesize" id="markdown-toc-new-method-enumerablesize">new method: Enumerable#size</a></li>
      <li><a href="#to_h" id="markdown-toc-to_h">to_h</a></li>
      <li><a href="#kerneldir" id="markdown-toc-kerneldir">Kernel#<strong>dir</strong></a></li>
      <li><a href="#arraybsearch" id="markdown-toc-arraybsearch">Array#bsearch</a></li>
      <li><a href="#thread-local-variable-not-fiber-local" id="markdown-toc-thread-local-variable-not-fiber-local">Thread local variable (Not Fiber local)</a></li>
      <li><a href="#stack-size-option" id="markdown-toc-stack-size-option">Stack size option</a></li>
      <li><a href="#more-debugging-functionalities" id="markdown-toc-more-debugging-functionalities">More debugging functionalities</a></li>
    </ul>
  </li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>In this post, I will summarise things you should be aware when start using Ruby 2.0.0 including some of new features.</p>

<p>The official summary is in the <a href="http://svn.ruby-lang.org/cgi-bin/viewvc.cgi/tags/v2_0_0_0/NEWS?view=markup">NEWS file</a></p>

<h2 id="significant-incompatibilities">Significant incompatibilities</h2>

<h3 id="character-encoding-incompatibility">Character encoding incompatibility</h3>

<p>Author：naruse</p>

<h4 id="the-default-script-encoding-change">The default script encoding change.</h4>

<p>Default script encoding (when magic comment is not specified) is changed into UTF8<a href="http://bugs.ruby-lang.org/issues/6679">[#6679]</a></p>

<p>In Ruby 1.9, the default script encoding is US-ASCII. We changed it to be UTF-8 after considering the following pros and cons.</p>

<ul>
  <li>UTF-8 default is convenient because the majority of modern application uses UTF-8</li>
  <li>This change doe not impact any 1.9 codes if Magic Comments are in place.</li>
  <li>The default script encoding in 1.9 without Magic Comment is either US-ASCII or ASCII-8BIT. In UTF-8, then some string manipulation could become slower.</li>
  <li>Most codes which written for Ruby 1.8 and not written in UTF-8 don’t have a Magic Comment, but they raise an error due to invalid bytes in UTF-8. So in the most of that case, won’t be a silent problem.</li>
</ul>

<p>You may encounter problems if your code does not use Magic Comment, and also contains a string with escaped binary. In this case, you should either specify Magic Comment, or convert to ASCII-8bit with String#b that is added at <a href="http://bugs.ruby-lang.org/issues/6767">[#6767]</a>.</p>

<h4 id="iconv-library-is-deleted">iconv library is deleted</h4>

<p>iconv, a Ruby extension library, is deleted from the core<a href="http://bugs.ruby-lang.org/issues/6322">[#6322]</a></p>

<p>Please use <a href="https://rubygems.org/gems/iconv">iconv.gem</a> if you need to use iconv related methods such as String#encode and Encoding::Converter.</p>

<h4 id="-k-will-raise-warning">-K will raise warning</h4>

<p>If you still use -K option (as used in 1.8) it will raise warning.</p>

<h3 id="stringlines-returns-an-array-rather-than-enumerator">String#lines returns an array rather than Enumerator</h3>

<p>Author：yhara (Yutaka Hara)</p>

<p>In Ruby 1.9, String has methods that iterate string , such as each_line, each_char, each_byte, and each_codepoint, as well as their identical methods such as  lines,chars, bytes, code points</p>

<p>In, Ruby 2.0.0, lines, chars, bytes, and code points returns an array rather than Enumerator.</p>

<p>Here are some Ruby 1.9 examples.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"> # Returns the last line
 str.lines.to_a.last
 # Returns the second last line
 str.chars.to_a[1]</code></pre></figure>

<p>Here are the equivalent code in Ruby 2.0</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"> # Returns the last line
   str.lines.last
 # Returns the second last line
   str.chars[1]</code></pre></figure>

<p>As you can see, you do not have to convert with to_a</p>

<p>However, the following code now raises errors.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"> str.chars.with_index{ ... }</code></pre></figure>

<p>This is because an array does not have with_index method. To work this around, please replace with each_char.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"> str.each_char.with_index{ ... }</code></pre></figure>

<p>BTW IO, StringIO, ARGF has methods with same names, but methods such as IO#bytes are deprecated in Ruby 2.0 and raises warning if you use the method.</p>

<p>We decided to deprecate IO#bytes <sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>  <sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>  because no one will want to convert an entire file into an array (It may look strange that IO#bytes and String#bytes returns different result format) <sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup>.</p>

<p>each_byte is recommended over each in this situation.</p>

<p>The associated ticket：<a href="http://bugs.ruby-lang.org/issues/6670">http://bugs.ruby-lang.org/issues/6670</a></p>

<h3 id="number-integer-and-float-is-frozen">Number (Integer and Float) is frozen</h3>

<p>Author: Koichi Sasada</p>

<p>Integer (Fixnum, Bignum) and Float objects are always frozen. If (quite unlikely though) there are any codes that add instance variable or eigen method into these numerical objects, these programs will break.  Let’s throw away such codes.</p>

<p>The associated ticket(Japanese)：<a href="http://bugs.ruby-lang.org/issues/3222,">http://bugs.ruby-lang.org/issues/3222,</a> <a href="http://bugs.ruby-lang.org/issues/6936">http://bugs.ruby-lang.org/issues/6936</a></p>

<h2 id="other-new-features">Other new features</h2>

<h3 id="new-symbol-notation">New symbol notation</h3>

<p>Author: Koichi Sasada</p>

<p>You can now shorten [:a, :b, :c] to %i(a b c)</p>

<p>Like %W expands characters, %I expands characters.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">p %w(a b#{1} c) #=&gt; ["a", "b\#{1}", "c"]
p %W(a b#{1} c) #=&gt; ["a", "b1", "c"]

p %i(a b#{1} c) #=&gt; [:a, :"b\#{1}", :c]
p %I(a b#{1} c) #=&gt; [:a, :b1, :c]</code></pre></figure>

<h3 id="new-method-moduleprepend">New method: Module#prepend</h3>

<p>Author：Koichi Sasada</p>

<p>Module#prepend is similar to Module#include Unlike Module#include, the method prepends the specified class(module) into the method lookup order rather than appends.</p>

<p>The following article has more detail (Japanese)</p>

<ul>
  <li><a href="http://www.atdot.net/~ko1/diary/201212.html#d19">#19 Introduction of Module#prepend</a></li>
  <li><a href="http://www.atdot.net/~ko1/diary/201212.html#d20">#20 Application of Module#prepend</a></li>
</ul>

<h3 id="new-method-enumerablesize">new method: Enumerable#size</h3>

<p>Author：yhara</p>

<p>Enumerable now contains a method called “size” Enumerable already has a similar method called “count” but the method has a shortcoming of returning all the array element even when you only want to count the number of elements.</p>

<p>size method counts the number of elements without returning entire elements because the method is overwritten in all class that includes Enumerable.</p>

<p>For example, you can write a programme of counting the combination of 1000 elements in Ruby 2.0 as follows.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"> p [*1..1000].combination(3).size
 #=&gt; 166167000</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">(If you use "count", it takes too long because it tries to secure 166167000 elements of array into memory space) .</code></pre></figure>

<p>The “size” method returns nil if you won’t be able to know the size in advance. 
For example the following program returns nil because you won’t be able to know the total line size until you read the entire file.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"> File.open("log.txt"){|f|
   p f.each_line.size
 }</code></pre></figure>

<p>The related method：<a href="https://bugs.ruby-lang.org/issues/6636">https://bugs.ruby-lang.org/issues/6636</a></p>

<h3 id="to_h">to_h</h3>

<p>Author：yhara (Yutaka Hara)</p>

<p>Ruby has methods that converts an object into array or string, such as to_a and to_s. In Ruby 2.0, there is a new method called to_h that converts an object into a hash.</p>

<p>Struct, OpenStruct, and ENV cow can be converted into a hash with to_h. When a hash is passed to to_h, it just returns self. When nil is passed to to_h, it returns an empty hash ({}) .<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup></p>

<p>Going forward, I would suggest that you name to_h to methods that returns hash representation of an object.</p>

<h3 id="kerneldir">Kernel#<strong>dir</strong></h3>

<p>Author: Koichi Sasada</p>

<p>Kernel#<strong>dir</strong>  method is added. This method is same as File.dirname(<strong>FILE</strong>)  You can obtain the directory name of a file with <strong>dir</strong></p>

<h3 id="arraybsearch">Array#bsearch</h3>

<p>Author: nari</p>

<p>Array#bsearch <sup id="fnref:5"><a href="#fn:5" class="footnote">5</a></sup> takes a sorted array <sup id="fnref:6"><a href="#fn:6" class="footnote">6</a></sup> and matches a condition using binary search. It’s nice that you don’t have to build your own bsearch for programming competitions :-)</p>

<p>Here is the example. The following examples are all from <a href="https://github.com/ruby/ruby/blob/v2_0_0_0/array.c#L2404-2408">Ruby’s RDoc</a></p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">ary = [0, 4, 7, 10, 12]
ary.bsearch {|x| x &gt;=   4 } #=&gt; 4
ary.bsearch {|x| x &gt;=   6 } #=&gt; 7
ary.bsearch {|x| x &gt;=  -1 } #=&gt; 0
ary.bsearch {|x| x &gt;= 100 } #=&gt; nil</code></pre></figure>

<p>bsearch passes an array into an arugment inside block, and the block has to return either true or false.</p>

<ul>
  <li>When true is returned, the searching element locates in the same index or bigger.</li>
  <li>When true is returned, the searching element locates in the smaller index.</li>
</ul>

<p>It will be easier to understand if you read the both example and the descriptions together.</p>

<p>bsearch has two different mode, and I have explained <em>find-minimum</em> so far.
I will now explain the second mode,  <em>find-any</em></p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"># In most case, you may only wan to use find-minimum mode.
# So this is only for people interested in this topic.</code></pre></figure>

<p>You can switch the mode by the returning value of the block.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">When true/false is passed, it's in find-minimum mode, and when a number is returned, then it will be in find-any mode.</code></pre></figure>

<p>find-any finds a first element that matches a range of condition（i…j). The behavior depends on its returning value.</p>

<ul>
  <li>When positive is returned, ary[k] is outside of i…j range, and the searching element is in larger index than k</li>
  <li>When 0 is returned ary[k] is within i…j（i &lt;= ary[k] &lt; j）</li>
  <li>When negative is returned, ary[k] is outside of i…j range, and the searching element is in smaller index than k</li>
</ul>

<figure class="highlight"><pre><code class="language-text" data-lang="text">ary = [0, 4, 7, 10, 12]
# 4 &lt;= x &lt; 8
ary.bsearch {|x| 1 - x / 4 } #=&gt; 4 or 7
# 8 &lt;= x &lt; 10 (returns 0 since nothing matches)
ary.bsearch {|x| 4 - x / 2 } #=&gt; nil</code></pre></figure>

<p>It will be easier to understand if you read the both example and the descriptions together.
By the way, find-any mode is based on libc の bsearch(2) API</p>

<h3 id="thread-local-variable-not-fiber-local">Thread local variable (Not Fiber local)</h3>

<p>Author：Koichi Sasada</p>

<p>Thread#[] allows you to use thread local variables (variables that can be shared among threads), but these variables become invalid when switched by Fiber (Let’s call this as Fiber local variables).</p>

<p>To avoid this problem, we careated a new API for handling thread local variables that are not affected by Fiber local variables.</p>

<ul>
  <li>Thread#thread_variable_get(sym) gets a thread local variable “sym”</li>
  <li>Thread#thread_variable_set(sym, obj) sets a thread local variable “sym”</li>
  <li>Thread#thread_variables  gets all thread local variables</li>
  <li>Thread#thread_variable?(sym) checks if there is a thread local variable called “sym”</li>
</ul>

<p>In most cases, you can just use Thread#[] to control Fiber local variables per fiber, though you may occasionally need this API. Use it with caution.</p>

<h3 id="stack-size-option">Stack size option</h3>

<p>Author：Koichi Sasada</p>

<p>You can now specify VM and machine stack sizes (used by threads and fibers) in environment variables.</p>

<ul>
  <li>RUBY_THREAD_VM_STACK_SIZE: VM stack size for threads（Default: 128KB (32bit CPU) or 256KB (64bit CPU)）</li>
  <li>RUBY_THREAD_MACHINE_STACK_SIZE: Machine stack size for threads（Default：512KB or 1024KB）</li>
  <li>RUBY_FIBER_VM_STACK_SIZE: VM stack size for fibers（Default：64KB or 128KB）</li>
  <li>RUBY_FIBER_MACHINE_STACK_SIZE: Machine stack size for fibers（Default：256KB or 512KB）</li>
</ul>

<p>The default stack size gets bigger, though you don’t have to worry about it for normal usages.</p>

<p>The associated article (in Japanese)：<a href="http://www.atdot.net/~ko1/diary/201212.html#d21">Ruby VM Advent calendar #21 VM stack size tuning</a></p>

<hr />

<h3 id="more-debugging-functionalities">More debugging functionalities</h3>

<p>Author：Koichi Sasada</p>

<p>Ruby 2.0.0 added some debugging functions</p>

<ul>
  <li>TracePoint,  replacement of set_trace_func</li>
  <li>caller_locations(), better alternative to caller()</li>
  <li>ObjectSpace.reachable_objects_from(), retrieves object reference relations</li>
</ul>

<p>The more detail is in Ruby VM advent calendar referred in <a href="../../articles/0041/0041-YarvManiacs.html">YARV Maniacs 【第 11 回】 最近の YARV の事情</a> (sorry, they are written in Japanese).</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>This may get reverted in 2.0.1, if no one likes it :-p <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>knu (Akinori Musha) seems thinking about returning a class such as LazyArray that has both Enumerable and index access <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>You can use IO#readlines if you want to create an array of rows <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:4">
      <p>this feature lets you write hash = opts[:foo].to_h  without worrying whether opts[:foo] is nil or not <a href="#fnref:4" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:5">
      <p>There is also a similar function called Range#bsearch <a href="#fnref:5" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:6">
      <p>binary search assumes that the given array is sorted, and an un-sorted array is not taken into account <a href="#fnref:6" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
  </body>
</html>
