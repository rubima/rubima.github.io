<!DOCTYPE html>
<html>
  



  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Nora チュートリアル 【第 2 回】</title>
  <meta name="description" content="">

  <script src="../../js/jquery.min.js"></script>
  <script src="../../js/bootstrap.min.js"></script>
  <link href="../../css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="../../css/theme.css" rel="stylesheet" type="text/css">
  <link href="../../css/syntax.css" rel="stylesheet" type="text/css">

  <link rel="canonical" href="../..http://magazine.rubyist.net/articles/0002/0002-NoraTutorial.html">
  <link rel="alternate" type="application/rss+xml" title="Rubyist Magazine" href="http://magazine.rubyist.net/feed.xml">
  <link rel="shortcut icon" href="../../images/favicon.ico">
</head>

  <body>
    <div class="container-fluid">
        <div class="row full">
            <div class="col-md-2 hidden-xs sidebar">
                <h4>

</h4>

<h4>バックナンバー</h4>
<ul>
    
        <li><a href="../../articles/prerubykaigi2018/preRubyKaigi2018-index.html">RubyKaigi 2018 直前特集号</a></li>
    
        <li><a href="../../articles/0057/0057-index.html">0057号(2018-02)</a></li>
    
        <li><a href="../../articles/prerubykaigi2017/preRubyKaigi2017-index.html">RubyKaigi 2017 直前特集号</a></li>
    
        <li><a href="../../articles/0056/0056-index.html">0056号(2017-08)</a></li>
    
        <li><a href="../../articles/0055/0055-index.html">0055号(2017-03)</a></li>
    
        <li><a href="../../articles/0054/0054-index.html">0054号(2016-08)</a></li>
    
        <li><a href="../../articles/pretokyorubykaigi11/preTokyoRubyKaigi11-index.html">東京 Ruby 会議 11 直前特集号</a></li>
    
        <li><a href="../../articles/0053/0053-index.html">0053号(2016-04)</a></li>
    
        <li><a href="../../articles/0052/0052-index.html">0052号(2015-12)</a></li>
    
        <li><a href="../../articles/0051/0051-index.html">0051号(2015-09)</a></li>
    
        <li><a href="../../articles/0050/0050-index.html">0050号(2015-05)</a></li>
    
        <li><a href="../../articles/0049/0049-index.html">0049号(2014-12)</a></li>
    
        <li><a href="../../articles/0048/0048-index.html">0048号(2014-09)</a></li>
    
        <li><a href="../../articles/0047/0047-index.html">0047号(2014-06)</a></li>
    
        <li><a href="../../articles/0046/0046-index.html">0046号(2014-04)</a></li>
    
        <li><a href="../../articles/0045/0045-index.html">0045号(2013-12)</a></li>
    
        <li><a href="../../articles/0044/0044-index.html">0044号(2013-09)</a></li>
    
        <li><a href="../../articles/0043/0043-index.html">0043号(2013-07)</a></li>
    
        <li><a href="../../articles/0042/0042-index.html">0042号(2013-05)</a></li>
    
        <li><a href="../../articles/ruby200specialen/Ruby200SpecialEn-index.html">2.0.0 Special (EN)</a></li>
    
        <li><a href="../../articles/0041/0041-index.html">0041号(2013-02)</a></li>
    
        <li><a href="../../articles/0040/0040-index.html">0040号(2012-11)</a></li>
    
        <li><a href="../../articles/0039/0039-index.html">0039号(2012-09)</a></li>
    
        <li><a href="../../articles/rubykaja/kaja.html">RubyKaja のご紹介</a></li>
    
        <li><a href="../../articles/0038/0038-index.html">0038号(2012-05)</a></li>
    
        <li><a href="../../articles/0037/0037-index.html">0037号(2012-02)</a></li>
    
        <li><a href="../../articles/0036/0036-index.html">0036号(2011-11)</a></li>
    
        <li><a href="../../articles/0035/0035-index.html">0035号(2011-09)</a></li>
    
        <li><a href="../../articles/prerubykaigi2011/preRubyKaigi2011-index.html">RubyKaigi2011直前特集号</a></li>
    
        <li><a href="../../articles/0034/0034-index.html">0034号(2011-06)</a></li>
    
        <li><a href="../../articles/0033/0033-index.html">0033号(2011-04)</a></li>
    
        <li><a href="../../articles/0032/0032-index.html">0032号(2011-01)</a></li>
    
        <li><a href="../../articles/0031/0031-index.html">0031号(2010-10)</a></li>
    
        <li><a href="../../articles/prerubykaigi2010/preRubyKaigi2010-index.html">RubyKaigi2010直前特集号</a></li>
    
        <li><a href="../../articles/0030/0030-index.html">0030号(2010-06)</a></li>
    
        <li><a href="../../articles/0029/0029-index.html">0029号(2010-03)</a></li>
    
        <li><a href="../../articles/0028/0028-index.html">0028号(2009-12)</a></li>
    
        <li><a href="../../articles/0027/0027-index.html">0027号(2009-09)</a></li>
    
        <li><a href="../../articles/0026/0026-index.html">0026号(2009-06)</a></li>
    
        <li><a href="../../articles/0025/0025-index.html">0025号(2009-02)</a></li>
    
        <li><a href="../../articles/0024/0024-index.html">0024号(2008-10)</a></li>
    
        <li><a href="../../articles/0023/0023-index.html">0023号(2008-03)</a></li>
    
        <li><a href="../../articles/0022/0022-index.html">0022号(2007-12)</a></li>
    
        <li><a href="../../articles/0021/0021-index.html">0021号(2007-09)</a></li>
    
        <li><a href="../../articles/0020/0020-index.html">0020号(2007-08)</a></li>
    
        <li><a href="../../articles/0019/0019-index.html">0019号(2007-05)</a></li>
    
        <li><a href="../../articles/0018/0018-index.html">0018号(2007-02)</a></li>
    
        <li><a href="../../articles/0017/0017-index.html">0017号(2006-11)</a></li>
    
        <li><a href="../../articles/0016/0016-index.html">0016号(2006-09)</a></li>
    
        <li><a href="../../articles/0015/0015-index.html">0015号(2006-07)</a></li>
    
        <li><a href="../../articles/rubykaigi2006/RubyKaigi2006-index.html">日本 Ruby カンファレンス 2006 特別号</a></li>
    
        <li><a href="../../articles/0014/0014-index.html">0014号(2006-05)</a></li>
    
        <li><a href="../../articles/0013/0013-index.html">0013号(2006-02)</a></li>
    
        <li><a href="../../articles/0012/0012-index.html">0012号(2005-12)</a></li>
    
        <li><a href="../../articles/0011/0011-index.html">0011号(2005-11)</a></li>
    
        <li><a href="../../articles/0010/0010-index.html">0010号(2005-10)</a></li>
    
        <li><a href="../../articles/0009/0009-index.html">0009号(2005-09)</a></li>
    
        <li><a href="../../articles/0008/0008-index.html">0008号(2005-07)</a></li>
    
        <li><a href="../../articles/0007/0007-index.html">0007号(2005-06)</a></li>
    
        <li><a href="../../articles/0006/0006-index.html">0006号(2005-05)</a></li>
    
        <li><a href="../../articles/0005/0005-index.html">0005号(2005-02)</a></li>
    
        <li><a href="../../articles/0004/0004-index.html">0004号(2004-12)</a></li>
    
        <li><a href="../../articles/0003/0003-index.html">0003号(2004-11)</a></li>
    
        <li><a href="../../articles/0002/0002-index.html">0002号(2004-10)</a></li>
    
        <li><a href="../../articles/0001/0001-index.html">0001号(2004-09)</a></li>
    
</ul>
<p class="rss-subscribe"><a href="/feed.xml">RSS</a></p>

            </div>
            <div class="col-md-10 main">
                <div class="row">
                    <div class="col-md-12">
                        <img src="../../images/rubima_logo_l.png">
                        <h1>Nora チュートリアル 【第 2 回】</h1>
                        <div class="social-buttons">
                            <a href="http://b.hatena.ne.jp/entry//articles/0002/0002-NoraTutorial.html" class="hatena-bookmark-button" data-hatena-bookmark-title="Nora チュートリアル 【第 2 回】" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<span id="fb-root"></span>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<span class="fb-like" data-href="/articles/0002/0002-NoraTutorial.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></span>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="/articles/0002/0002-NoraTutorial.html" data-text="Nora チュートリアル 【第 2 回】">ツイート</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

                        </div>
                        
<ul id="markdown-toc">
  <li><a href="#nora-チュートリアル-第-2-回" id="markdown-toc-nora-チュートリアル-第-2-回">Nora チュートリアル 第 2 回</a>    <ul>
      <li><a href="#テンプレート" id="markdown-toc-テンプレート">テンプレート</a>        <ul>
          <li><a href="#原始的な-html-生成方法の問題" id="markdown-toc-原始的な-html-生成方法の問題">原始的な HTML 生成方法の問題</a></li>
          <li><a href="#テンプレートによる問題の解決" id="markdown-toc-テンプレートによる問題の解決">テンプレートによる問題の解決</a></li>
          <li><a href="#テンプレートエンジン" id="markdown-toc-テンプレートエンジン">テンプレートエンジン</a></li>
          <li><a href="#webtemplate-の使い方" id="markdown-toc-webtemplate-の使い方">Web::Template の使い方</a>            <ul>
              <li><a href="#テンプレートのサンプル-1" id="markdown-toc-テンプレートのサンプル-1">テンプレートのサンプル 1</a>                <ul>
                  <li><a href="#template1rb" id="markdown-toc-template1rb">template1.rb</a></li>
                  <li><a href="#template1html" id="markdown-toc-template1html">template1.html</a></li>
                  <li><a href="#template1rb-実行結果" id="markdown-toc-template1rb-実行結果">template1.rb 実行結果</a></li>
                </ul>
              </li>
              <li><a href="#値の置き換え" id="markdown-toc-値の置き換え">値の置き換え</a></li>
              <li><a href="#繰り返し" id="markdown-toc-繰り返し">繰り返し</a></li>
              <li><a href="#条件判断" id="markdown-toc-条件判断">条件判断</a></li>
            </ul>
          </li>
          <li><a href="#実用的なサンプル" id="markdown-toc-実用的なサンプル">実用的なサンプル</a>            <ul>
              <li><a href="#xpathcgi" id="markdown-toc-xpathcgi">xpath.cgi</a></li>
              <li><a href="#xpathhtml" id="markdown-toc-xpathhtml">xpath.html</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#次回予告" id="markdown-toc-次回予告">次回予告</a></li>
      <li><a href="#参考文献" id="markdown-toc-参考文献">参考文献</a></li>
      <li><a href="#著者について" id="markdown-toc-著者について">著者について</a></li>
    </ul>
  </li>
</ul>

<h2 id="nora-チュートリアル-第-2-回">Nora チュートリアル 第 2 回</h2>

<p>MoonWolf (<a href="mailto:moonwolf@moonwolf.com">moonwolf@moonwolf.com</a>)</p>

<p><a href="http://www.moonwolf.com/">MoonWolf Development</a></p>

<p>2004 年 10 月 14 日</p>

<p><img src="../../images/0002-NoraTutorial/nora_neko.png" alt="nora_neko.png" />前回の記事では Nora の最低限の入出力の方法だけ書きました。今回は <em>Hello World!</em> から一歩進んでテンプレートについて紹介します。</p>

<h3 id="テンプレート">テンプレート</h3>

<p>Nora による最も原始的な HTML 生成方法は、前回のリスト 2 のように Ruby プログラムに直接 HTML を埋め込んでしまう方法です。
HTML が小さく変更がほとんど無いならば、それでも特に問題にはなりません。
しかし HTML が多く大きくなったり、変更が頻繁にあったりする場合、管理しきれなくなっていきます。
そこでテンプレートにより原始的な HTML 生成方法の問題を解決します。</p>

<h4 id="原始的な-html-生成方法の問題">原始的な HTML 生成方法の問題</h4>

<ul>
  <li>Ruby と HTML がごちゃまぜになって何処に何があるのかわからなくなる。</li>
  <li>HTML を埋め込んだ部分を実行しないと何が出力されるかわからない。</li>
  <li><a href="http://www.macromedia.com/jp/software/dreamweaver/">Macromedia Dreameaver</a>、<a href="http://www-6.ibm.com/jp/software/internet/hpb/">IBM ホームページ・ビルダー</a>等の HTML エディタで編集できない。</li>
</ul>

<h4 id="テンプレートによる問題の解決">テンプレートによる問題の解決</h4>

<ul>
  <li>HTML を 1 ページ 1 ファイルとしてプログラムと別のファイルとして管理します。バージョン管理 (CVS/Subversion/etc) も個別にできるようになります。</li>
  <li>テンプレートだけを実行することができます。必要なのは Hash と Array による簡単なデータだけです。</li>
  <li>HTML とテンプレート固有の記号があるだけなので HTML エディタで編集することができます。</li>
</ul>

<h4 id="テンプレートエンジン">テンプレートエンジン</h4>

<p>Ruby には色々なテンプレートエンジンがあります。
<a href="http://www.rubygarden.org/ruby?HtmlTemplates">RubyGarden の HtmlTemplates ページ</a>や<a href="http://raa.ruby-lang.org/search.rhtml?search=template">RAA にもたくさん登録されて</a>います。
Nora にも Web::Template というテンプレートエンジンが含まれています。</p>

<h4 id="webtemplate-の使い方">Web::Template の使い方</h4>

<p>まずはサンプルを見てください。</p>

<h5 id="テンプレートのサンプル-1">テンプレートのサンプル 1</h5>

<h6 id="template1rb">template1.rb</h6>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'web/template'</span>

<span class="n">tmpl</span> <span class="o">=</span> <span class="no">Web</span><span class="o">::</span><span class="no">Template</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'filename'</span><span class="o">=&gt;</span><span class="s1">'template1.html'</span><span class="p">)</span>
<span class="n">tmpl</span><span class="p">.</span><span class="nf">param</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'Script Languages'</span><span class="p">,</span>
  <span class="s1">'table'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s2">"Ruby"</span><span class="p">,</span>   <span class="s1">'author'</span> <span class="o">=&gt;</span> <span class="s1">'matz'</span>             <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s2">"perl"</span><span class="p">,</span>   <span class="s1">'author'</span> <span class="o">=&gt;</span> <span class="s1">'Larry Wall'</span>       <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s2">"python"</span><span class="p">,</span> <span class="s1">'author'</span> <span class="o">=&gt;</span> <span class="s1">'Guido van Rossum'</span> <span class="p">},</span>
  <span class="p">],</span>
<span class="p">}</span>
<span class="n">tmpl</span><span class="p">.</span><span class="nf">output</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>

</code></pre></div></div>

<h6 id="template1html">template1.html</h6>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>\{\{var name=title\}\}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">"1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
   <span class="nt">&lt;th&gt;</span>name<span class="nt">&lt;/th&gt;</span>
   <span class="nt">&lt;th&gt;</span>author<span class="nt">&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
  \{\{loop name=table\}\}
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>\{\{var name=name\}\}<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>\{\{var name=author\}\}<span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
  \{\{/loop\}\}
<span class="nt">&lt;/table&gt;</span>

</code></pre></div></div>

<h6 id="template1rb-実行結果">template1.rb 実行結果</h6>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Script Languages<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">"1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
   <span class="nt">&lt;th&gt;</span>name<span class="nt">&lt;/th&gt;</span>
   <span class="nt">&lt;th&gt;</span>author<span class="nt">&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>Ruby<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>matz<span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>perl<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>Larry Wall<span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>python<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>Guido van Rossum<span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

<span class="nt">&lt;/table&gt;</span>

</code></pre></div></div>

<p>template1.rb の 3 行目でテンプレートを作成しています。
4 〜 11 行目でテンプレートの param 変数にデータを設定しています。
param は通常のハッシュオブジェクトです。基本的にキー：文字列という風にテンプレートに埋める値を書いていきます。
6 〜 10 行目ではループ用のデータを設定しています。この場合はキー：ハッシュの配列を設定します。</p>

<h5 id="値の置き換え">値の置き換え</h5>

<figure class="highlight"><pre><code class="language-text" data-lang="text">  {{var name=キー}}</code></pre></figure>

<p>パラメタから文字列を取り出してテンプレートに出力します。
デフォルトでは文字列は HTML エスケープして出力されます。
エスケープせずに出力する場合には、</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"> {{var name=キー escape=none}}</code></pre></figure>

<p>と書きます。</p>

<h5 id="繰り返し">繰り返し</h5>

<figure class="highlight"><pre><code class="language-text" data-lang="text">  {{loop name=キー}}
  {{/loop}}</code></pre></figure>

<p>パラメタからハッシュの配列を取り出して、それぞれのハッシュに対して loop 〜 /loop の処理を繰り返します。</p>

<h5 id="条件判断">条件判断</h5>

<figure class="highlight"><pre><code class="language-text" data-lang="text">  {{if name=キー}}
  {{else}}
  {{/if}}</code></pre></figure>

<p>パラメタから取り出した値によって条件分岐します。
値が真なら if 〜 else までが実行されます。
値が偽なら else 〜 /if までが実行されます。</p>

<h4 id="実用的なサンプル">実用的なサンプル</h4>

<p>テンプレートを使った簡単で実用的なサンプルを紹介します。
<a href="http://raa.ruby-lang.org/project/htree/">htree</a>と REXML を使って XPath のテストをするプログラムです。
テキストフィールドに XPath 式を、テキストエリアに HTML を入力して Go ボタンをクリックします。
すると、マッチした要素が下のテーブルに表示されます。</p>

<h5 id="xpathcgi">xpath.cgi</h5>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/local/bin/ruby -Ku</span>
<span class="nb">require</span> <span class="s1">'web'</span>
<span class="nb">require</span> <span class="s1">'web/template'</span>
<span class="nb">require</span> <span class="s1">'htree'</span>
<span class="nb">require</span> <span class="s1">'rexml/document'</span>

<span class="n">api</span> <span class="o">=</span> <span class="no">Web</span><span class="o">::</span><span class="no">Interface</span><span class="o">::</span><span class="no">AUTO</span><span class="p">.</span><span class="nf">new</span>

<span class="n">api</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span><span class="o">|</span><span class="n">req</span><span class="o">|</span>
  <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'title'</span>    <span class="o">=&gt;</span> <span class="s1">'XPath Test'</span><span class="p">,</span>
    <span class="s1">'cgi_name'</span> <span class="o">=&gt;</span> <span class="n">req</span><span class="p">.</span><span class="nf">script_name</span><span class="p">,</span>
  <span class="p">}</span>
  <span class="n">param</span><span class="p">[</span><span class="s1">'xpath'</span><span class="p">]</span>    <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s1">'xpath'</span><span class="p">]</span>    <span class="o">||</span> <span class="s1">''</span>
  <span class="n">param</span><span class="p">[</span><span class="s1">'textarea'</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s1">'textarea'</span><span class="p">]</span> <span class="o">||</span> <span class="s1">''</span>
  <span class="n">list</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="o">!</span><span class="n">param</span><span class="p">[</span><span class="s1">'xpath'</span><span class="p">].</span><span class="nf">empty?</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">param</span><span class="p">[</span><span class="s1">'textarea'</span><span class="p">].</span><span class="nf">empty?</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="no">HTree</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">'textarea'</span><span class="p">]).</span><span class="nf">to_rexml</span>
    <span class="n">match</span><span class="o">=</span><span class="no">REXML</span><span class="o">::</span><span class="no">XPath</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s1">'xpath'</span><span class="p">])</span>
    <span class="n">match</span><span class="p">.</span><span class="nf">each_with_index</span> <span class="p">{</span><span class="o">|</span><span class="n">elem</span><span class="p">,</span><span class="n">index</span><span class="o">|</span>
      <span class="n">list</span> <span class="o">&lt;&lt;</span> <span class="p">{</span>
        <span class="s1">'index'</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nf">to_s</span><span class="p">,</span>
        <span class="s1">'elem'</span>  <span class="o">=&gt;</span> <span class="n">elem</span><span class="p">.</span><span class="nf">to_s</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="k">end</span>
  <span class="n">param</span><span class="p">[</span><span class="s1">'list'</span><span class="p">]</span> <span class="o">=</span> <span class="n">list</span>
  
  <span class="n">rsp</span> <span class="o">=</span> <span class="no">Web</span><span class="o">::</span><span class="no">Response</span><span class="p">.</span><span class="nf">new</span>
  <span class="n">rsp</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s1">'text/html; charset=UTF-8'</span>
  <span class="n">tmpl</span> <span class="o">=</span> <span class="no">Web</span><span class="o">::</span><span class="no">Template</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'filename'</span><span class="o">=&gt;</span><span class="s1">'xpath.html'</span><span class="p">)</span>
  <span class="n">tmpl</span><span class="p">.</span><span class="nf">param</span> <span class="o">=</span> <span class="n">param</span>
  <span class="n">tmpl</span><span class="p">.</span><span class="nf">output</span><span class="p">(</span><span class="n">rsp</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">response</span> <span class="n">req</span><span class="p">,</span><span class="n">rsp</span>
<span class="p">}</span>

</code></pre></div></div>

<h5 id="xpathhtml">xpath.html</h5>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Content-Type"</span> <span class="na">content=</span><span class="s">"text/html; charset=utf-8"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>\{\{var name=title\}\}<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>\{\{var name=title\}\}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"\{\{var name=cgi_name\}\}"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"xpath"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"\{\{var name=xpath\}\}"</span> <span class="na">size=</span><span class="s">"100"</span> <span class="na">maxlength=</span><span class="s">"200"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"Submit"</span> <span class="na">value=</span><span class="s">"Go"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"textarea"</span> <span class="na">cols=</span><span class="s">"100"</span> <span class="na">rows=</span><span class="s">"20"</span><span class="nt">&gt;</span>\{\{var name=textarea\}\}<span class="nt">&lt;/textarea&gt;</span>
  <span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">"1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>Index<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>Match<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  \{\{loop name=list\}\}
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>\{\{var name=index\}\}<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>\{\{var name=elem\}\}<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  \{\{/loop\}\}
  <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

</code></pre></div></div>

<h3 id="次回予告">次回予告</h3>

<p>次回はアプリケーションフレームワークについて紹介いたします。</p>

<h3 id="参考文献">参考文献</h3>

<ul>
  <li><a href="http://raa.ruby-lang.org/project/nora/">RAA - nora</a></li>
  <li><a href="http://rwiki.moonwolf.com/rw-cgi.cgi?cmd=view;name=Nora">Nora ホームページ</a></li>
</ul>

<h3 id="著者について">著者について</h3>

<p><img src="../../images/0002-NoraTutorial/moonwolf.jpg" alt="moonwolf.jpg" /> MoonWolf は半導体メーカに勤めるプログラマです。2000 年に Ruby に触れ、それ以降 RAA (Ruby Application Archive) にてライブラリ・アプリケーションを発表し続けています。登録プロジェクト数 30 と世界 2 位であり 1 位を目指して日夜拡張ライブラリの書けそうな C ライブラリを探しています。Ruby関連の記事の執筆もしますので出版関係者のかた連絡お願いします。著者の連絡先は <a href="mailto:moonwolf@moonwolf.com">moonwolf@moonwolf.com</a> です。</p>


                    </div>
                </div>
            </div>
        </div>
    </div>
  </body>
</html>
